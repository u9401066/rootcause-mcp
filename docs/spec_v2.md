# rootcause-mcp æŠ€è¡“è¦æ ¼æ›¸ v2

**å°ˆæ¡ˆåç¨±ï¼š** rootcause-mcp  
**ç‰ˆæœ¬ï¼š** 2.5.0  
**æœ€å¾Œæ›´æ–°ï¼š** 2026-01-15  
**é¡å‹ï¼š** Model Context Protocol (MCP) Server  
**GitHubï¼š** https://github.com/[owner]/rootcause-mcp

---

## ğŸ› ï¸ ç¢ºèªçš„æŠ€è¡“æ±ºç­–

| é …ç›® | æ±ºç­– | ä¾†æºåƒè€ƒ |
|------|------|----------|
| Package Manager | **uv** | lumino-mcp-server |
| MCP Framework | **FastMCP** (Python MCP SDK) | lumino-mcp-server |
| Python | **3.12+** | å‡ç´š |
| Schema | **Pydantic v2** | æ¨™æº– |
| Persistence | **SQLite + SQLModel** | æ±ºç­– |
| Graph | **networkx** | æ±ºç­– |
| Ontology Reasoning | **owlready2** (Phase 2) | KG-RCA |
| Causal Inference | **DoWhy-GCM** (Phase 3) | PMID:35950198 |
| Causal Discovery | **causal-learn** (Phase 3) | py-why |
| Linter | **ruff** | æœ€ä½³å¯¦è¸ |
| Type Checker | **mypy --strict** | æœ€ä½³å¯¦è¸ |
| æ¶æ§‹æ¨¡å¼ | **DDD** | æœ€ä½³å¯¦è¸ |
| Confidence Score | **æ˜¯** (0.0-1.0) | AWS Sample |
| RCA å“è³ªè©•åˆ† | **æ˜¯** (5 ç¶­åº¦) | rca-ai-analyst |
| Prompt Guidance | **æ˜¯** (MCP Prompts) | mako10k/mcp-rca |
| Fallback | **Agent å±¤è™•ç†** | æ±ºç­– |
| Counterfactual Testing | **æ˜¯** (4 é …æ¸¬è©¦) | æœ¬å°ˆæ¡ˆè¨­è¨ˆ |

---

## ç›®éŒ„

1. [å°ˆæ¡ˆæ¦‚è¿°](#1-å°ˆæ¡ˆæ¦‚è¿°) âœ…
   - 1.4 å‰µæ–°å®šä½èˆ‡åƒ¹å€¼ä¸»å¼µ ğŸ†•
   - 1.5 é¢¨éšªèˆ‡ä¸ç¢ºå®šæ€§ ğŸ†•
2. [ç†è«–åŸºç¤](#2-ç†è«–åŸºç¤) âœ…
3. [ç³»çµ±æ¶æ§‹](#3-ç³»çµ±æ¶æ§‹) âœ…
4. [RCA æµç¨‹å¼•æ“](#4-rca-æµç¨‹å¼•æ“) âœ…
5. [è³‡æ–™çµæ§‹å®šç¾©](#5-è³‡æ–™çµæ§‹å®šç¾©) âœ…
6. [MCP Tools å®šç¾©](#6-mcp-tools-å®šç¾©) âœ…
   - 6.2 å› æœæ¨è«–é¡ Toolsï¼ˆå« Counterfactual Testingï¼‰ğŸ†•
7. [MCP Prompts å®šç¾©](#7-mcp-prompts-å®šç¾©) ğŸ†•
8. [RCA å“è³ªè©•åˆ†](#8-rca-å“è³ªè©•åˆ†) ğŸ†•
9. [é ˜åŸŸé…ç½®](#9-é ˜åŸŸé…ç½®) âœ…
10. [æŠ€è¡“å¯¦ä½œåƒè€ƒ](#10-æŠ€è¡“å¯¦ä½œåƒè€ƒ) âœ…
    - 10.2 DDD æ¶æ§‹è¨­è¨ˆ ğŸ†•
    - 10.3 æ ¸å¿ƒæŠ€è¡“é¸å‹ï¼ˆDoWhy-GCM, owlready2ï¼‰ğŸ†•
    - 10.4 GitHub Repos æ•´åˆå»ºè­°
    - 10.5 æ–‡ç»åƒè€ƒ
11. [é–‹ç™¼è·¯ç·šåœ–](#11-é–‹ç™¼è·¯ç·šåœ–) âœ…
12. [é™„éŒ„](#12-é™„éŒ„) âœ…

---

## 1. å°ˆæ¡ˆæ¦‚è¿°

### 1.1 å°ˆæ¡ˆå®šä½èˆ‡æ ¸å¿ƒç›®æ¨™

**rootcause-mcp æ˜¯ä»€éº¼ï¼š**
- ä¸€å€‹å°ˆæ³¨æ–¼ **çµæ§‹åŒ–å› æœæ¨è«–** çš„ MCP Server
- æä¾› AI Agent **RCA æµç¨‹ç®¡æ§**ã€**å› æœé©—è­‰**ã€**é­šéª¨åœ–ç”Ÿæˆ** èƒ½åŠ›
- ç¢ºä¿æ¨è«–éç¨‹æœ‰è·¡å¯å¾ªï¼Œæœçµ•å¹»è¦ºå¼çš„å› æœå®£ç¨±

**rootcause-mcp ä¸åšä»€éº¼ï¼š**
- âŒ ä¸è² è²¬è³‡æ–™åŸå­åŒ–ï¼ˆç”± Agent/LLM è™•ç†ï¼‰
- âŒ ä¸è² è²¬çŸ¥è­˜æª¢ç´¢ï¼ˆç”± RAG ç³»çµ±è™•ç†ï¼‰
- âŒ ä¸è² è²¬è³‡æ–™è®€å–ï¼ˆç”±å…¶ä»– MCP è™•ç†ï¼‰

### 1.2 é©ç”¨å ´æ™¯

| å ´æ™¯ | èªªæ˜ | å…¸å‹è§¸ç™¼ |
|------|------|----------|
| **æ­»äº¡æ¡ˆä¾‹ RCA** | é™¢å…§æ­»äº¡äº‹ä»¶çš„æ ¹æœ¬åŸå› åˆ†æ | M&M Conference |
| **ä½µç™¼ç—‡ RCA** | éé æœŸä½µç™¼ç—‡çš„å› æœè¿½æº¯ | è¡“å¾Œä½µç™¼ç—‡è¨è«– |
| **Near Miss RCA** | å·®é»ç™¼ç”Ÿçš„å±éšªäº‹ä»¶åˆ†æ | ç•°å¸¸äº‹ä»¶é€šå ± |
| **ç—…å®‰äº‹ä»¶ RCA** | ç—…äººå®‰å…¨äº‹ä»¶çš„ç³»çµ±æ€§åˆ†æ | TPR é€šå ±æ¡ˆä¾‹ |
| **è‡¨åºŠäººåŠ›å•é¡Œ RCA** | äººåŠ›é…ç½®ç›¸é—œå•é¡Œåˆ†æ | äººåŠ›ä¸è¶³å°è‡´çš„äº‹ä»¶ |

### 1.3 ç³»çµ±åˆ†å·¥é‚Šç•Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AI Agent (LLM)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è·è²¬ï¼š                                               â”‚   â”‚
â”‚  â”‚ â€¢ ç†è§£ç”¨æˆ¶è‡ªç„¶èªè¨€è¼¸å…¥                              â”‚   â”‚
â”‚  â”‚ â€¢ å°‡éçµæ§‹åŒ–æ–‡æœ¬ã€ŒåŸå­åŒ–ã€ç‚ºçµæ§‹åŒ–äº‹å¯¦              â”‚   â”‚
â”‚  â”‚ â€¢ ç¶œåˆå„ MCP è¼¸å‡ºï¼Œç”Ÿæˆæœ€çµ‚å ±å‘Š                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  rootcause-mcp     â”‚  â”‚  HHRAG MCP      â”‚  â”‚   CGU MCP       â”‚
â”‚  (æœ¬å°ˆæ¡ˆ)          â”‚  â”‚ (çŸ¥è­˜æª¢ç´¢)      â”‚  â”‚ (å‰µæ„ç™¼æ•£)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ RCA æµç¨‹         â”‚  â”‚ â€¢ çŸ¥è­˜åœ–è­œæŸ¥è©¢  â”‚  â”‚ â€¢ Fishbone ç™¼æƒ³ â”‚
â”‚ â€¢ å› æœé©—è­‰         â”‚  â”‚ â€¢ ç›¸ä¼¼æ¡ˆä¾‹æª¢ç´¢  â”‚  â”‚ â€¢ 5W2H åˆ†æ     â”‚
â”‚ â€¢ é­šéª¨åœ–ç®¡ç†       â”‚  â”‚ â€¢ æ–‡ç»çŸ¥è­˜æå–  â”‚  â”‚ â€¢ å…­é ‚å¸½å­æ€è€ƒ  â”‚
â”‚ â€¢ ä¸€è‡´æ€§æª¢æŸ¥       â”‚  â”‚ â€¢ è¶…åœ–é—œè¯æ“´å±•  â”‚  â”‚ â€¢ é€†å‘æ€ç¶­      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ†å·¥åŸå‰‡ï¼š**

| åŠŸèƒ½ | è² è²¬è€… | åŸå›  |
|------|--------|------|
| éçµæ§‹åŒ–â†’çµæ§‹åŒ– | Agent | LLM æ“…é•·ç†è§£èªæ„ï¼Œå‚³çµ±åˆ‡å‰²ä¸æº– |
| çŸ¥è­˜æª¢ç´¢/ç›¸ä¼¼æ¡ˆä¾‹ | HHRAG | å·²æœ‰æˆç†Ÿçš„è¶…åœ– RAG æ¶æ§‹ |
| å‰µæ„ç™¼æ•£/å¤šè§’åº¦æ€è€ƒ | CGU | 15 ç¨®å‰µæ„æ–¹æ³•å·²å¯¦ä½œ |
| **æµç¨‹ç®¡æ§/å› æœé©—è­‰** | **rootcause-mcp** | **æœ¬å°ˆæ¡ˆæ ¸å¿ƒåƒ¹å€¼** |

### 1.4 å‰µæ–°å®šä½èˆ‡åƒ¹å€¼ä¸»å¼µ

> **èª å¯¦è©•ä¼°ï¼šé€™ä¸æ˜¯æŠ€è¡“çªç ´ï¼Œè€Œæ˜¯ã€Œæ•´åˆå‰µæ–°ã€**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰µæ–°é¡å‹ï¼šã€Œæ•´åˆå‰µæ–°ã€+ ã€Œæ™‚æ©Ÿå‰µæ–°ã€                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âŒ ä¸æ˜¯ï¼š                                                      â”‚
â”‚     â€¢ æ–°æ¼”ç®—æ³•ç™¼æ˜                                              â”‚
â”‚     â€¢ æŠ€è¡“çªç ´                                                  â”‚
â”‚     â€¢ å­¸è¡“ç ”ç©¶                                                  â”‚
â”‚                                                                 â”‚
â”‚  âœ… æ˜¯ï¼š                                                        â”‚
â”‚     â€¢ æ­£ç¢ºçš„æŠ€è¡“çµ„åˆ + ç‰¹å®šé ˜åŸŸ + æ­£ç¢ºçš„æ™‚æ©Ÿ                    â”‚
â”‚                                                                 â”‚
â”‚  é¡æ¯”ï¼š                                                         â”‚
â”‚     Slack ä¸æ˜¯ç™¼æ˜å³æ™‚é€šè¨Šï¼Œè€Œæ˜¯ã€Œæ­£ç¢ºçµ„åˆã€çµ¦ä¼æ¥­ç”¨            â”‚
â”‚     rootcause-mcp ä¸æ˜¯ç™¼æ˜ RCAï¼Œè€Œæ˜¯ã€Œæ­£ç¢ºçµ„åˆã€çµ¦ AI Agent     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‚ºä»€éº¼å€¼å¾—åšï¼Ÿï¼ˆValue Propositionï¼‰**

| # | åƒ¹å€¼é» | èªªæ˜ |
|---|--------|------|
| 1 | **å¸‚å ´ç©ºç™½** | é–‹æºè‡¨åºŠ RCA + AI Agent æ•´åˆ = å¸‚å ´å¹¾ä¹ä¸å­˜åœ¨ |
| 2 | **æ™‚æ©Ÿæ­£ç¢º** | MCP ç”Ÿæ…‹å‰›èˆˆèµ·ï¼ˆ2024-2025ï¼‰ï¼Œæ¶ä½” RCA ç”Ÿæ…‹ä½ |
| 3 | **é ˜åŸŸæ•´åˆ** | HFACS-MES + 6M é­šéª¨åœ– + MCP çš„**é¦–æ¬¡æ­£å¼æ•´åˆ** |
| 4 | **å¯æ“´å±•** | Domain Cartridge è¨­è¨ˆå¯æ¨å»£åˆ°èˆªç©ºã€è£½é€ ã€IT Incident |

**ç«¶çˆ­åˆ†æï¼š**

| æ–¹æ¡ˆ | å•é¡Œ |
|------|------|
| é€šç”¨ RCA å·¥å…· (rca-ai-analyst) | ç„¡è‡¨åºŠé ˜åŸŸçŸ¥è­˜ï¼ŒHFACS ä¸å®Œæ•´ |
| å•†æ¥­è‡¨åºŠ RCA è»Ÿé«” | æ˜‚è²´ã€ä¸é–‹æºã€ä¸æ”¯æ´ AI Agent |
| LLM ç›´æ¥åš RCA | å¹»è¦ºå•é¡Œã€ç„¡çµæ§‹åŒ–æµç¨‹ã€ç„¡æ³•è¿½æº¯ |
| **rootcause-mcp** | âœ… é–‹æº + è‡¨åºŠå°ˆç”¨ + AI Agent å‹å¥½ |

### 1.5 é¢¨éšªèˆ‡ä¸ç¢ºå®šæ€§

**æŠ€è¡“é¢¨éšªï¼š**

| é¢¨éšª | å½±éŸ¿ | æ©Ÿç‡ | ç·©è§£ç­–ç•¥ |
|------|------|------|----------|
| FastMCP æˆç†Ÿåº¦ä¸è¶³ | éœ€è¦ workaround æˆ–æ›æ¡†æ¶ | ä½ | Week 1 Spike é©—è­‰ |
| SQLite æ•ˆèƒ½ç“¶é ¸ | å¤§å‹ Session è®Šæ…¢ | ä½ | å…ˆç”¨ï¼Œä¸å¤ å†æ› PostgreSQL |
| networkx å¤§åœ–æ•ˆèƒ½ | è¤‡é›œé­šéª¨åœ–è®Šæ…¢ | ä¸­ | é™åˆ¶ç¯€é»æ•¸ + å»¶é²è¼‰å…¥ |

**ç”¢å“é¢¨éšªï¼š**

| é¢¨éšª | å½±éŸ¿ | æ©Ÿç‡ | ç·©è§£ç­–ç•¥ |
|------|------|------|----------|
| 6 éšæ®µæµç¨‹å¤ªè¤‡é›œ | ç”¨æˆ¶ä¸é¡˜ç”¨ | ä¸­ | MVP å…ˆåš 3 éšæ®µ (GATHERâ†’ANALYZEâ†’ACTION) |
| HFACS è‡¨åºŠæ¥å—åº¦ä½ | åˆ†é¡ä¸è¢«èªå¯ | ä¸­ | å…ˆè«®è©¢ 2-3 ä½è‡¨åºŠå°ˆå®¶é©—è­‰ |
| ç„¡äººä½¿ç”¨ | å°ˆæ¡ˆå¤±æ•— | ä¸­ | å…ˆæ‰¾ 1-2 å€‹ Pilot ç”¨æˆ¶ |

**é–‹ç™¼åŠ é€Ÿç­–ç•¥ï¼š**

```
1. Spike Firstï¼ˆæŠ€è¡“é©—è­‰ï¼‰
   â””â”€ Week 1: 2-3 å¤© Spike é©—è­‰ FastMCP + SQLite

2. Vertical Sliceï¼ˆå‚ç›´åˆ‡ç‰‡ï¼‰
   â””â”€ æ¯å€‹ Phase åªåšã€Œä¸€å€‹å®Œæ•´æµç¨‹ã€ï¼Œä¸è¿½æ±‚å®Œç¾

3. AI-Assisted Coding
   â””â”€ Copilot/Claude ç”Ÿæˆ Pydantic schema â†’ CRUD
   â””â”€ è‡ªå‹•ç”Ÿæˆæ¸¬è©¦æ¡ˆä¾‹

4. å»¶é²å„ªåŒ–
   â””â”€ å…ˆèƒ½è·‘ï¼Œå†å„ªåŒ–
   â””â”€ å…ˆå–®æ©Ÿï¼Œéœ€è¦å†åˆ†æ•£å¼
```

---

## 2. ç†è«–åŸºç¤

### 2.1 Swiss Cheese Modelï¼ˆç‘å£«ä¹³é…ªæ¨¡å‹ï¼‰

**ä¾†æºï¼š** Reason, J. (1990). Human Error. Cambridge University Press.

**æ ¸å¿ƒæ¦‚å¿µï¼š**
äº‹æ•…çš„ç™¼ç”Ÿä¸¦éå–®ä¸€åŸå› ï¼Œè€Œæ˜¯å¤šå±¤é˜²è­·åŒæ™‚å¤±æ•ˆçš„çµæœã€‚æ¯ä¸€å±¤é˜²è­·ï¼ˆå¦‚ SOPã€è¨“ç·´ã€è¨­å‚™ï¼‰éƒ½åƒä¸€ç‰‡æœ‰æ´çš„ä¹³é…ªï¼Œç•¶æ‰€æœ‰æ´å‰›å¥½å°é½Šæ™‚ï¼Œå±å®³å°±æœƒç©¿é€æ‰€æœ‰é˜²ç·šé€ æˆäº‹æ•…ã€‚

```
     å±å®³æº                                    äº‹æ•…
        â”‚                                       â”‚
        â–¼                                       â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  â—‹      â”‚  â”‚    â—‹    â”‚  â”‚  â—‹      â”‚  â”‚      â—‹  â”‚
   â”‚    â—‹    â”‚  â”‚  â—‹      â”‚  â”‚      â—‹  â”‚  â”‚  â—‹      â”‚
   â”‚      â—‹â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â—‹â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â—‹â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â—‹â”€â”€â”€â”€â”¼â”€â”€â†’ äº‹æ•…!
   â”‚  â—‹      â”‚  â”‚      â—‹  â”‚  â”‚    â—‹    â”‚  â”‚    â—‹    â”‚
   â”‚      â—‹  â”‚  â”‚  â—‹      â”‚  â”‚  â—‹      â”‚  â”‚      â—‹  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    çµ„ç¹”æ–‡åŒ–      ç®¡ç†ç›£ç£      åŸ·è¡Œæ¢ä»¶      å€‹äººè¡Œç‚º
   (Latent)     (Latent)    (Active)     (Active)
```

**å° rootcause-mcp çš„æ„ç¾©ï¼š**
- RCA å¿…é ˆè¿½æº¯åˆ°**æ½›åœ¨åŸå›  (Latent Failures)**ï¼Œä¸èƒ½åªåœåœ¨ç›´æ¥åŸå› 
- é­šéª¨åœ–çš„åˆ†é¡æ‡‰æ¶µè“‹æ‰€æœ‰é˜²è­·å±¤ç´š
- æ”¹å–„æªæ–½æ‡‰é‡å°å¤šå±¤é˜²è­·ï¼Œè€Œéå–®é»ä¿®è£œ

### 2.2 HFACS-MESï¼ˆé†«ç™‚äº‹ä»¶äººå› åˆ†æåˆ†é¡ç³»çµ±ï¼‰

**ä¾†æºï¼š** 
- åŸå§‹ HFACS: Shappell & Wiegmann (2000), èˆªç©ºé ˜åŸŸ
- é†«ç™‚ç‰ˆ HFACS-MES: å¤šç¯‡æ–‡ç»æ•´åˆï¼Œåƒè€ƒ `docs/literature_review_clinical_rca.md`

**å››å±¤çµæ§‹èˆ‡ 36 åˆ†é¡ï¼š**

```
Level 4: çµ„ç¹”å½±éŸ¿ (Organizational Influences)
â”œâ”€â”€ è³‡æºç®¡ç† (Resource Management)
â”‚   â”œâ”€â”€ OI-RM1: äººåŠ›è³‡æºä¸è¶³
â”‚   â”œâ”€â”€ OI-RM2: è²¡å‹™è³‡æºé™åˆ¶
â”‚   â””â”€â”€ OI-RM3: è¨­å‚™è³‡æºä¸è¶³
â”œâ”€â”€ çµ„ç¹”æ°›åœ (Organizational Climate)
â”‚   â”œâ”€â”€ OI-OC1: çµ„ç¹”çµæ§‹å•é¡Œ
â”‚   â”œâ”€â”€ OI-OC2: æ”¿ç­–åŸ·è¡Œè½å·®
â”‚   â””â”€â”€ OI-OC3: çµ„ç¹”æ–‡åŒ–åå·®
â””â”€â”€ çµ„ç¹”æµç¨‹ (Organizational Process)
    â”œâ”€â”€ OI-OP1: ä½œæ¥­æµç¨‹è¨­è¨ˆç¼ºé™·
    â”œâ”€â”€ OI-OP2: ç¨‹åºæ–‡ä»¶ç®¡ç†ä¸ç•¶
    â””â”€â”€ OI-OP3: ç›£ç£ç¨½æ ¸æ©Ÿåˆ¶ä¸è¶³

Level 3: ä¸å®‰å…¨ç›£ç£ (Unsafe Supervision)
â”œâ”€â”€ ç›£ç£ä¸è¶³ (Inadequate Supervision)
â”‚   â”œâ”€â”€ US-IS1: æŒ‡å°è¨“ç·´ä¸è¶³
â”‚   â”œâ”€â”€ US-IS2: ä»»å‹™è¦åŠƒä¸ç•¶
â”‚   â””â”€â”€ US-IS3: è¿½è¹¤ç›£æ§ç¼ºå¤±
â”œâ”€â”€ è¨ˆç•«ä¸ç•¶ (Planned Inappropriate Operations)
â”‚   â”œâ”€â”€ US-PI1: é¢¨éšªè©•ä¼°ä¸è¶³
â”‚   â””â”€â”€ US-PI2: è¶…æ™‚å·¥ä½œå®‰æ’
â”œâ”€â”€ æœªç³¾æ­£å•é¡Œ (Failed to Correct Problem)
â”‚   â”œâ”€â”€ US-FC1: å·²çŸ¥å•é¡Œæœªè™•ç†
â”‚   â””â”€â”€ US-FC2: é•è¦è¡Œç‚ºæœªç³¾æ­£
â””â”€â”€ ç›£ç£é•è¦ (Supervisory Violations)
    â”œâ”€â”€ US-SV1: æˆæ¬Šä¸ç•¶æ“ä½œ
    â””â”€â”€ US-SV2: æœªåŸ·è¡Œè¦å®šç›£ç£

Level 2: ä¸å®‰å…¨è¡Œç‚ºå‰æ (Preconditions for Unsafe Acts)
â”œâ”€â”€ ç’°å¢ƒå› ç´  (Environmental Factors)
â”‚   â”œâ”€â”€ PC-EF1: ç‰©ç†ç’°å¢ƒä¸è‰¯
â”‚   â”œâ”€â”€ PC-EF2: æŠ€è¡“ç’°å¢ƒå•é¡Œ
â”‚   â””â”€â”€ PC-EF3: å·¥ä½œç’°å¢ƒå¹²æ“¾
â”œâ”€â”€ äººå“¡ç‹€æ…‹ (Condition of Operators)
â”‚   â”œâ”€â”€ PC-CO1: ç”Ÿç†ç‹€æ…‹ä¸ä½³
â”‚   â”œâ”€â”€ PC-CO2: å¿ƒç†ç‹€æ…‹å•é¡Œ
â”‚   â””â”€â”€ PC-CO3: èªçŸ¥èƒ½åŠ›å—é™
â””â”€â”€ äººå“¡å› ç´  (Personnel Factors)
    â”œâ”€â”€ PC-PF1: æºé€šå”èª¿ä¸è‰¯
    â”œâ”€â”€ PC-PF2: åœ˜éšŠåˆä½œå•é¡Œ
    â””â”€â”€ PC-PF3: é©ä»»æ€§å•é¡Œ

Level 1: ä¸å®‰å…¨è¡Œç‚º (Unsafe Acts)
â”œâ”€â”€ éŒ¯èª¤ (Errors)
â”‚   â”œâ”€â”€ UA-ER1: æ±ºç­–éŒ¯èª¤
â”‚   â”œâ”€â”€ UA-ER2: æŠ€èƒ½æ€§éŒ¯èª¤
â”‚   â””â”€â”€ UA-ER3: æ„ŸçŸ¥æ€§éŒ¯èª¤
â””â”€â”€ é•è¦ (Violations)
    â”œâ”€â”€ UA-VL1: ä¾‹è¡Œæ€§é•è¦
    â””â”€â”€ UA-VL2: ä¾‹å¤–æ€§é•è¦
```

**å° rootcause-mcp çš„æ„ç¾©ï¼š**
- æä¾›**æ¨™æº–åŒ–åˆ†é¡ä»£ç¢¼**ï¼Œç¢ºä¿å› ç´ åˆ†é¡ä¸€è‡´æ€§
- å¼·åˆ¶è€ƒæ…®å››å€‹å±¤ç´šï¼Œé¿å…åªçœ‹è¡¨é¢åŸå› 
- å¯ä½œç‚º `rc_add_cause` çš„ `hfacs_code` åƒæ•¸é¸é …

### 2.3 Fishbone Diagramï¼ˆé­šéª¨åœ–ï¼‰- è‡¨åºŠ 6M ç‰ˆ

**ä¾†æºï¼š** 
- åŸå§‹: Ishikawa, K. (1968). å“è³ªç®¡ç†
- è‡¨åºŠç‰ˆ: æ•´åˆ ASQ æŒ‡å¼•èˆ‡é†«ç™‚å“è³ªæ–‡ç»

**å‚³çµ± 6M èˆ‡è‡¨åºŠ 6M å°ç…§ï¼š**

| å‚³çµ± 6M | è‡¨åºŠ 6M | èªªæ˜ | ç¯„ä¾‹ |
| ------ | ------- | ---- | ---- |
| Man | **äººå“¡ (Personnel)** | äººå“¡èƒ½åŠ›ã€ç‹€æ…‹ã€è¡Œç‚º | è¨“ç·´ä¸è¶³ã€ç–²å‹ã€æºé€šå¤±èª¤ |
| Machine | **è¨­å‚™ (Equipment)** | é†«ç™‚è¨­å‚™ã€è³‡è¨Šç³»çµ± | å„€å™¨æ•…éšœã€ç³»çµ±ç•¶æ©Ÿã€è­¦å ±å¤±æ•ˆ |
| Material | **ç‰©æ–™ (Material)** | è—¥å“ã€è€—æã€è¡€å“ | è—¥å“éæœŸã€è€—æç¼ºè²¨ã€è¡€å‹éŒ¯èª¤ |
| Method | **æµç¨‹ (Process)** | SOPã€äº¤æ¥ã€æ ¸å°æµç¨‹ | æµç¨‹ä¸æ˜ã€äº¤æ¥ä¸å…¨ã€æŸ¥æ ¸éºæ¼ |
| Milieu | **ç’°å¢ƒ (Environment)** | å·¥ä½œç’°å¢ƒã€äººåŠ›é…ç½® | å™ªéŸ³å¹²æ“¾ã€äººåŠ›ä¸è¶³ã€ç©ºé–“æ“æ“  |
| Measurement | **ç›£æ¸¬ (Monitoring)** | é è­¦ç³»çµ±ã€å“è³ªæŒ‡æ¨™ | æŒ‡æ¨™æœªè¿½è¹¤ã€é è­¦æœªè¨­å®šã€ç•°å¸¸æœªé€šå ± |

**é­šéª¨åœ–çµæ§‹ï¼š**

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    Personnel â”€â”€â”€â”€â”€â”€â”¤             â”‚
                    â”‚             â”‚
    Equipment â”€â”€â”€â”€â”€â”€â”¤             â”‚
                    â”‚             â”‚
    Material  â”€â”€â”€â”€â”€â”€â”¤  å•é¡Œ/äº‹ä»¶  â”‚â”€â”€â”€â”€â”€â”€â–¶ çµæœ
                    â”‚  (é­šé ­)     â”‚
    Process   â”€â”€â”€â”€â”€â”€â”¤             â”‚
                    â”‚             â”‚
    Environment â”€â”€â”€â”€â”¤             â”‚
                    â”‚             â”‚
    Monitoring â”€â”€â”€â”€â”€â”¤             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å° rootcause-mcp çš„æ„ç¾©ï¼š**
- 6M ä½œç‚º `category` åƒæ•¸çš„å›ºå®šé¸é …
- æ¯å€‹å¤§éª¨ä¸‹å¯æœ‰å¤šå±¤å°éª¨ï¼ˆsub-causesï¼‰
- åŒ¯å‡ºæ™‚å¯è½‰æ›ç‚º Mermaid æˆ–çµæ§‹åŒ– JSON

### 2.4 å› æœæ¨è«–ç†è«–

**æ ¸å¿ƒæ¡†æ¶ï¼š** Judea Pearl çš„å› æœéšæ¢¯ (Ladder of Causation)

**ä¾†æºï¼š** Pearl, J. (2009). Causality: Models, Reasoning, and Inference. Cambridge University Press.

```
Level 3: åäº‹å¯¦ (Counterfactuals)
         "å¦‚æœç•¶æ™‚ X ä¸ç™¼ç”Ÿï¼ŒY æœƒæ€æ¨£ï¼Ÿ"
         â†‘
Level 2: ä»‹å…¥ (Intervention)  
         "å¦‚æœæˆ‘å€‘æ”¹è®Š Xï¼ŒY æœƒå¦‚ä½•è®ŠåŒ–ï¼Ÿ"
         â†‘
Level 1: è§€å¯Ÿ/é—œè¯ (Association)
         "X å’Œ Y æ˜¯å¦ç›¸é—œï¼Ÿ"
```

**å› æœé©—è­‰çš„ä¸‰å€‹å¿…è¦æ¢ä»¶ï¼š**

| æ¢ä»¶ | èªªæ˜ | rootcause-mcp æª¢æŸ¥æ–¹å¼ |
| ---- | ---- | ---------------------- |
| **æ™‚åºæ€§ (Temporality)** | åŸå› å¿…é ˆå…ˆæ–¼çµæœç™¼ç”Ÿ | æª¢æŸ¥ timestamp |
| **ç›¸é—œæ€§ (Association)** | åŸå› èˆ‡çµæœå­˜åœ¨çµ±è¨ˆé—œè¯ | è‹¥æœ‰æ•¸æ“šå¯è¨ˆç®—ç›¸é—œä¿‚æ•¸ |
| **éè™›å‡æ€§ (Non-spuriousness)** | æ’é™¤æ··æ·†å› å­çš„å½±éŸ¿ | é‚è¼¯ä¸€è‡´æ€§æª¢æŸ¥ |

**åäº‹å¯¦æ¨ç†åœ¨ RCA ä¸­çš„æ‡‰ç”¨ï¼š**

```
å•é¡Œï¼šã€Œè—¥ç‰©éé‡æ˜¯å¦å°è‡´ç—…äººæ­»äº¡ï¼Ÿã€

åäº‹å¯¦å•é¡Œï¼šã€Œå¦‚æœè—¥ç‰©åŠ‘é‡æ­£ç¢ºï¼Œç—…äººæ˜¯å¦æœƒå­˜æ´»ï¼Ÿã€

åˆ¤æ–·ä¾æ“šï¼š
1. è‹¥ç­”æ¡ˆç‚ºã€Œæ˜¯ã€â†’ è—¥ç‰©éé‡æ˜¯æ ¹æœ¬åŸå› 
2. è‹¥ç­”æ¡ˆç‚ºã€Œä¸ä¸€å®šã€â†’ å¯èƒ½æœ‰å…¶ä»–åŸå› 
3. è‹¥ç­”æ¡ˆç‚ºã€Œå¦ã€â†’ è—¥ç‰©éé‡ä¸æ˜¯ä¸»å› 
```

**å° rootcause-mcp çš„æ„ç¾©ï¼š**
- `rc_verify_causation` éœ€æª¢æŸ¥æ™‚åºæ€§
- `rc_check_consistency` éœ€æª¢æŸ¥é‚è¼¯ä¸€è‡´æ€§
- æœªä¾†å¯æ•´åˆ DoWhy é€²è¡Œçµ±è¨ˆé©—è­‰ï¼ˆPhase 3+ï¼‰

---

## 3. ç³»çµ±æ¶æ§‹

### 3.1 æ¶æ§‹ç¸½è¦½

```mermaid
graph TB
    subgraph "External Systems"
        AGENT[AI Agent / LLM]
        HHRAG[HyperHierarchicalRAG]
        CGU[Creativity Generation Unit]
    end
    
    subgraph "rootcause-mcp Server"
        subgraph "Flow Engine"
            FE[Stage Controller]
            FV[Stage Validator]
        end
        
        subgraph "Causal Engine"
            CV[Causation Verifier]
            CC[Consistency Checker]
        end
        
        subgraph "Fishbone Engine"
            FM[Fishbone Manager]
            FX[Fishbone Exporter]
        end
        
        SS[(Session Store)]
    end
    
    AGENT -->|"rc_start_session"| FE
    AGENT -->|"rc_execute_stage"| FE
    FE --> FV
    FE --> SS
    
    AGENT -->|"rc_verify_causation"| CV
    AGENT -->|"rc_check_consistency"| CC
    
    AGENT -->|"rc_add_cause"| FM
    FM --> FX
    FX -->|"Mermaid/JSON"| AGENT
    
    AGENT <-->|"rc_request_knowledge"| HHRAG
    AGENT <-->|"rc_request_creativity"| CGU
```

### 3.2 rootcause-mcp æ ¸å¿ƒè·è²¬

#### 3.2.1 Flow Engineï¼ˆæµç¨‹å¼•æ“ï¼‰

**åŠŸèƒ½ï¼š** å¼·åˆ¶ RCA æµç¨‹èµ°å®Œ 6 å€‹éšæ®µï¼Œç¢ºä¿åˆ†æå®Œæ•´æ€§

- ç®¡ç† Session ç”Ÿå‘½é€±æœŸ
- é©—è­‰æ¯å€‹éšæ®µçš„å¿…è¦è¼¸å…¥
- æ§åˆ¶éšæ®µè½‰æ›æ¢ä»¶
- è¨˜éŒ„å®Œæ•´æ¨è«–è»Œè·¡

#### 3.2.2 Causal Engineï¼ˆå› æœå¼•æ“ï¼‰

**åŠŸèƒ½ï¼š** é©—è­‰å› æœé—œä¿‚çš„é‚è¼¯ä¸€è‡´æ€§

- æ™‚åºæª¢æŸ¥ï¼ˆåŸå› å¿…é ˆå…ˆæ–¼çµæœï¼‰
- é‚è¼¯ä¸€è‡´æ€§æª¢æŸ¥ï¼ˆä¸çŸ›ç›¾ï¼‰
- å»ºè­°éºæ¼çš„å¯èƒ½å› ç´ 
- åäº‹å¯¦æ¨ç†æ”¯æ´

#### 3.2.3 Fishbone Engineï¼ˆé­šéª¨åœ–å¼•æ“ï¼‰

**åŠŸèƒ½ï¼š** ç®¡ç†é­šéª¨åœ–çš„å»ºæ§‹èˆ‡è¼¸å‡º

- åˆå§‹åŒ–é­šéª¨åœ–ï¼ˆè¨­å®šå•é¡Œ/é­šé ­ï¼‰
- æ–°å¢/ä¿®æ”¹åŸå› ç¯€é»
- 6M åˆ†é¡ç®¡ç†
- åŒ¯å‡ºç‚º Mermaid / JSON / Markdown

### 3.3 èˆ‡å¤–éƒ¨ MCP å”ä½œæ¨¡å¼

#### 3.3.1 èˆ‡ HyperHierarchicalRAG å”ä½œ

```
å ´æ™¯ï¼šåˆ†æéç¨‹ä¸­éœ€è¦æª¢ç´¢ç›¸é—œçŸ¥è­˜æˆ–ç›¸ä¼¼æ¡ˆä¾‹

rootcause Agent                     HHRAG
 â”‚                                    â”‚
 â”‚  rc_request_knowledge              â”‚
 â”‚  {                                 â”‚
 â”‚    "query": "ä½è¡€å£“è™•ç½®æŒ‡å¼•",      â”‚
 â”‚    "context": "è¡“ä¸­å‡ºè¡€"           â”‚
 â”‚  }                                 â”‚
 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                                    â”‚ è¶…åœ–æ“´å±•æª¢ç´¢
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
 â”‚  {                                 â”‚
 â”‚    "results": [...],              â”‚
 â”‚    "related_entities": [...]      â”‚
 â”‚  }                                 â”‚
```

#### 3.3.2 èˆ‡ Creativity-Generation-Unit å”ä½œ

```
å ´æ™¯ï¼šé­šéª¨åœ–æŸåˆ†æ”¯éœ€è¦ç™¼æ•£æ€è€ƒæ›´å¤šå¯èƒ½åŸå› 

rootcause Agent                     CGU
 â”‚                                    â”‚
 â”‚  rc_request_creativity             â”‚
 â”‚  {                                 â”‚
 â”‚    "method": "fishbone",           â”‚
 â”‚    "topic": "è¡“å¾Œä½è¡€å£“",           â”‚
 â”‚    "category": "Method"            â”‚
 â”‚  }                                 â”‚
 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                                    â”‚ ç™¼æ•£æ€è€ƒ
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
 â”‚  {                                 â”‚
 â”‚    "ideas": [                     â”‚
 â”‚      "è¼¸æ¶²é€Ÿåº¦ä¸è¶³",              â”‚
 â”‚      "è¡€ç®¡å¼µåŠ›è—¥ç‰©å»¶é²",          â”‚
 â”‚      ...                          â”‚
 â”‚    ]                              â”‚
 â”‚  }                                 â”‚
```

### 3.4 Session ç‹€æ…‹ç®¡ç†

```
Session Lifecycle:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    start     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  IDLE   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ ACTIVE  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                        â”‚                        â”‚
       â–¼                        â–¼                        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ GATHER  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚CONTEXT- â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ANALYZE  â”‚
  â”‚         â”‚            â”‚ UALIZE  â”‚            â”‚         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚                        â”‚
       â”‚                        â”‚                        â”‚
       â–¼                        â–¼                        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚FISHBONE â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ VERIFY  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ ACTION  â”‚
  â”‚         â”‚            â”‚         â”‚            â”‚         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                                     â”‚
                                                     â–¼
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚ COMPLETE â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Session åŒ…å«ï¼š**
- `session_id`: å”¯ä¸€è­˜åˆ¥ç¢¼
- `case_type`: RCA é¡å‹ï¼ˆdeath/complication/near_miss/safety/staffingï¼‰
- `current_stage`: ç•¶å‰éšæ®µ
- `stage_records`: å„éšæ®µè¨˜éŒ„
- `fishbone`: é­šéª¨åœ–è³‡æ–™
- `created_at` / `updated_at`: æ™‚é–“æˆ³

---

## 4. RCA æµç¨‹å¼•æ“

**è¨­è¨ˆåƒè€ƒï¼š** [thinking-protocol-mcp](https://github.com/RimGit-N/thinking-protocol-mcp) çš„å¼·åˆ¶æµç¨‹æ¨¡å¼

> **è¨­è¨ˆç†å¿µï¼š** Agent å·²æœ‰ ReAct ç­‰æ€è€ƒéˆèƒ½åŠ›ï¼Œrootcause-mcp æä¾›æ›´å¥½çš„ reasoning å·¥å…·ï¼Œè€Œéå–ä»£ Agent çš„æ€è€ƒã€‚

### 4.1 å…­éšæ®µæµç¨‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GATHER  â”‚â”€â”€â”€â–¶â”‚ CONTEXTUALIZE â”‚â”€â”€â”€â–¶â”‚ ANALYZE  â”‚
â”‚ äº‹å¯¦æ”¶é›†  â”‚    â”‚   è„ˆçµ¡åˆ†æ     â”‚    â”‚ æ ¹å› åˆ†æ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FISHBONE â”‚â”€â”€â”€â–¶â”‚  VERIFY  â”‚â”€â”€â”€â–¶â”‚  ACTION  â”‚
â”‚ é­šéª¨çµæ§‹åŒ– â”‚    â”‚ å› æœé©—è­‰  â”‚    â”‚ æ”¹å–„æªæ–½  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éšæ®µèªªæ˜ï¼š**

| éšæ®µ | æ ¸å¿ƒä»»å‹™ | ç”¢å‡º | Agent è§’è‰² |
|------|----------|------|------------|
| GATHER | æ”¶é›†å®¢è§€äº‹å¯¦ | æ™‚é–“ç·šã€è³‡æ–™ä¾†æº | åŸå­åŒ–è¼¸å…¥è³‡æ–™ |
| CONTEXTUALIZE | æ‰¾æ›´é«˜éšæ¦‚å¿µ | ç³»çµ±å› ç´ ã€HFACS åˆ†é¡ | å¯å‘¼å« HMEM/RAG æ“´å±• |
| ANALYZE | **æ ¸å¿ƒåˆ†æéšæ®µ** | æ ¹å› å‡è¨­ã€å› æœéˆ | ReAct reasoning |
| FISHBONE | çµæ§‹åŒ–å‘ˆç¾ | 6M é­šéª¨åœ– | çµ„ç¹”åˆ†æçµæœ |
| VERIFY | é©—è­‰å› æœé—œä¿‚ | é©—è­‰å ±å‘Š | ç¢ºèªé‚è¼¯æ­£ç¢º |
| ACTION | åˆ¶å®šæ”¹å–„æªæ–½ | SMART æªæ–½æ¸…å–® | ç”¢å‡ºå¯è¡Œå‹•æ–¹æ¡ˆ |

### 4.2 å„éšæ®µè©³ç´°å®šç¾©

#### Stage 1: GATHERï¼ˆäº‹å¯¦æ”¶é›†ï¼‰

**ç›®çš„ï¼š** æ”¶é›†èˆ‡äº‹ä»¶ç›¸é—œçš„æ‰€æœ‰å®¢è§€äº‹å¯¦ï¼Œå»ºç«‹æ™‚é–“ç·š

**å¿…è¦è¼¸å…¥ (required_keys)ï¼š**

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
| ---- | ---- | ---- |
| `event_summary` | string | äº‹ä»¶ç°¡è¿°ï¼ˆä¸€å¥è©±ï¼‰ |
| `timeline` | array | æ™‚é–“ç·šäº‹ä»¶åˆ—è¡¨ |
| `data_sources` | array | è³‡æ–™ä¾†æºæ¸…å–® |

**timeline å…ƒç´ çµæ§‹ï¼š**

```json
{
  "timestamp": "2026-01-15T08:30:00Z",
  "description": "ç—…äººåˆ°é”æ€¥è¨º",
  "source": "æ€¥è¨ºè­·ç†ç´€éŒ„",
  "actor": "æ€¥è¨ºè­·ç†å¸«"
}
```

**é©—è­‰è¦å‰‡ï¼š**

- `timeline` è‡³å°‘éœ€æœ‰ 3 å€‹äº‹ä»¶
- æ¯å€‹äº‹ä»¶å¿…é ˆæœ‰ `timestamp` å’Œ `description`
- `event_summary` ä¸å¾—è¶…é 200 å­—å…ƒ

**éšæ®µç”¢å‡ºï¼š**

- å®Œæ•´æ™‚é–“ç·š
- é—œéµäººå“¡æ¸…å–®
- å¾…é‡æ¸…å•é¡Œæ¸…å–®

---

#### Stage 2: CONTEXTUALIZEï¼ˆè„ˆçµ¡åˆ†æï¼‰

> **è„ˆçµ¡å»ºæ§‹ï¼š** æ­¤éšæ®µå»ºç«‹äº‹ä»¶çš„ç³»çµ±æ€§è„ˆçµ¡æ¡†æ¶ã€‚å¯ä½¿ç”¨ HMEM (Human-Machine-Environment-Management) ç­‰æ¨¡å‹é€²è¡Œçµæ§‹åŒ–åˆ†æï¼Œç‚ºå¾ŒçºŒçš„æ ¹å› åˆ†æå¥ å®šåŸºç¤ã€‚

**ç›®çš„ï¼š** åˆ†æäº‹ä»¶ç™¼ç”Ÿçš„ç³»çµ±æ€§è„ˆçµ¡ï¼Œè­˜åˆ¥ç’°å¢ƒå› ç´ èˆ‡æ›´é«˜éšçš„ç³»çµ±é¢å‘

**å¿…è¦è¼¸å…¥ (required_keys)ï¼š**

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
| ---- | ---- | ---- |
| `system_factors` | array | ç³»çµ±æ€§å› ç´ åˆ—è¡¨ |
| `environmental_context` | object | ç’°å¢ƒè„ˆçµ¡ |
| `stakeholders` | array | ç›¸é—œäººå“¡èˆ‡è§’è‰² |
| `contextual_framework` | string | ä½¿ç”¨çš„è„ˆçµ¡åˆ†ææ¡†æ¶ (é¸å¡«ï¼Œå¦‚ "HMEM", "SEIPS") |

**system_factors å…ƒç´ çµæ§‹ï¼š**
```json
{
  "factor": "ç•¶æ—¥äººåŠ›é…ç½®",
  "status": "è­·ç—…æ¯” 1:12ï¼Œé«˜æ–¼æ¨™æº–",
  "hfacs_level": "Level 2",
  "relevance": "high"
}
```

**environmental_context çµæ§‹ï¼š**
```json
{
  "workload": "high",
  "shift": "night",
  "staffing_ratio": "1:12",
  "equipment_status": "normal",
  "recent_changes": ["æ–°ç³»çµ±ä¸Šç·šä¸€é€±"]
}
```

**é©—è­‰è¦å‰‡ï¼š**
- `system_factors` è‡³å°‘éœ€è­˜åˆ¥ 2 å€‹å› ç´ 
- å¿…é ˆæ¶µè“‹ HFACS Level 2-4 è‡³å°‘ä¸€é …
- `stakeholders` éœ€åˆ—å‡ºä¸»è¦ç•¶äº‹äºº

**éšæ®µç”¢å‡ºï¼š**
- ç³»çµ±æ€§å› ç´ åˆ†æ
- HFACS åˆæ­¥åˆ†é¡
- è„ˆçµ¡æ‘˜è¦

---

#### Stage 3: ANALYZEï¼ˆæ ¹å› åˆ†æï¼‰

> **æ ¸å¿ƒéšæ®µï¼š** é€™æ˜¯ RCA çš„æ ¸å¿ƒåˆ†æéšæ®µã€‚Agent ä½¿ç”¨ ReAct æˆ–å…¶ä»–æ€è€ƒéˆé€²è¡Œ reasoningï¼Œrootcause-mcp æä¾›çµæ§‹åŒ–å·¥å…·è¼”åŠ©ã€‚

**ç›®çš„ï¼š** åˆ†ææ ¹æœ¬åŸå› èˆ‡è²¢ç»å› ç´ ï¼Œå»ºç«‹å› æœå‡è¨­

**å¿…è¦è¼¸å…¥ (required_keys)ï¼š**

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
| ---- | ---- | ---- |
| `primary_cause` | object | ä¸»è¦æ ¹æœ¬åŸå›  |
| `contributing_factors` | array | è²¢ç»å› ç´ åˆ—è¡¨ |
| `causal_chain` | array | å› æœéˆæè¿° |

**primary_cause çµæ§‹ï¼š**

```json
{
  "description": "è—¥ç‰©åŠ‘é‡è¨ˆç®—éŒ¯èª¤",
  "hfacs_code": "UA-ER1",
  "evidence": ["è™•æ–¹ç®‹è¨˜éŒ„", "è—¥å±€èª¿åŠ‘ç´€éŒ„"],
  "confidence": "high"
}
```

**causal_chain çµæ§‹ï¼ˆå› æœéˆï¼‰ï¼š**
```json
[
  {
    "sequence": 1,
    "cause": "äººåŠ›ä¸è¶³å°è‡´æŸ¥æ ¸æ™‚é–“å£“ç¸®",
    "effect": "è—¥å¸«æœªå®Œæ•´æ ¸å°åŠ‘é‡"
  },
  {
    "sequence": 2,
    "cause": "è—¥å¸«æœªå®Œæ•´æ ¸å°åŠ‘é‡",
    "effect": "éŒ¯èª¤åŠ‘é‡è—¥ç‰©é€è‡³ç—…æˆ¿"
  },
  {
    "sequence": 3,
    "cause": "éŒ¯èª¤åŠ‘é‡è—¥ç‰©é€è‡³ç—…æˆ¿",
    "effect": "ç—…äººæ¥å—éé‡è—¥ç‰©"
  }
]
```

**é©—è­‰è¦å‰‡ï¼š**
- `primary_cause` å¿…é ˆæœ‰ `evidence` æ”¯æŒ
- `causal_chain` è‡³å°‘ 2 å€‹ç’°ç¯€
- å› æœéˆå¿…é ˆç¬¦åˆæ™‚åºæ€§ï¼ˆå‰å› åœ¨å‰ï¼‰

**éšæ®µç”¢å‡ºï¼š**
- æ ¹æœ¬åŸå› å‡è¨­
- å› æœéˆæ¨¡å‹
- è­‰æ“šå°ç…§è¡¨

---

#### Stage 4: FISHBONEï¼ˆé­šéª¨çµæ§‹åŒ–ï¼‰

**ç›®çš„ï¼š** å°‡è­˜åˆ¥çš„åŸå› çµæ§‹åŒ–ç‚º 6M é­šéª¨åœ–

**å¿…è¦è¼¸å…¥ (required_keys)ï¼š**

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
| ---- | ---- | ---- |
| `problem_statement` | string | é­šé ­ï¼ˆå•é¡Œé™³è¿°ï¼‰ |
| `causes_by_category` | object | ä¾ 6M åˆ†é¡çš„åŸå›  |

**causes_by_category çµæ§‹ï¼š**
```json
{
  "Personnel": [
    {
      "cause": "è—¥å¸«ç¶“é©—ä¸è¶³",
      "sub_causes": ["æ–°é€²äººå“¡", "è¨“ç·´æ™‚æ•¸ä¸è¶³"],
      "hfacs_code": "PC-PF3",
      "evidence": ["äººäº‹è³‡æ–™"]
    }
  ],
  "Process": [
    {
      "cause": "åŠ‘é‡æ ¸å°æµç¨‹ä¸å®Œæ•´",
      "sub_causes": ["ç„¡é›™é‡æŸ¥æ ¸æ©Ÿåˆ¶"],
      "hfacs_code": "OI-OP1",
      "evidence": ["SOP æ–‡ä»¶"]
    }
  ],
  "Environment": [
    {
      "cause": "äººåŠ›é…ç½®ä¸è¶³",
      "sub_causes": ["è­·ç—…æ¯”éé«˜", "è—¥å¸«çŸ­ç¼º"],
      "hfacs_code": "OI-RM1",
      "evidence": ["æ’ç­è¡¨"]
    }
  ]
}
```

**é©—è­‰è¦å‰‡ï¼š**
- `problem_statement` å¿…å¡«
- è‡³å°‘éœ€æ¶µè“‹ 3 å€‹ 6M åˆ†é¡
- æ¯å€‹ cause å»ºè­°æœ‰ `hfacs_code` å°ç…§

**éšæ®µç”¢å‡ºï¼š**
- å®Œæ•´é­šéª¨åœ–çµæ§‹
- 6M åˆ†é¡åŸå› æ¸…å–®
- Mermaid è¦–è¦ºåŒ–ä»£ç¢¼

---

#### Stage 5: VERIFYï¼ˆå› æœé©—è­‰ï¼‰

**ç›®çš„ï¼š** é©—è­‰å› æœé—œä¿‚çš„é‚è¼¯æ­£ç¢ºæ€§

**å¿…è¦è¼¸å…¥ (required_keys)ï¼š**

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
| ---- | ---- | ---- |
| `verification_results` | array | é©—è­‰çµæœåˆ—è¡¨ |
| `counterfactual_analysis` | object | åäº‹å¯¦åˆ†æ |
| `consistency_check` | object | ä¸€è‡´æ€§æª¢æŸ¥çµæœ |

**verification_results å…ƒç´ çµæ§‹ï¼š**
```json
{
  "cause": "è—¥ç‰©åŠ‘é‡è¨ˆç®—éŒ¯èª¤",
  "effect": "ç—…äººè—¥ç‰©éé‡",
  "temporality_check": {
    "passed": true,
    "cause_time": "2026-01-15T09:00:00Z",
    "effect_time": "2026-01-15T10:30:00Z"
  },
  "logic_check": {
    "passed": true,
    "reasoning": "åŠ‘é‡éŒ¯èª¤ç›´æ¥å°è‡´çµ¦è—¥éé‡ï¼Œå› æœé—œä¿‚æ˜ç¢º"
  }
}
```

**counterfactual_analysis çµæ§‹ï¼š**
```json
{
  "question": "è‹¥è—¥ç‰©åŠ‘é‡æ­£ç¢ºï¼Œç—…äººæ˜¯å¦æœƒç™¼ç”Ÿä¸è‰¯åæ‡‰ï¼Ÿ",
  "answer": "unlikely",
  "confidence": "high",
  "reasoning": "ç—…äººç„¡å…¶ä»–å¯è§£é‡‹ä¸è‰¯åæ‡‰çš„å› ç´ "
}
```

**é©—è­‰è¦å‰‡ï¼š**
- æ¯å€‹ `causal_chain` ç’°ç¯€éƒ½éœ€é©—è­‰
- æ™‚åºæ€§æª¢æŸ¥ä¸é€šéå‰‡æ¨™è¨˜ `REJECTED`
- åäº‹å¯¦åˆ†æéœ€å›ç­”æ ¸å¿ƒå•é¡Œ

**éšæ®µç”¢å‡ºï¼š**
- é©—è­‰é€šéçš„å› æœé—œä¿‚
- è¢«é§å›çš„å‡è¨­ï¼ˆå«ç†ç”±ï¼‰
- ä¿®æ­£å¾Œçš„å› æœæ¨¡å‹

---

#### Stage 6: ACTIONï¼ˆæ”¹å–„æªæ–½ï¼‰

**ç›®çš„ï¼š** æå‡ºé‡å°æ ¹æœ¬åŸå› çš„æ”¹å–„æªæ–½èˆ‡é é˜²ç­–ç•¥

**å¿…è¦è¼¸å…¥ (required_keys)ï¼š**

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
| ---- | ---- | ---- |
| `action_items` | array | æ”¹å–„æªæ–½åˆ—è¡¨ |
| `prevention_strategy` | object | é é˜²ç­–ç•¥ |
| `monitoring_plan` | object | ç›£æ¸¬è¨ˆç•« |

**action_items å…ƒç´ çµæ§‹ï¼š**
```json
{
  "action_id": "ACT-001",
  "description": "å»ºç«‹è—¥ç‰©åŠ‘é‡é›™é‡æŸ¥æ ¸æ©Ÿåˆ¶",
  "target_cause": "åŠ‘é‡æ ¸å°æµç¨‹ä¸å®Œæ•´",
  "hfacs_code": "OI-OP1",
  "priority": "high",
  "owner": "è—¥åŠ‘éƒ¨ä¸»ä»»",
  "deadline": "2026-02-15",
  "success_criteria": "100% é«˜è­¦è¨Šè—¥ç‰©å®Œæˆé›™é‡æŸ¥æ ¸"
}
```

**prevention_strategy çµæ§‹ï¼š**
```json
{
  "short_term": ["ç«‹å³å¢åŠ è—¥å¸«äººåŠ›æ”¯æ´", "é«˜è­¦è¨Šè—¥ç‰©å…¨é¢é›™æ ¸"],
  "medium_term": ["ä¿®è¨‚è—¥ç‰©æŸ¥æ ¸ SOP", "å»ºç«‹åŠ‘é‡è¨ˆç®—è¼”åŠ©ç³»çµ±"],
  "long_term": ["å°å…¥è—¥ç‰©å®‰å…¨è³‡è¨Šç³»çµ±", "å®šæœŸè—¥ç‰©å®‰å…¨ç¨½æ ¸"],
  "swiss_cheese_layers": ["Process", "Equipment", "Monitoring"]
}
```

**é©—è­‰è¦å‰‡ï¼š**
- æ¯å€‹ `primary_cause` è‡³å°‘å°æ‡‰ä¸€å€‹ `action_item`
- `action_items` éœ€æœ‰æ˜ç¢º `owner` å’Œ `deadline`
- `prevention_strategy` éœ€æ¶µè“‹çŸ­ä¸­é•·æœŸ

**éšæ®µç”¢å‡ºï¼š**
- æ”¹å–„æªæ–½æ¸…å–®ï¼ˆå«è² è²¬äººã€æœŸé™ï¼‰
- é é˜²ç­–ç•¥ï¼ˆçŸ­ä¸­é•·æœŸï¼‰
- ç›£æ¸¬æŒ‡æ¨™èˆ‡è¿½è¹¤è¨ˆç•«

---

### 4.3 éšæ®µè½‰æ›è¦å‰‡

**è½‰æ›æ¢ä»¶è¡¨ï¼š**

| å¾ | åˆ° | è½‰æ›æ¢ä»¶ |
| --- | --- | -------- |
| START | GATHER | Session å»ºç«‹æˆåŠŸ |
| GATHER | CONTEXTUALIZE | `timeline` â‰¥ 3 é …ã€`event_summary` éç©º |
| CONTEXTUALIZE | ANALYZE | `system_factors` â‰¥ 2 é …ã€`stakeholders` éç©º |
| ANALYZE | FISHBONE | `primary_cause` æœ‰è­‰æ“šã€`causal_chain` â‰¥ 2 ç’°ç¯€ |
| FISHBONE | VERIFY | `causes_by_category` æ¶µè“‹ â‰¥ 3 å€‹ 6M åˆ†é¡ |
| VERIFY | ACTION | æ‰€æœ‰å› æœé—œä¿‚é€šéæ™‚åºæ€§æª¢æŸ¥ |
| ACTION | COMPLETE | æ¯å€‹æ ¹å› æœ‰å°æ‡‰æ”¹å–„æªæ–½ã€æœ‰ç›£æ¸¬è¨ˆç•« |

**å…è¨±çš„å›é€€ï¼š**

```
VERIFY â†’ ANALYZE    ï¼ˆç™¼ç¾å› æœé‚è¼¯éŒ¯èª¤ï¼Œéœ€é‡æ–°åˆ†æï¼‰
VERIFY â†’ FISHBONE    ï¼ˆéœ€è£œå……éºæ¼åŸå› ï¼‰
ACTION â†’ VERIFY      ï¼ˆç™¼ç¾æ”¹å–„æªæ–½ç„¡æ³•å°æ‡‰åŸå› ï¼‰
```

**ä¸å…è¨±çš„è·³èºï¼š**
- ä¸å¯è·³é FISHBONE ç›´æ¥åˆ° ACTION
- ä¸å¯è·³é VERIFY ç›´æ¥åˆ° ACTION
- ä¸å¯å¾ GATHER ç›´æ¥åˆ° ANALYZE

---

## 5. è³‡æ–™çµæ§‹å®šç¾©

æœ¬ç¯€å®šç¾© rootcause-mcp çš„æ ¸å¿ƒè³‡æ–™çµæ§‹ï¼Œæ¡ç”¨ TypeScript é¢¨æ ¼çš„å‹åˆ¥å®šç¾©ã€‚

### 5.1 RCA Session

```typescript
interface RCASession {
  // è­˜åˆ¥è³‡è¨Š
  session_id: string;          // UUID, e.g., "rc_sess_a1b2c3d4"
  case_type: CaseType;         // RCA é¡å‹
  
  // ç‹€æ…‹
  current_stage: Stage;        // ç•¶å‰éšæ®µ
  status: SessionStatus;       // ç‹€æ…‹
  
  // å…§å®¹
  stage_records: StageRecord[];   // å„éšæ®µè¨˜éŒ„
  fishbone: FishboneStructure | null;  // é­šéª¨åœ–
  
  // å…ƒè³‡æ–™
  created_at: string;          // ISO 8601 timestamp
  updated_at: string;          // ISO 8601 timestamp
  created_by: string;          // å»ºç«‹è€…è­˜åˆ¥
}

type CaseType = 
  | "death"          // æ­»äº¡æ¡ˆä¾‹
  | "complication"   // ä½µç™¼ç—‡
  | "near_miss"      // Near Miss
  | "safety"         // ç—…å®‰äº‹ä»¶
  | "staffing";      // äººåŠ›å•é¡Œ

type Stage = 
  | "GATHER"
  | "CONTEXTUALIZE"
  | "ANALYZE"
  | "FISHBONE"
  | "VERIFY"
  | "ACTION";

type SessionStatus = 
  | "active"         // é€²è¡Œä¸­
  | "completed"      // å·²å®Œæˆ
  | "abandoned";     // å·²æ”¾æ£„
```

### 5.2 Stage Record

```typescript
interface StageRecord {
  stage: Stage;                    // éšæ®µåç¨±
  status: StageStatus;             // éšæ®µç‹€æ…‹
  data: StageData;                 // éšæ®µè³‡æ–™ (ä¾éšæ®µä¸åŒ)
  validation_result: ValidationResult;  // é©—è­‰çµæœ
  started_at: string;              // é–‹å§‹æ™‚é–“
  completed_at: string | null;     // å®Œæˆæ™‚é–“
}

type StageStatus = 
  | "not_started"
  | "in_progress"
  | "completed"
  | "failed";

interface ValidationResult {
  passed: boolean;
  errors: string[];
  warnings: string[];
}

// å„éšæ®µç‰¹å®šè³‡æ–™çµæ§‹
type StageData = 
  | GatherData 
  | ContextualizeData 
  | AnalyzeData 
  | FishboneData 
  | VerifyData 
  | ActionData;
```

**å„éšæ®µ StageData å®šç¾©ï¼š**

```typescript
// Stage 1: GATHER
interface GatherData {
  event_summary: string;
  timeline: TimelineEvent[];
  data_sources: string[];
  key_personnel: string[];
  pending_questions: string[];
}

interface TimelineEvent {
  timestamp: string;
  description: string;
  source: string;
  actor?: string;
}

// Stage 2: CONTEXTUALIZE
interface ContextualizeData {
  system_factors: SystemFactor[];
  environmental_context: EnvironmentalContext;
  stakeholders: Stakeholder[];
}

interface SystemFactor {
  factor: string;
  status: string;
  hfacs_level: HFACSLevel;
  relevance: "high" | "medium" | "low";
}

interface EnvironmentalContext {
  workload: "high" | "normal" | "low";
  shift: "day" | "evening" | "night";
  staffing_ratio?: string;
  equipment_status: string;
  recent_changes: string[];
}

interface Stakeholder {
  name: string;
  role: string;
  involvement: string;
}

// Stage 3: ANALYZE
interface AnalyzeData {
  primary_cause: PrimaryCause;
  contributing_factors: ContributingFactor[];
  causal_chain: CausalChainLink[];
}

interface PrimaryCause {
  description: string;
  hfacs_code: string;
  evidence: string[];
  confidence: "high" | "medium" | "low";
}

interface ContributingFactor {
  description: string;
  hfacs_code?: string;
  relationship_to_primary: string;
}

interface CausalChainLink {
  sequence: number;
  cause: string;
  effect: string;
  evidence?: string;
}

// Stage 4: FISHBONE
interface FishboneData {
  problem_statement: string;
  causes_by_category: CausesByCategory;
}

// Stage 5: VERIFY
interface VerifyData {
  verification_results: VerificationResult[];
  counterfactual_analysis: CounterfactualAnalysis;
  consistency_check: ConsistencyCheck;
}

interface VerificationResult {
  cause: string;
  effect: string;
  temporality_check: TemporalityCheck;
  logic_check: LogicCheck;
  overall_passed: boolean;
}

interface TemporalityCheck {
  passed: boolean;
  cause_time?: string;
  effect_time?: string;
  reason?: string;
}

interface LogicCheck {
  passed: boolean;
  reasoning: string;
}

interface CounterfactualAnalysis {
  question: string;
  answer: "likely" | "unlikely" | "uncertain";
  confidence: "high" | "medium" | "low";
  reasoning: string;
}

interface ConsistencyCheck {
  passed: boolean;
  contradictions: string[];
  missing_links: string[];
}

// Stage 6: ACTION
interface ActionData {
  action_items: ActionItem[];
  prevention_strategy: PreventionStrategy;
  monitoring_plan: MonitoringPlan;
}

interface ActionItem {
  action_id: string;
  description: string;
  target_cause: string;
  hfacs_code?: string;
  priority: "high" | "medium" | "low";
  owner: string;
  deadline: string;
  success_criteria: string;
  status: "pending" | "in_progress" | "completed";
}

interface PreventionStrategy {
  short_term: string[];
  medium_term: string[];
  long_term: string[];
  swiss_cheese_layers: string[];
}

interface MonitoringPlan {
  metrics: MetricDefinition[];
  review_schedule: string;
  escalation_criteria: string;
}

interface MetricDefinition {
  name: string;
  target: string;
  measurement_method: string;
  frequency: string;
}
```

### 5.3 Fishbone Structure

```typescript
interface FishboneStructure {
  fishbone_id: string;
  problem_statement: string;       // é­šé ­
  categories: FishboneCategory[];  // 6M å¤§éª¨
  created_at: string;
  updated_at: string;
}

interface FishboneCategory {
  category: FishboneCategoryType;  // 6M åˆ†é¡
  causes: FishboneCause[];         // è©²åˆ†é¡ä¸‹çš„åŸå› 
}

type FishboneCategoryType = 
  | "Personnel"      // äººå“¡
  | "Equipment"      // è¨­å‚™
  | "Material"       // ç‰©æ–™
  | "Process"        // æµç¨‹
  | "Environment"    // ç’°å¢ƒ
  | "Monitoring";    // ç›£æ¸¬

interface FishboneCause {
  // === Level 1: å¿…å¡«ï¼ˆè‡ªç„¶èªè¨€å„ªå…ˆï¼‰===
  cause_id: string;
  description: string;             // åŸå› æè¿°ï¼ˆè‡ªç„¶èªè¨€ï¼Œå¿…å¡«ï¼‰
  category: FishboneCategoryType;  // 6M åˆ†é¡ï¼ˆå¿…å¡«ï¼‰
  
  // === Level 2: ç³»çµ±å»ºè­°ï¼ˆAgent ç¢ºèªï¼‰===
  hfacs_code?: string;             // HFACS å°ç…§ä»£ç¢¼ï¼ˆç³»çµ±å»ºè­°ï¼ŒAgent å¯ä¿®æ”¹ï¼‰
  hfacs_confidence?: number;       // ç³»çµ±å»ºè­°çš„ä¿¡å¿ƒåº¦ 0.0-1.0
  
  // === Level 3: é¸å¡«é€²éš ===
  sub_causes: FishboneCause[];     // å­åŸå› ï¼ˆéè¿´çµæ§‹ï¼Œæ”¯æ´å¤šå±¤ï¼‰
  evidence: string[];              // æ”¯æŒè­‰æ“š
  confidence?: number;             // æ­¤åŸå› çš„æ•´é«”ä¿¡å¿ƒåº¦ 0.0-1.0
  verified: boolean;               // æ˜¯å¦å·²é€šéå› æœé©—è­‰
  
  // === å…ƒè³‡æ–™ ===
  depth: number;                   // å±¤æ•¸ï¼ˆå¾é­šé ­ç®—èµ·ï¼Œ1-5ï¼‰
  created_at: string;
  updated_at: string;
}

// é­šéª¨åœ–é…ç½®
interface FishboneConfig {
  max_depth: number;               // æœ€å¤§å±¤æ•¸ï¼ˆé è¨­ 3ï¼Œæœ€å¤š 5ï¼‰
  require_evidence_at_depth: number;  // å¹¾å±¤å¾Œéœ€è¦è­‰æ“šï¼ˆé è¨­ 2ï¼‰
  auto_suggest_hfacs: boolean;     // æ˜¯å¦è‡ªå‹•å»ºè­° HFACSï¼ˆé è¨­ trueï¼‰
}
```

**Fishbone JSON ç¯„ä¾‹ï¼š**

```json
{
  "fishbone_id": "fb_001",
  "problem_statement": "ç—…äººè¡“å¾Œç™¼ç”Ÿè—¥ç‰©éé‡ä¸è‰¯åæ‡‰",
  "categories": [
    {
      "category": "Personnel",
      "causes": [
        {
          "cause_id": "c_001",
          "description": "è—¥å¸«ç¶“é©—ä¸è¶³",
          "sub_causes": ["æ–°é€²äººå“¡ï¼ˆåˆ°è·3å€‹æœˆï¼‰", "é«˜è­¦è¨Šè—¥ç‰©è¨“ç·´æœªå®Œæˆ"],
          "hfacs_code": "PC-PF3",
          "evidence": ["äººäº‹è³‡æ–™", "è¨“ç·´ç´€éŒ„"],
          "verified": true
        }
      ]
    },
    {
      "category": "Process",
      "causes": [
        {
          "cause_id": "c_002",
          "description": "è—¥ç‰©åŠ‘é‡æ ¸å°æµç¨‹ç¼ºå¤±",
          "sub_causes": ["ç„¡é›™é‡æŸ¥æ ¸æ©Ÿåˆ¶", "ç„¡ç³»çµ±è¼”åŠ©è¨ˆç®—"],
          "hfacs_code": "OI-OP1",
          "evidence": ["SOPæ–‡ä»¶", "ç³»çµ±åŠŸèƒ½æ¸…å–®"],
          "verified": true
        }
      ]
    },
    {
      "category": "Environment",
      "causes": [
        {
          "cause_id": "c_003",
          "description": "è—¥å¸«äººåŠ›é…ç½®ä¸è¶³",
          "sub_causes": ["ç•¶æ—¥åƒ…1ä½è—¥å¸«å€¼ç­", "è™•æ–¹é‡è¶…éè² è·"],
          "hfacs_code": "OI-RM1",
          "evidence": ["æ’ç­è¡¨", "è™•æ–¹é‡çµ±è¨ˆ"],
          "verified": true
        }
      ]
    }
  ],
  "created_at": "2026-01-15T10:00:00Z",
  "updated_at": "2026-01-15T14:30:00Z"
}
```

### 5.4 HFACS Code Reference

```typescript
type HFACSLevel = "Level 1" | "Level 2" | "Level 3" | "Level 4";

interface HFACSCode {
  code: string;
  level: HFACSLevel;
  category: string;
  subcategory: string;
  description: string;
}

// å®Œæ•´ HFACS-MES ä»£ç¢¼è¡¨è¦‹é™„éŒ„ A
const HFACS_CODES: HFACSCode[] = [
  // Level 4: çµ„ç¹”å½±éŸ¿
  { code: "OI-RM1", level: "Level 4", category: "è³‡æºç®¡ç†", subcategory: "äººåŠ›è³‡æº", description: "äººåŠ›è³‡æºä¸è¶³" },
  { code: "OI-RM2", level: "Level 4", category: "è³‡æºç®¡ç†", subcategory: "è²¡å‹™è³‡æº", description: "è²¡å‹™è³‡æºé™åˆ¶" },
  { code: "OI-RM3", level: "Level 4", category: "è³‡æºç®¡ç†", subcategory: "è¨­å‚™è³‡æº", description: "è¨­å‚™è³‡æºä¸è¶³" },
  // ... å…¶é¤˜è¦‹é™„éŒ„ A
];
```

---

## 6. MCP Tools å®šç¾©

æœ¬ç¯€å®šç¾© rootcause-mcp å°å¤–æš´éœ²çš„æ‰€æœ‰ Toolsï¼Œéµå¾ª MCP å”å®šè¦ç¯„ã€‚

### 6.0 Tools è¨­è¨ˆåŸå‰‡ï¼šAgent å‹å–„

> **æ ¸å¿ƒç†å¿µï¼šä¸æœƒç”¨çš„ Tools = å¤±æ•—çš„å°ˆæ¡ˆ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent å‹å–„ Tools è¨­è¨ˆåŸå‰‡                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. å‘½åç›´è¦ºåŒ–                                                  â”‚
â”‚     â”œâ”€â”€ ä½¿ç”¨ CRUD å‹•è©ï¼šcreate/get/update/delete/list           â”‚
â”‚     â”œâ”€â”€ è³‡æºåç¨±æ¸…æ¥šï¼šsession/cause/bone/action                 â”‚
â”‚     â””â”€â”€ ç¯„ä¾‹ï¼šrc_create_cause, rc_get_session, rc_list_causes   â”‚
â”‚                                                                 â”‚
â”‚  2. åƒæ•¸æœ€å°åŒ–                                                  â”‚
â”‚     â”œâ”€â”€ å¿…å¡«åƒæ•¸ â‰¤ 3 å€‹                                         â”‚
â”‚     â”œâ”€â”€ æœ‰åˆç†é è¨­å€¼                                            â”‚
â”‚     â””â”€â”€ è¤‡é›œåƒæ•¸ç”¨ object åŒ…è£                                  â”‚
â”‚                                                                 â”‚
â”‚  3. è¿”å›å€¼è³‡è¨Šè±å¯Œ                                              â”‚
â”‚     â”œâ”€â”€ æ°¸é åŒ…å« success: boolean                               â”‚
â”‚     â”œâ”€â”€ å¤±æ•—æ™‚æœ‰ error_code + message                           â”‚
â”‚     â”œâ”€â”€ æˆåŠŸæ™‚åŒ…å« next_action å»ºè­°                             â”‚
â”‚     â””â”€â”€ åŒ…å« agent_guidance æŒ‡å¼• Agent ä¸‹ä¸€æ­¥                   â”‚
â”‚                                                                 â”‚
â”‚  4. éŒ¯èª¤è¨Šæ¯å¯è¡Œå‹•                                              â”‚
â”‚     â”œâ”€â”€ ä¸åªèªªã€Œå¤±æ•—ã€ï¼Œè¦èªªã€Œç‚ºä»€éº¼ã€å’Œã€Œæ€éº¼ä¿®ã€              â”‚
â”‚     â””â”€â”€ å»ºè­°å…·é«”çš„ä¿®å¾©æ­¥é©Ÿ                                      â”‚
â”‚                                                                 â”‚
â”‚  5. æ¯å€‹å¯¦é«”éƒ½æœ‰å®Œæ•´ CRUD                                       â”‚
â”‚     â”œâ”€â”€ Session: start/get/list/archive/delete                  â”‚
â”‚     â”œâ”€â”€ Cause: create/get/list/update/delete/link               â”‚
â”‚     â”œâ”€â”€ Bone: create/get/list/update/delete                     â”‚
â”‚     â””â”€â”€ Action: create/get/list/update/delete                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.1 Tools ç¸½è¦½

| é¡åˆ¥ | Tool åç¨± | åŠŸèƒ½ | CRUD |
|------|-----------|------|------|
| **Session** | `rc_start_session` | å»ºç«‹æ–° Session | Create |
| | `rc_get_session` | å–å¾— Session è©³æƒ… | Read |
| | `rc_list_sessions` | åˆ—å‡ºæ‰€æœ‰ Sessions | Read |
| | `rc_archive_session` | æ­¸æª” Session | Update |
| | `rc_delete_session` | åˆªé™¤ Session | Delete |
| **Stage** | `rc_execute_stage` | åŸ·è¡Œ/æäº¤éšæ®µ | Create |
| | `rc_get_stage` | å–å¾—éšæ®µè³‡æ–™ | Read |
| | `rc_rollback_stage` | å›é€€éšæ®µ | Update |
| **Cause** | `rc_create_cause` | æ–°å¢åŸå›  | Create |
| | `rc_get_cause` | å–å¾—åŸå› è©³æƒ… | Read |
| | `rc_list_causes` | åˆ—å‡ºæ‰€æœ‰åŸå›  | Read |
| | `rc_update_cause` | æ›´æ–°åŸå›  | Update |
| | `rc_delete_cause` | åˆªé™¤åŸå›  | Delete |
| | `rc_link_causes` | å»ºç«‹å› æœé—œä¿‚ | Create |
| **Fishbone** | `rc_init_fishbone` | åˆå§‹åŒ–é­šéª¨åœ– | Create |
| | `rc_create_bone` | æ–°å¢é­šéª¨ | Create |
| | `rc_get_fishbone` | å–å¾—é­šéª¨åœ– | Read |
| | `rc_update_bone` | æ›´æ–°é­šéª¨ | Update |
| | `rc_delete_bone` | åˆªé™¤é­šéª¨ | Delete |
| | `rc_export_fishbone` | åŒ¯å‡ºé­šéª¨åœ– | Read |
| **Verification** | `rc_verify_causation` | é©—è­‰å› æœé—œä¿‚ | Create |
| | `rc_check_consistency` | æª¢æŸ¥ä¸€è‡´æ€§ | Read |
| | `rc_check_hfacs_coverage` | æª¢æŸ¥ HFACS è¦†è“‹ | Read |
| **Action** | `rc_create_action` | æ–°å¢æ”¹å–„æªæ–½ | Create |
| | `rc_get_action` | å–å¾—æªæ–½è©³æƒ… | Read |
| | `rc_list_actions` | åˆ—å‡ºæ‰€æœ‰æªæ–½ | Read |
| | `rc_update_action` | æ›´æ–°æªæ–½ | Update |
| | `rc_delete_action` | åˆªé™¤æªæ–½ | Delete |
| **Quality** | `rc_evaluate_quality` | è©•ä¼° RCA å“è³ª | Read |
| | `rc_suggest_missing` | å»ºè­°éºæ¼é …ç›® | Read |
| **Utility** | `rc_export_report` | åŒ¯å‡º RCA å ±å‘Š | Read |
| | `rc_get_6m_hfacs_mapping` | å–å¾— 6M-HFACS å°ç…§ | Read |

---

### 6.2 è¿”å›å€¼æ¨™æº–çµæ§‹

**æ‰€æœ‰ Tools è¿”å›å€¼éƒ½åŒ…å«ä»¥ä¸‹æ¨™æº–æ¬„ä½ï¼š**

```json
{
  // === æ¨™æº–æ¬„ä½ ===
  "success": true,
  "error_code": null,
  "message": "æ“ä½œæˆåŠŸ",
  
  // === è³‡æ–™æ¬„ä½ï¼ˆä¾ Tool ä¸åŒï¼‰===
  "data": { ... },
  
  // === Agent æŒ‡å¼•æ¬„ä½ ===
  "agent_guidance": {
    "next_actions": ["å»ºè­°çš„ä¸‹ä¸€æ­¥æ“ä½œ"],
    "warnings": ["éœ€è¦æ³¨æ„çš„äº‹é …"],
    "tips": ["æç¤ºè³‡è¨Š"]
  },
  
  // === è³‡æ–™å“è³ªå ±å‘Šï¼ˆé©ç”¨æ–¼ stage é¡ Toolsï¼‰===
  "data_quality_report": {
    "completeness_score": 75,
    "missing_items": ["ç¼ºå°‘çš„è³‡æ–™é …ç›®"],
    "improvement_suggestions": ["æ”¹å–„å»ºè­°"],
    "rag_query_hints": ["å»ºè­°æŸ¥è©¢ RAG çš„é—œéµå­—"]
  }
}
```

**éŒ¯èª¤è¿”å›æ¨™æº–ï¼š**

```json
{
  "success": false,
  "error_code": "INVALID_STAGE_TRANSITION",
  "message": "ç„¡æ³•å¾ GATHER è·³åˆ° VERIFYï¼Œå¿…é ˆå…ˆå®Œæˆä¸­é–“éšæ®µ",
  
  "agent_guidance": {
    "how_to_fix": "è«‹å…ˆå®Œæˆ CONTEXTUALIZE å’Œ ANALYZE éšæ®µ",
    "current_stage": "GATHER",
    "required_next": "CONTEXTUALIZE"
  }
}
```

---

### 6.3 æµç¨‹æ§åˆ¶é¡ Tools

#### `rc_start_session`

**åŠŸèƒ½ï¼š** å»ºç«‹æ–°çš„ RCA åˆ†æ Session

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `case_type` | enum | âœ“ | RCA é¡å‹ï¼š`death` / `complication` / `near_miss` / `safety` / `staffing` |
| `case_title` | string | âœ“ | æ¡ˆä¾‹æ¨™é¡Œ |
| `initial_description` | string | âœ— | æ¡ˆä¾‹åˆæ­¥æè¿° |

**å›å‚³ï¼š**

```json
{
  "success": true,
  "session_id": "rc_sess_a1b2c3d4",
  "case_type": "death",
  "current_stage": "GATHER",
  "message": "Session å»ºç«‹æˆåŠŸï¼Œè«‹é–‹å§‹æ”¶é›†äº‹å¯¦è³‡æ–™"
}
```

**ä½¿ç”¨ç¯„ä¾‹ï¼š**

```json
// Request
{
  "tool": "rc_start_session",
  "arguments": {
    "case_type": "death",
    "case_title": "è¡“å¾Œ24å°æ™‚å…§éé æœŸæ­»äº¡æ¡ˆä¾‹",
    "initial_description": "65æ­²ç”·æ€§ï¼Œæ¥å—è…¹è…”é¡è†½å›Šåˆ‡é™¤è¡“ï¼Œè¡“å¾Œ12å°æ™‚ç™¼ç¾å¿ƒè·³åœæ­¢"
  }
}
```

---

#### `rc_execute_stage`

**åŠŸèƒ½ï¼š** åŸ·è¡ŒæŒ‡å®šéšæ®µï¼Œæäº¤è©²éšæ®µçš„è³‡æ–™

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |
| `stage` | enum | âœ“ | éšæ®µåç¨±ï¼š`GATHER` / `CONTEXTUALIZE` / `ANALYZE` / `FISHBONE` / `VERIFY` / `ACTION` |
| `data` | object | âœ“ | éšæ®µè³‡æ–™ï¼ˆä¾éšæ®µä¸åŒï¼Œåƒè¦‹ Section 4ï¼‰ |

**å›å‚³ï¼š**

```json
{
  "success": true,
  "stage": "GATHER",
  "validation": {
    "passed": true,
    "errors": [],
    "warnings": ["å»ºè­°è£œå……æ›´å¤šæ™‚é–“ç·šç´°ç¯€"]
  },
  "next_stage": "CONTEXTUALIZE",
  "message": "GATHER éšæ®µå®Œæˆï¼Œå¯é€²å…¥ CONTEXTUALIZE"
}
```

**é©—è­‰å¤±æ•—å›å‚³ï¼š**

```json
{
  "success": false,
  "stage": "GATHER",
  "validation": {
    "passed": false,
    "errors": [
      "timeline è‡³å°‘éœ€è¦ 3 å€‹äº‹ä»¶ï¼Œç›®å‰åªæœ‰ 1 å€‹",
      "event_summary ç‚ºç©º"
    ],
    "warnings": []
  },
  "next_stage": null,
  "message": "GATHER éšæ®µé©—è­‰å¤±æ•—ï¼Œè«‹è£œå……å¿…è¦è³‡æ–™"
}
```

---

#### `rc_get_session_status`

**åŠŸèƒ½ï¼š** å–å¾— Session ç•¶å‰ç‹€æ…‹

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |

**å›å‚³ï¼š**

```json
{
  "session_id": "rc_sess_a1b2c3d4",
  "case_type": "death",
  "case_title": "è¡“å¾Œ24å°æ™‚å…§éé æœŸæ­»äº¡æ¡ˆä¾‹",
  "status": "active",
  "current_stage": "ANALYZE",
  "stage_progress": {
    "GATHER": "completed",
    "CONTEXTUALIZE": "completed",
    "ANALYZE": "in_progress",
    "FISHBONE": "not_started",
    "VERIFY": "not_started",
    "ACTION": "not_started"
  },
  "created_at": "2026-01-15T10:00:00Z",
  "updated_at": "2026-01-15T14:30:00Z"
}
```

---

#### `rc_rollback_stage`

**åŠŸèƒ½ï¼š** å›é€€åˆ°å‰ä¸€éšæ®µï¼ˆç•¶ç™¼ç¾éœ€è¦ä¿®æ­£æ™‚ï¼‰

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |
| `target_stage` | enum | âœ“ | ç›®æ¨™éšæ®µï¼ˆå¿…é ˆæ˜¯å·²å®Œæˆçš„éšæ®µï¼‰ |
| `reason` | string | âœ“ | å›é€€åŸå›  |

**å›å‚³ï¼š**

```json
{
  "success": true,
  "previous_stage": "VERIFY",
  "current_stage": "ANALYZE",
  "message": "å·²å›é€€åˆ° ANALYZE éšæ®µï¼ŒåŸå› ï¼šç™¼ç¾å› æœéˆæœ‰éºæ¼ç’°ç¯€",
  "preserved_data": ["GATHER", "CONTEXTUALIZE"],
  "cleared_data": ["ANALYZE", "FISHBONE", "VERIFY"]
}
```

**é™åˆ¶ï¼š**
- åªèƒ½å›é€€åˆ°å…è¨±çš„éšæ®µï¼ˆè¦‹ Section 4.3ï¼‰
- å›é€€æœƒæ¸…é™¤ç›®æ¨™éšæ®µåŠä¹‹å¾Œçš„è³‡æ–™

---

### 6.2 å› æœæ¨è«–é¡ Tools

#### `rc_verify_causation`

**åŠŸèƒ½ï¼š** é©—è­‰å…©å€‹äº‹ä»¶ä¹‹é–“çš„å› æœé—œä¿‚ï¼ˆæ•´åˆ Counterfactual Testing Frameworkï¼‰

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |
| `cause` | object | âœ“ | åŸå› äº‹ä»¶ |
| `effect` | object | âœ“ | çµæœäº‹ä»¶ |
| `verification_level` | enum | âœ— | é©—è­‰æ·±åº¦ï¼š`standard`ï¼ˆé è¨­ï¼‰/ `comprehensive` |

**verification_level èªªæ˜ï¼š**

| Level | åŸ·è¡Œæ¸¬è©¦ | èªªæ˜ | é©ç”¨å ´æ™¯ |
| ----- | -------- | ---- | -------- |
| `standard` | æ™‚åº + å¿…è¦æ€§ | å¿«é€Ÿé©—è­‰ï¼ˆé è¨­ï¼‰ | ä¸€èˆ¬ RCAã€å¿«é€Ÿç¢ºèª |
| `comprehensive` | å…¨éƒ¨ 4 é …æ¸¬è©¦ | æ·±åº¦åˆ†æ | é‡å¤§äº‹ä»¶ã€æ³•å¾‹ç›¸é—œ |

**Counterfactual Testing Frameworkï¼ˆ4 é …æ¸¬è©¦ï¼‰ï¼š**

| æ¸¬è©¦ | æ ¸å¿ƒå•é¡Œ | å„ªå…ˆé †åº | èªªæ˜ |
| ---- | -------- | -------- | ---- |
| **æ™‚åºæ€§** (Temporality) | åŸå› åœ¨çµæœä¹‹å‰ç™¼ç”Ÿå—ï¼Ÿ | â­å¿…åš | æœ€åŸºæœ¬çš„å› æœæ¢ä»¶ |
| **å¿…è¦æ€§** (Necessity) | æ²’æœ‰é€™å€‹åŸå› ï¼Œçµæœé‚„æœƒç™¼ç”Ÿå—ï¼Ÿ | â­å¿…åš | æ ¸å¿ƒåäº‹å¯¦é©—è­‰ |
| **æ©Ÿåˆ¶æ€§** (Mechanism) | å› æœè·¯å¾‘æœ‰åˆç†æ©Ÿåˆ¶å—ï¼Ÿ | å¯é¸ | é©—è­‰é‚è¼¯åˆç†æ€§ |
| **å……åˆ†æ€§** (Sufficiency) | åªæœ‰é€™å€‹åŸå› ï¼Œçµæœå°±æœƒç™¼ç”Ÿå—ï¼Ÿ | å¯é¸ | é€²éšåˆ†æï¼Œæ’é™¤æ··æ·†å› å­ |

**cause / effect çµæ§‹ï¼š**

```json
{
  "description": "è—¥ç‰©åŠ‘é‡è¨ˆç®—éŒ¯èª¤",
  "timestamp": "2026-01-15T09:00:00Z",
  "evidence": ["è™•æ–¹ç®‹è¨˜éŒ„"]
}
```

**å›å‚³ï¼ˆstandard levelï¼‰ï¼š**

```json
{
  "verification_id": "ver_001",
  "verification_level": "standard",
  "cause": "è—¥ç‰©åŠ‘é‡è¨ˆç®—éŒ¯èª¤",
  "effect": "ç—…äººè—¥ç‰©éé‡",
  "tests": {
    "temporality": {
      "passed": true,
      "cause_time": "2026-01-15T09:00:00Z",
      "effect_time": "2026-01-15T10:30:00Z",
      "time_diff_minutes": 90,
      "conclusion": "æ™‚åºæ­£ç¢ºï¼šåŸå› åœ¨çµæœå‰ 90 åˆ†é˜ç™¼ç”Ÿ"
    },
    "necessity": {
      "passed": true,
      "counterfactual_question": "è‹¥è—¥ç‰©åŠ‘é‡æ­£ç¢ºï¼Œç—…äººæ˜¯å¦æœƒç™¼ç”Ÿè—¥ç‰©éé‡ï¼Ÿ",
      "counterfactual_answer": "unlikely",
      "confidence": 0.85,
      "reasoning": "ç—…äººç„¡å…¶ä»–å¯è§£é‡‹éé‡çš„å› ç´ ï¼ŒåŠ‘é‡éŒ¯èª¤æ˜¯å¿…è¦æ¢ä»¶"
    }
  },
  "overall_result": "VERIFIED",
  "confidence": 0.85,
  "agent_guidance": {
    "interpretation": "å› æœé—œä¿‚é€šéåŸºç¤é©—è­‰",
    "next_steps": ["å¦‚éœ€æ›´é«˜ç¢ºä¿¡åº¦ï¼Œå¯ä½¿ç”¨ comprehensive level é€²è¡Œæ·±åº¦é©—è­‰"]
  }
}
```

**å›å‚³ï¼ˆcomprehensive levelï¼‰ï¼š**

```json
{
  "verification_id": "ver_003",
  "verification_level": "comprehensive",
  "cause": "è—¥ç‰©åŠ‘é‡è¨ˆç®—éŒ¯èª¤",
  "effect": "ç—…äººè—¥ç‰©éé‡",
  "tests": {
    "temporality": {
      "passed": true,
      "cause_time": "2026-01-15T09:00:00Z",
      "effect_time": "2026-01-15T10:30:00Z",
      "time_diff_minutes": 90
    },
    "necessity": {
      "passed": true,
      "counterfactual_question": "è‹¥è—¥ç‰©åŠ‘é‡æ­£ç¢ºï¼Œç—…äººæ˜¯å¦æœƒç™¼ç”Ÿè—¥ç‰©éé‡ï¼Ÿ",
      "counterfactual_answer": "unlikely",
      "confidence": 0.85
    },
    "mechanism": {
      "passed": true,
      "causal_pathway": [
        "åŠ‘é‡è¨ˆç®—éŒ¯èª¤",
        "è™•æ–¹é¡¯ç¤ºéŒ¯èª¤åŠ‘é‡",
        "è—¥å¸«ä¾è™•æ–¹èª¿åŠ‘",
        "è­·ç†å¸«ä¾è™•æ–¹çµ¦è—¥",
        "ç—…äººæ¥å—éé‡è—¥ç‰©"
      ],
      "mechanism_plausibility": "high",
      "domain_knowledge_support": true
    },
    "sufficiency": {
      "passed": false,
      "analysis": "åŠ‘é‡éŒ¯èª¤æœ¬èº«ä¸è¶³ä»¥å°è‡´éé‡ï¼Œé‚„éœ€è¦æŸ¥æ ¸æ©Ÿåˆ¶å¤±æ•ˆ",
      "confounders_identified": ["è—¥å¸«æŸ¥æ ¸æœªç™¼ç¾", "ç³»çµ±æœªè­¦ç¤º"],
      "conclusion": "åŠ‘é‡éŒ¯èª¤æ˜¯å¿…è¦ä½†éå……åˆ†æ¢ä»¶"
    }
  },
  "overall_result": "VERIFIED_WITH_CAVEATS",
  "confidence": 0.78,
  "causal_strength": "contributing_factor",
  "agent_guidance": {
    "interpretation": "ç¢ºèªç‚ºè²¢ç»å› ç´ ï¼Œä½†éå–®ä¸€æ ¹å› ",
    "caveats": ["å……åˆ†æ€§æ¸¬è©¦æœªé€šéï¼Œè¡¨ç¤ºå­˜åœ¨å…¶ä»–å¿…è¦å› ç´ "],
    "recommendation": "å»ºè­°åŒæ™‚åˆ†æé˜²è­·æ©Ÿåˆ¶å¤±æ•ˆï¼ˆè—¥å¸«æŸ¥æ ¸ã€ç³»çµ±è­¦ç¤ºï¼‰"
  }
}
```

**é©—è­‰å¤±æ•—å›å‚³ï¼š**

```json
{
  "verification_id": "ver_002",
  "verification_level": "standard",
  "cause": "ç—…äººéæ•é«”è³ª",
  "effect": "è—¥ç‰©åŠ‘é‡è¨ˆç®—éŒ¯èª¤",
  "tests": {
    "temporality": {
      "passed": false,
      "reason": "ç„¡æ³•å»ºç«‹æ™‚åºé—œä¿‚ï¼šç—…äººé«”è³ªæ˜¯ç‹€æ…‹è€Œéäº‹ä»¶"
    },
    "necessity": {
      "passed": false,
      "reason": "æ™‚åºæ¸¬è©¦æœªé€šéï¼Œè·³éå¿…è¦æ€§æ¸¬è©¦"
    }
  },
  "overall_result": "REJECTED",
  "confidence": 0.95,
  "agent_guidance": {
    "interpretation": "æ­¤é—œä¿‚ä¸æ§‹æˆå› æœ",
    "suggestion": "ç—…äººéæ•é«”è³ªæ‡‰ä½œç‚ºèƒŒæ™¯å› ç´ ï¼ˆContextï¼‰ï¼Œè€Œéç›´æ¥åŸå› ",
    "alternative_framing": "å¯åœ¨ CONTEXTUALIZE éšæ®µè¨˜éŒ„ç‚ºç—…äººç‰¹å¾µ"
  }
}
```

**æŠ€è¡“å¯¦ç¾å‚™è¨»ï¼š**
- æ™‚åºæ€§æ¸¬è©¦ï¼šç´”é‚è¼¯æª¢æŸ¥ï¼Œæ¯”è¼ƒæ™‚é–“æˆ³
- å¿…è¦æ€§æ¸¬è©¦ï¼šä½¿ç”¨ DoWhy-GCM çš„åäº‹å¯¦æ¨è«–ï¼ˆPhase 3+ï¼‰ï¼ŒPhase 1-2 ç”¨è¦å‰‡åˆ¤æ–·
- æ©Ÿåˆ¶æ€§æ¸¬è©¦ï¼šæŸ¥è©¢é ˜åŸŸçŸ¥è­˜åº«ï¼ˆHFACSã€é†«å­¸çŸ¥è­˜ï¼‰é©—è­‰è·¯å¾‘åˆç†æ€§
- å……åˆ†æ€§æ¸¬è©¦ï¼šä½¿ç”¨ causal-learn è­˜åˆ¥æ··æ·†å› å­ï¼ˆPhase 3+ï¼‰ï¼ŒPhase 1-2 ç”¨å•Ÿç™¼å¼è¦å‰‡

---

#### `rc_check_consistency`

**åŠŸèƒ½ï¼š** æª¢æŸ¥æ•´é«”å› æœæ¨¡å‹çš„ä¸€è‡´æ€§

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |

**å›å‚³ï¼š**

```json
{
  "consistency_check": {
    "passed": false,
    "contradictions": [
      {
        "item1": "è—¥å¸«æœ‰å……è¶³æ™‚é–“æ ¸å°",
        "item2": "è—¥å¸«å› æ™‚é–“å£“åŠ›æœªå®Œæ•´æ ¸å°",
        "location": "CONTEXTUALIZE vs ANALYZE",
        "suggestion": "è«‹é‡æ¸…ç•¶æ™‚è—¥å¸«çš„å¯¦éš›å·¥ä½œç‹€æ³"
      }
    ],
    "circular_references": [],
    "missing_links": [
      {
        "gap": "å¾ã€ŒäººåŠ›ä¸è¶³ã€åˆ°ã€Œè—¥ç‰©éŒ¯èª¤ã€ç¼ºå°‘ä¸­é–“ç’°ç¯€",
        "suggestion": "å»ºè­°è£œå……ï¼šäººåŠ›ä¸è¶³â†’æŸ¥æ ¸æ™‚é–“å£“ç¸®â†’æŸ¥æ ¸ä¸å®Œæ•´â†’è—¥ç‰©éŒ¯èª¤"
      }
    ]
  },
  "overall_score": 0.7,
  "recommendation": "è«‹ä¿®æ­£çŸ›ç›¾ä¸¦è£œå……éºæ¼ç’°ç¯€"
}
```

---

#### `rc_suggest_missing`

**åŠŸèƒ½ï¼š** æ ¹æ“š HFACS æ¡†æ¶å»ºè­°å¯èƒ½éºæ¼çš„å› ç´ 

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |
| `focus_area` | enum | âœ— | èšç„¦é ˜åŸŸï¼š`organizational` / `supervision` / `preconditions` / `unsafe_acts` |

**å›å‚³ï¼š**

```json
{
  "current_coverage": {
    "Level 4 (Organizational)": ["OI-RM1"],
    "Level 3 (Supervision)": [],
    "Level 2 (Preconditions)": ["PC-PF1"],
    "Level 1 (Unsafe Acts)": ["UA-ER1"]
  },
  "missing_areas": [
    {
      "level": "Level 3",
      "category": "Supervision",
      "suggestion": "å°šæœªåˆ†æç›£ç£å±¤é¢çš„å› ç´ ",
      "guiding_questions": [
        "ç•¶æ™‚çš„ä¸»ç®¡æ˜¯å¦çŸ¥é“äººåŠ›ä¸è¶³çš„æƒ…æ³ï¼Ÿ",
        "æ˜¯å¦æœ‰é€²è¡Œéé¢¨éšªè©•ä¼°ï¼Ÿ",
        "æ–°é€²è—¥å¸«æ˜¯å¦æœ‰é©ç•¶çš„ç›£ç£æ©Ÿåˆ¶ï¼Ÿ"
      ]
    }
  ],
  "recommended_next_steps": [
    "è¨ªè«‡è—¥åŠ‘éƒ¨ä¸»ç®¡äº†è§£ç›£ç£æ©Ÿåˆ¶",
    "æŸ¥é–±è©²è—¥å¸«çš„ç£å°ç´€éŒ„"
  ]
}
```

---

#### `rc_check_hfacs_coverage`

**åŠŸèƒ½ï¼š** æª¢æŸ¥ HFACS å„å±¤ç´šçš„è¦†è“‹ç‡ï¼Œæé†’ Agent éºæ¼çš„ç³»çµ±æ€§åˆ†æ

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |

**å›å‚³ï¼š**

```json
{
  "coverage_summary": {
    "Level 4 (Organizational)": {
      "codes": ["OI-RM1"],
      "coverage_rate": 0.33,
      "status": "partial"
    },
    "Level 3 (Supervision)": {
      "codes": [],
      "coverage_rate": 0.0,
      "status": "missing"
    },
    "Level 2 (Preconditions)": {
      "codes": ["PC-PF1", "PC-CO2"],
      "coverage_rate": 0.67,
      "status": "good"
    },
    "Level 1 (Unsafe Acts)": {
      "codes": ["UA-ER1"],
      "coverage_rate": 0.25,
      "status": "partial"
    }
  },
  "overall_coverage": 0.42,
  "agent_guidance": {
    "warnings": ["Level 3 (Supervision) å®Œå…¨æ²’æœ‰åˆ†æï¼Œé€™æ˜¯ç³»çµ±æ€§ RCA çš„å¸¸è¦‹ç›²é»"],
    "next_actions": [
      "å»ºè­°è©¢å•ï¼šç•¶æ™‚çš„ç£å°æ©Ÿåˆ¶å¦‚ä½•ï¼Ÿ",
      "å»ºè­°è©¢å•ï¼šä¸»ç®¡æ˜¯å¦çŸ¥é“é¢¨éšªï¼Ÿ"
    ],
    "tips": ["å¥½çš„ RCA é€šå¸¸è‡³å°‘æ¶µè“‹ 3 å€‹ HFACS å±¤ç´š"]
  }
}
```

---

#### `rc_get_6m_hfacs_mapping`

**åŠŸèƒ½ï¼š** å–å¾— 6M é­šéª¨åœ–åˆ†é¡èˆ‡ HFACS ç¢¼çš„å°ç…§é—œä¿‚ï¼Œå”åŠ© Agent é€²è¡Œè·¨æ¡†æ¶åˆ†æ

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `category` | enum | âœ— | æŒ‡å®šåˆ†é¡ï¼Œä¸å¡«å‰‡è¿”å›å…¨éƒ¨ï¼š`Personnel` / `Equipment` / `Material` / `Process` / `Environment` / `Monitoring` |

**å›å‚³ï¼ˆéƒ¨åˆ†ç¯„ä¾‹ï¼‰ï¼š**

```json
{
  "mapping": {
    "Personnel": {
      "hfacs_codes": ["UA-*", "PC-PF*", "PC-CO*"],
      "hfacs_description": "äººå“¡å› ç´ é€šå¸¸å°æ‡‰ HFACS Level 1 (ä¸å®‰å…¨è¡Œç‚º) å’Œ Level 2 (å‰ç½®æ¢ä»¶)",
      "example_mappings": [
        { "cause": "è­·ç†å¸«ç–²å‹", "6m": "Personnel", "hfacs": "PC-PF1 (Adverse Mental States)" },
        { "cause": "é†«å¸«éºæ¼äº¤ç­", "6m": "Personnel", "hfacs": "UA-ER1 (Skill-Based Error)" }
      ]
    },
    "Process": {
      "hfacs_codes": ["US-*", "OI-OP*"],
      "hfacs_description": "æµç¨‹å› ç´ é€šå¸¸å°æ‡‰ HFACS Level 3 (ä¸ç•¶ç£å°) å’Œ Level 4 (çµ„ç¹”å½±éŸ¿)",
      "example_mappings": [
        { "cause": "æŸ¥æ ¸æµç¨‹ä¸å®Œæ•´", "6m": "Process", "hfacs": "US-IO1 (Inadequate Oversight)" },
        { "cause": "SOP æœªæ›´æ–°", "6m": "Process", "hfacs": "OI-OP1 (Operational Planning)" }
      ]
    },
    "Environment": {
      "hfacs_codes": ["PC-PH*", "OI-*"],
      "hfacs_description": "ç’°å¢ƒå› ç´ æ¶µè“‹ç‰©ç†ç’°å¢ƒ (Level 2) å’Œçµ„ç¹”æ–‡åŒ– (Level 4)",
      "example_mappings": [
        { "cause": "ç…§æ˜ä¸è¶³", "6m": "Environment", "hfacs": "PC-PH1 (Physical Environment)" },
        { "cause": "å®‰å…¨æ–‡åŒ–è–„å¼±", "6m": "Environment", "hfacs": "OI-OC1 (Organizational Culture)" }
      ]
    }
  },
  "usage_guidance": "å»ºè­°åœ¨ ANALYZE éšæ®µåŒæ™‚æ¨™è¨˜ 6M åˆ†é¡å’Œ HFACS ç¢¼ï¼Œç¢ºä¿åˆ†æçš„å®Œæ•´æ€§"
}
```

---

### 6.3 é­šéª¨åœ–é¡ Tools

#### `rc_init_fishbone`

**åŠŸèƒ½ï¼š** åˆå§‹åŒ–é­šéª¨åœ–

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |
| `problem_statement` | string | âœ“ | å•é¡Œé™³è¿°ï¼ˆé­šé ­ï¼‰ |

**å›å‚³ï¼š**

```json
{
  "fishbone_id": "fb_001",
  "problem_statement": "ç—…äººè¡“å¾Œç™¼ç”Ÿè—¥ç‰©éé‡ä¸è‰¯åæ‡‰",
  "categories": [
    { "category": "Personnel", "causes": [] },
    { "category": "Equipment", "causes": [] },
    { "category": "Material", "causes": [] },
    { "category": "Process", "causes": [] },
    { "category": "Environment", "causes": [] },
    { "category": "Monitoring", "causes": [] }
  ],
  "message": "é­šéª¨åœ–å·²åˆå§‹åŒ–ï¼Œè«‹ä½¿ç”¨ rc_add_cause æ–°å¢åŸå› "
}
```

---

#### `rc_add_cause`

**åŠŸèƒ½ï¼š** æ–°å¢åŸå› åˆ°é­šéª¨åœ–ï¼ˆæ¼¸é€²å¼è¼¸å…¥ + HFACS è‡ªå‹•å»ºè­°ï¼‰

**è¨­è¨ˆç†å¿µï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¼¸é€²å¼è¼¸å…¥è¨­è¨ˆï¼šé™ä½ Agent è¼¸å…¥é–€æª»                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Level 1ï¼ˆå¿…å¡«ï¼‰ï¼šè‡ªç„¶èªè¨€ + åˆ†é¡                                â”‚
â”‚  â””â”€â”€ description: "è­·ç†å¸«å› ç–²å‹æœªåŠæ™‚ç™¼ç¾ç—…äººä½è¡€å£“"             â”‚
â”‚  â””â”€â”€ category: "Personnel"                                      â”‚
â”‚                                                                 â”‚
â”‚  Level 2ï¼ˆç³»çµ±å»ºè­°ï¼‰ï¼šHFACS ä»£ç¢¼                                 â”‚
â”‚  â””â”€â”€ MCP åˆ†æ description â†’ å»ºè­° hfacs_code                     â”‚
â”‚  â””â”€â”€ Agent å¯æ¥å—ã€ä¿®æ”¹æˆ–å¿½ç•¥                                   â”‚
â”‚                                                                 â”‚
â”‚  Level 3ï¼ˆé¸å¡«ï¼‰ï¼šè­‰æ“šã€å­åŸå› ã€ä¿¡å¿ƒåº¦                           â”‚
â”‚  â””â”€â”€ æ·±å…¥åˆ†ææ™‚è£œå……                                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |
| `category` | enum | âœ“ | 6M åˆ†é¡ï¼š`Personnel` / `Equipment` / `Material` / `Process` / `Environment` / `Monitoring` |
| `description` | string | âœ“ | åŸå› æè¿°ï¼ˆè‡ªç„¶èªè¨€ï¼Œç³»çµ±æœƒåˆ†æä¸¦å»ºè­° HFACSï¼‰ |
| `parent_cause_id` | string | âœ— | çˆ¶åŸå›  IDï¼ˆè‹¥ç‚ºå­åŸå› ï¼‰|
| `hfacs_code` | string | âœ— | HFACS ä»£ç¢¼ï¼ˆå¯è¦†è“‹ç³»çµ±å»ºè­°ï¼‰ |
| `evidence` | array | âœ— | æ”¯æŒè­‰æ“š |
| `confidence` | number | âœ— | ä¿¡å¿ƒåº¦ 0.0-1.0 |

**å›å‚³ï¼ˆå« HFACS å»ºè­°ï¼‰ï¼š**

```json
{
  "success": true,
  "cause_id": "c_001",
  "category": "Personnel",
  "description": "è­·ç†å¸«å› ç–²å‹æœªåŠæ™‚ç™¼ç¾ç—…äººä½è¡€å£“",
  "depth": 1,
  
  "hfacs_suggestion": {
    "suggested_code": "PC-CO1",
    "suggested_name": "ç”Ÿç†ç‹€æ…‹ä¸ä½³",
    "confidence": 0.85,
    "reasoning": "æè¿°æåˆ°ã€ç–²å‹ã€ï¼Œç¬¦åˆ Level 2 äººå“¡ç‹€æ…‹ > ç”Ÿç†ç‹€æ…‹",
    "alternatives": [
      { "code": "PC-CO2", "name": "å¿ƒç†ç‹€æ…‹å•é¡Œ", "confidence": 0.45 },
      { "code": "UA-ER3", "name": "æ„ŸçŸ¥æ€§éŒ¯èª¤", "confidence": 0.40 }
    ]
  },
  
  "agent_guidance": {
    "next_actions": [
      "ç¢ºèª HFACS å»ºè­°æ˜¯å¦æ­£ç¢ºï¼šrc_update_cause(hfacs_code='PC-CO1')",
      "æˆ–é¸æ“‡å…¶ä»–å»ºè­°ï¼šrc_update_cause(hfacs_code='PC-CO2')",
      "æ–°å¢å­åŸå› æ·±å…¥åˆ†æï¼šrc_add_cause(parent_cause_id='c_001', ...)"
    ],
    "tips": [
      "ç›®å‰æ·±åº¦ç‚º 1ï¼Œæœ€å¤šå¯æ–°å¢è‡³ 5 å±¤",
      "å»ºè­°åœ¨ç¬¬ 2 å±¤å¾Œè£œå…… evidence"
    ]
  },
  
  "verified": false,
  "message": "åŸå› å·²æ–°å¢ï¼Œç³»çµ±å»ºè­° HFACS ä»£ç¢¼ PC-CO1ï¼ˆç”Ÿç†ç‹€æ…‹ä¸ä½³ï¼‰ï¼Œè«‹ç¢ºèªæˆ–ä¿®æ”¹"
}
```

**å­åŸå› ç¯„ä¾‹ï¼ˆå¤šå±¤çµæ§‹ï¼‰ï¼š**

```json
// æ–°å¢å­åŸå› 
{
  "tool": "rc_add_cause",
  "arguments": {
    "session_id": "rc_sess_xxx",
    "category": "Personnel",
    "description": "é€£çºŒå€¼ç­è¶…é 16 å°æ™‚",
    "parent_cause_id": "c_001",
    "evidence": ["æ’ç­è¡¨", "æ‰“å¡ç´€éŒ„"]
  }
}

// å›å‚³
{
  "success": true,
  "cause_id": "c_001_1",
  "parent_cause_id": "c_001",
  "depth": 2,
  "description": "é€£çºŒå€¼ç­è¶…é 16 å°æ™‚",
  "hfacs_suggestion": {
    "suggested_code": "US-PI2",
    "suggested_name": "è¶…æ™‚å·¥ä½œå®‰æ’",
    "confidence": 0.92,
    "reasoning": "æè¿°æåˆ°ã€é€£çºŒå€¼ç­è¶…é16å°æ™‚ã€ï¼Œç¬¦åˆ Level 3 ç›£ç£é•è¦ > è¶…æ™‚å·¥ä½œå®‰æ’"
  }
}
```

**å±¤æ•¸é™åˆ¶ï¼š**

| å±¤æ•¸ | èªªæ˜ | å»ºè­° |
| ---- | ---- | ---- |
| 1 | å¤§éª¨ï¼ˆ6M åˆ†é¡ä¸‹çš„ä¸»å› ï¼‰ | å¿…å¡« description + category |
| 2 | ä¸­éª¨ï¼ˆç´°åŒ–åŸå› ï¼‰ | å»ºè­°è£œå…… evidence |
| 3 | å°éª¨ï¼ˆæ›´æ·±å±¤åŸå› ï¼‰ | é è¨­æœ€å¤§å±¤æ•¸ |
| 4-5 | æ¥µç´°åˆ†æ”¯ | éœ€è¦ç†ç”±æ‰èƒ½çªç ´ max_depth |

---

#### `rc_export_fishbone`

**åŠŸèƒ½ï¼š** åŒ¯å‡ºé­šéª¨åœ–

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |
| `format` | enum | âœ“ | è¼¸å‡ºæ ¼å¼ï¼š`mermaid` / `json` / `markdown` |
| `include_evidence` | boolean | âœ— | æ˜¯å¦åŒ…å«è­‰æ“šï¼ˆé è¨­ falseï¼‰ |

**Mermaid æ ¼å¼å›å‚³ï¼š**

```json
{
  "format": "mermaid",
  "content": "graph LR\n  HEAD[ç—…äººè¡“å¾Œç™¼ç”Ÿè—¥ç‰©éé‡ä¸è‰¯åæ‡‰]\n  \n  subgraph Personnel\n    P1[è—¥å¸«ç¶“é©—ä¸è¶³]\n    P1a[æ–°é€²äººå“¡]\n    P1b[è¨“ç·´æœªå®Œæˆ]\n    P1 --> P1a\n    P1 --> P1b\n  end\n  \n  subgraph Process\n    PR1[åŠ‘é‡æ ¸å°æµç¨‹ç¼ºå¤±]\n    PR1a[ç„¡é›™é‡æŸ¥æ ¸]\n    PR1 --> PR1a\n  end\n  \n  subgraph Environment\n    E1[äººåŠ›é…ç½®ä¸è¶³]\n    E1a[åƒ…1ä½è—¥å¸«å€¼ç­]\n    E1 --> E1a\n  end\n  \n  Personnel --> HEAD\n  Process --> HEAD\n  Environment --> HEAD"
}
```

**Markdown æ ¼å¼å›å‚³ï¼š**

```json
{
  "format": "markdown",
  "content": "# é­šéª¨åœ–åˆ†æ\n\n## å•é¡Œï¼šç—…äººè¡“å¾Œç™¼ç”Ÿè—¥ç‰©éé‡ä¸è‰¯åæ‡‰\n\n### äººå“¡ (Personnel)\n- **è—¥å¸«ç¶“é©—ä¸è¶³** [PC-PF3]\n  - æ–°é€²äººå“¡ï¼ˆåˆ°è·3å€‹æœˆï¼‰\n  - é«˜è­¦è¨Šè—¥ç‰©è¨“ç·´æœªå®Œæˆ\n\n### æµç¨‹ (Process)\n- **åŠ‘é‡æ ¸å°æµç¨‹ç¼ºå¤±** [OI-OP1]\n  - ç„¡é›™é‡æŸ¥æ ¸æ©Ÿåˆ¶\n\n### ç’°å¢ƒ (Environment)\n- **äººåŠ›é…ç½®ä¸è¶³** [OI-RM1]\n  - ç•¶æ—¥åƒ…1ä½è—¥å¸«å€¼ç­"
}
```

---

### 6.4 å”ä½œä»‹é¢é¡ Tools

#### `rc_request_knowledge`

**åŠŸèƒ½ï¼š** å‘ HyperHierarchicalRAG è«‹æ±‚çŸ¥è­˜æª¢ç´¢

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |
| `query` | string | âœ“ | æŸ¥è©¢å…§å®¹ |
| `context` | string | âœ— | é¡å¤–è„ˆçµ¡ |
| `knowledge_type` | enum | âœ— | çŸ¥è­˜é¡å‹ï¼š`guideline` / `case` / `literature` / `sop` |

**å›å‚³ï¼š**

```json
{
  "request_id": "req_001",
  "query": "é«˜è­¦è¨Šè—¥ç‰©åŠ‘é‡æ ¸å°æ¨™æº–ä½œæ¥­æµç¨‹",
  "target_mcp": "HyperHierarchicalRAG",
  "status": "forwarded",
  "message": "è«‹æ±‚å·²è½‰ç™¼è‡³ HHRAGï¼Œç­‰å¾…å›æ‡‰"
}
```

**èªªæ˜ï¼š**
æ­¤ Tool ä½œç‚º rootcause-mcp èˆ‡ HHRAG ä¹‹é–“çš„å”ä½œä»‹é¢ã€‚å¯¦éš›æª¢ç´¢ç”± HHRAG åŸ·è¡Œï¼Œrootcause-mcp è² è²¬ï¼š
1. è¨˜éŒ„çŸ¥è­˜è«‹æ±‚ï¼ˆè¿½æº¯æ€§ï¼‰
2. å°‡è«‹æ±‚è„ˆçµ¡åŒ–ï¼ˆé™„åŠ  Session ä¸Šä¸‹æ–‡ï¼‰
3. æ¥æ”¶ä¸¦æ•´åˆå›æ‡‰

---

#### `rc_request_creativity`

**åŠŸèƒ½ï¼š** å‘ Creativity-Generation-Unit è«‹æ±‚å‰µæ„ç™¼æ•£

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |
| `method` | enum | âœ“ | å‰µæ„æ–¹æ³•ï¼š`fishbone` / `5w2h` / `six_hats` / `reverse` / `brainstorm` |
| `topic` | string | âœ“ | ç™¼æ•£ä¸»é¡Œ |
| `category` | string | âœ— | èšç„¦åˆ†é¡ï¼ˆç”¨æ–¼ fishboneï¼‰ |

**å›å‚³ï¼š**

```json
{
  "request_id": "req_002",
  "method": "fishbone",
  "topic": "è¡“å¾Œä½è¡€å£“çš„å¯èƒ½åŸå› ",
  "target_mcp": "CreativityGenerationUnit",
  "status": "forwarded",
  "message": "è«‹æ±‚å·²è½‰ç™¼è‡³ CGUï¼Œç­‰å¾…å›æ‡‰"
}
```

**CGU å›æ‡‰æ•´åˆç¯„ä¾‹ï¼š**

```json
{
  "request_id": "req_002",
  "method": "fishbone",
  "ideas": [
    {
      "category": "Personnel",
      "ideas": ["éº»é†‰æ·±åº¦ç›£æ¸¬ä¸è¶³", "äº¤æ¥è³‡è¨Šä¸å®Œæ•´"]
    },
    {
      "category": "Process", 
      "ideas": ["è¡“å¾Œç›£æ¸¬é »ç‡ä¸è¶³", "è¡€å£“é–¾å€¼è¨­å®šéä½"]
    },
    {
      "category": "Equipment",
      "ideas": ["ç›£æ¸¬å„€è­¦å ±éŸ³é‡ä¸è¶³", "è¼¸æ¶²å¹«æµ¦æµé€Ÿä¸æº–"]
    }
  ],
  "source": "CGU_fishbone_method",
  "suggestion": "å»ºè­°å°‡é€™äº› ideas è©•ä¼°å¾ŒåŠ å…¥é­šéª¨åœ–"
}
```

---

### 6.5 Tools ç¸½è¦½è¡¨

| Tool åç¨± | é¡åˆ¥ | ä¸»è¦åŠŸèƒ½ | å¿…è¦éšæ®µ |
| --------- | ---- | -------- | -------- |
| `rc_start_session` | æµç¨‹æ§åˆ¶ | å»ºç«‹ Session | - |
| `rc_execute_stage` | æµç¨‹æ§åˆ¶ | åŸ·è¡Œ/æäº¤éšæ®µ | ä»»ä½• |
| `rc_get_session_status` | æµç¨‹æ§åˆ¶ | æŸ¥è©¢ç‹€æ…‹ | ä»»ä½• |
| `rc_rollback_stage` | æµç¨‹æ§åˆ¶ | å›é€€éšæ®µ | ä»»ä½• |
| `rc_verify_causation` | å› æœæ¨è«– | é©—è­‰å› æœé—œä¿‚ | VERIFY |
| `rc_check_consistency` | å› æœæ¨è«– | æª¢æŸ¥ä¸€è‡´æ€§ | VERIFY |
| `rc_suggest_missing` | å› æœæ¨è«– | å»ºè­°éºæ¼å› ç´  | ANALYZE+ |
| `rc_init_fishbone` | é­šéª¨åœ– | åˆå§‹åŒ–é­šéª¨åœ– | FISHBONE |
| `rc_add_cause` | é­šéª¨åœ– | æ–°å¢åŸå›  | FISHBONE |
| `rc_export_fishbone` | é­šéª¨åœ– | åŒ¯å‡ºé­šéª¨åœ– | FISHBONE+ |
| `rc_request_knowledge` | å”ä½œä»‹é¢ | è«‹æ±‚çŸ¥è­˜æª¢ç´¢ | ä»»ä½• |
| `rc_request_creativity` | å”ä½œä»‹é¢ | è«‹æ±‚å‰µæ„ç™¼æ•£ | ä»»ä½• |

---

## 7. MCP Prompts å®šç¾©

> **è¨­è¨ˆä¾†æºï¼š** mako10k/mcp-rca çš„ Prompt-based Guidance è¨­è¨ˆ

MCP Prompts ç”¨æ–¼å¼•å° LLM é€²å…¥æ­£ç¢ºçš„åˆ†ææ¨¡å¼ï¼Œæä¾›çµæ§‹åŒ–çš„æŒ‡å°ã€‚

### 7.1 Prompts ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              rootcause-mcp Prompts æµç¨‹å¼•å°                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  rc_start_investigation  â†’ å»ºç«‹ Session + åˆæ­¥è§€å¯Ÿå¼•å°          â”‚
â”‚         â†“                                                       â”‚
â”‚  rc_next_step            â†’ æ ¹æ“šç•¶å‰ç‹€æ…‹å»ºè­°ä¸‹ä¸€æ­¥               â”‚
â”‚         â†“                                                       â”‚
â”‚  rc_stage_checklist      â†’ æä¾›å„éšæ®µå¿…è¦æª¢æŸ¥æ¸…å–®               â”‚
â”‚         â†“                                                       â”‚
â”‚  rc_hypothesis_guide     â†’ å¼•å°ç”¢ç”Ÿå¯æ¸¬è©¦çš„æ ¹å› å‡èªª             â”‚
â”‚         â†“                                                       â”‚
â”‚  rc_verification_guide   â†’ å¼•å°å› æœé©—è­‰æµç¨‹                     â”‚
â”‚         â†“                                                       â”‚
â”‚  rc_conclusion_guide     â†’ å¼•å°çµè«–èˆ‡æ”¹å–„æªæ–½æ’°å¯«               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Prompt è©³ç´°å®šç¾©

#### `rc_start_investigation`

**åŠŸèƒ½ï¼š** å¼•å°é–‹å§‹ RCA èª¿æŸ¥

```python
@mcp.prompt()
async def rc_start_investigation(case_type: str) -> str:
    """å¼•å° LLM é–‹å§‹çµæ§‹åŒ–çš„ RCA èª¿æŸ¥"""
    return f"""
# RCA èª¿æŸ¥å•Ÿå‹•æŒ‡å—

## æ¡ˆä¾‹é¡å‹ï¼š{case_type}

### ç¬¬ä¸€æ­¥ï¼šæ”¶é›†åŸºæœ¬è³‡è¨Š

è«‹æ”¶é›†ä»¥ä¸‹å¿…è¦è³‡è¨Šï¼š

1. **äº‹ä»¶æ‘˜è¦** (200å­—å…§)
   - ä½•æ™‚ç™¼ç”Ÿï¼Ÿ
   - ç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ
   - å½±éŸ¿ç‚ºä½•ï¼Ÿ

2. **æ™‚é–“ç·š** (è‡³å°‘3å€‹äº‹ä»¶)
   - ä½•æ™‚ç™¼ç¾å•é¡Œï¼Ÿ
   - é—œéµæ™‚é–“é»ç‚ºä½•ï¼Ÿ
   - äº‹ä»¶ç™¼å±•é †åºï¼Ÿ

3. **è³‡æ–™ä¾†æº**
   - å“ªäº›ç´€éŒ„å¯æŸ¥é–±ï¼Ÿ
   - èª°å¯ä»¥è¨ªè«‡ï¼Ÿ

### æé†’
- æ­¤éšæ®µåƒ…æ”¶é›†äº‹å¯¦ï¼Œä¸åšæ¨è«–
- ä½¿ç”¨ `rc_start_session` å»ºç«‹ Session
- ä½¿ç”¨ `rc_execute_stage` æäº¤ GATHER éšæ®µ
"""
```

#### `rc_next_step`

**åŠŸèƒ½ï¼š** æ ¹æ“šç•¶å‰ç‹€æ…‹å»ºè­°ä¸‹ä¸€æ­¥

```python
@mcp.prompt()
async def rc_next_step(session_id: str) -> str:
    """æ ¹æ“š Session ç‹€æ…‹å»ºè­°ä¸‹ä¸€æ­¥è¡Œå‹•"""
    # å–å¾— session ç‹€æ…‹
    status = await get_session_status(session_id)
    stage = status["current_stage"]
    
    guidance = {
        "GATHER": "æ”¶é›†å®Œäº‹å¯¦å¾Œï¼Œä½¿ç”¨ rc_execute_stage é€²å…¥ CONTEXTUALIZE",
        "CONTEXTUALIZE": "åˆ†æç³»çµ±è„ˆçµ¡å¾Œï¼Œä½¿ç”¨ rc_execute_stage é€²å…¥ ANALYZE",
        "ANALYZE": "åˆ†ææ ¹å› å¾Œï¼Œä½¿ç”¨ rc_init_fishbone å»ºç«‹é­šéª¨åœ–",
        "FISHBONE": "å®Œæˆé­šéª¨åœ–å¾Œï¼Œä½¿ç”¨ rc_verify_causation é©—è­‰å› æœ",
        "VERIFY": "é©—è­‰é€šéå¾Œï¼Œä½¿ç”¨ rc_execute_stage é€²å…¥ ACTION",
        "ACTION": "å®Œæˆæ”¹å–„æªæ–½å¾Œï¼ŒSession å¯çµæ¡ˆ"
    }
    
    return f"""
# ä¸‹ä¸€æ­¥å»ºè­°

**ç•¶å‰éšæ®µï¼š** {stage}
**å»ºè­°è¡Œå‹•ï¼š** {guidance[stage]}

## æœ¬éšæ®µæª¢æŸ¥æ¸…å–®
{get_stage_checklist(stage)}
"""
```

#### `rc_stage_checklist`

**åŠŸèƒ½ï¼š** æä¾›å„éšæ®µå¿…è¦æª¢æŸ¥æ¸…å–®

```python
@mcp.prompt()
async def rc_stage_checklist(stage: str) -> str:
    """è¿”å›ç‰¹å®šéšæ®µçš„æª¢æŸ¥æ¸…å–®"""
    checklists = {
        "GATHER": """
## GATHER éšæ®µæª¢æŸ¥æ¸…å–®

- [ ] äº‹ä»¶æ‘˜è¦æ˜¯å¦æ¸…æ™°ï¼Ÿ(200å­—å…§)
- [ ] æ™‚é–“ç·šæ˜¯å¦å®Œæ•´ï¼Ÿ(è‡³å°‘3å€‹äº‹ä»¶)
- [ ] æ¯å€‹äº‹ä»¶æ˜¯å¦æœ‰æ™‚é–“æˆ³ï¼Ÿ
- [ ] è³‡æ–™ä¾†æºæ˜¯å¦åˆ—å‡ºï¼Ÿ
- [ ] æ˜¯å¦å€åˆ†ã€Œäº‹å¯¦ã€èˆ‡ã€Œæ¨æ¸¬ã€ï¼Ÿ
""",
        "CONTEXTUALIZE": """
## CONTEXTUALIZE éšæ®µæª¢æŸ¥æ¸…å–®

- [ ] æ˜¯å¦è­˜åˆ¥è‡³å°‘2å€‹ç³»çµ±æ€§å› ç´ ï¼Ÿ
- [ ] æ˜¯å¦æ¶µè“‹ HFACS Level 2-4ï¼Ÿ
- [ ] ç’°å¢ƒè„ˆçµ¡æ˜¯å¦å®Œæ•´ï¼Ÿ(äººåŠ›ã€è² è·ã€ç­åˆ¥)
- [ ] ç›¸é—œäººå“¡æ˜¯å¦åˆ—å‡ºï¼Ÿ
- [ ] æ˜¯å¦æœ‰è¿‘æœŸç³»çµ±è®Šæ›´ï¼Ÿ
""",
        "ANALYZE": """
## ANALYZE éšæ®µæª¢æŸ¥æ¸…å–®

- [ ] ä¸»è¦æ ¹å› æ˜¯å¦æœ‰è­‰æ“šæ”¯æŒï¼Ÿ
- [ ] å› æœéˆæ˜¯å¦è‡³å°‘2å€‹ç’°ç¯€ï¼Ÿ
- [ ] æ˜¯å¦æ‡‰ç”¨5-Whyåˆ†æï¼Ÿ
- [ ] è²¢ç»å› ç´ æ˜¯å¦è­˜åˆ¥ï¼Ÿ
- [ ] æ˜¯å¦å€åˆ†æ ¹å› vsè²¢ç»å› ç´ ï¼Ÿ
""",
        # ... å…¶ä»–éšæ®µ
    }
    return checklists.get(stage, "æœªçŸ¥éšæ®µ")
```

#### `rc_hypothesis_guide`

**åŠŸèƒ½ï¼š** å¼•å°ç”¢ç”Ÿå¯æ¸¬è©¦çš„æ ¹å› å‡èªª

```python
@mcp.prompt()
async def rc_hypothesis_guide() -> str:
    """å¼•å°ç”¢ç”Ÿçµæ§‹åŒ–çš„æ ¹å› å‡èªª"""
    return """
# æ ¹å› å‡èªªç”¢ç”ŸæŒ‡å—

## å‡èªªæ ¼å¼

æ¯å€‹å‡èªªæ‡‰åŒ…å«ï¼š

1. **å‡èªªé™³è¿°**
   - æ¸…æ™°çš„å› æœé—œä¿‚æè¿°
   - å¯æ¸¬è©¦ã€å¯è­‰å½

2. **æ”¯æŒè­‰æ“š**
   - ä¾†æºæ˜ç¢º
   - å¯æŸ¥è­‰

3. **é©—è­‰æ–¹æ³•**
   - å¦‚ä½•æ¸¬è©¦é€™å€‹å‡èªªï¼Ÿ
   - é æœŸçµæœæ˜¯ä»€éº¼ï¼Ÿ

## 5-Why ç¯„ä¾‹

å•é¡Œï¼šç—…äººè—¥ç‰©éé‡
- Why 1: ç‚ºä»€éº¼éé‡ï¼Ÿâ†’ è—¥å¸«è¨ˆç®—éŒ¯èª¤
- Why 2: ç‚ºä»€éº¼è¨ˆç®—éŒ¯èª¤ï¼Ÿâ†’ æœªä½¿ç”¨è¨ˆç®—è¼”åŠ©å·¥å…·
- Why 3: ç‚ºä»€éº¼æœªä½¿ç”¨ï¼Ÿâ†’ ç³»çµ±æ²’æœ‰æ­¤åŠŸèƒ½
- Why 4: ç‚ºä»€éº¼æ²’æœ‰æ­¤åŠŸèƒ½ï¼Ÿâ†’ æœªè¢«ç´å…¥å„ªå…ˆé–‹ç™¼
- Why 5: ç‚ºä»€éº¼æœªå„ªå…ˆï¼Ÿâ†’ é¢¨éšªè©•ä¼°ä¸è¶³

## ä½¿ç”¨æ–¹å¼
ç”¢ç”Ÿå‡èªªå¾Œï¼Œä½¿ç”¨ `rc_verify_causation` é©—è­‰
"""
```

### 7.3 æœ€ä½³å¯¦è¸å¼•å°

#### `rc_best_practices`

```python
@mcp.prompt()
async def rc_best_practices() -> str:
    """RCA æœ€ä½³å¯¦è¸æé†’"""
    return """
# RCA æœ€ä½³å¯¦è¸

## âœ… æ‡‰è©²åšçš„
- èšç„¦ç³»çµ±å•é¡Œï¼Œè€Œéå€‹äººè²¬å‚™
- è¿½æº¯åˆ° HFACS Level 4 (çµ„ç¹”å±¤é¢)
- æ¯å€‹çµè«–éƒ½è¦æœ‰è­‰æ“šæ”¯æŒ
- æ”¹å–„æªæ–½è¦å…·é«”ã€å¯åŸ·è¡Œã€æœ‰è² è²¬äºº

## âŒ é¿å…çš„åæ¨¡å¼
- åœåœ¨è¡¨é¢åŸå›  (ä¾‹å¦‚ã€Œäººç‚ºç–å¤±ã€)
- æ²’æœ‰è­‰æ“šçš„æ¨æ¸¬
- æ”¹å–„æªæ–½éæ–¼ç± çµ± (ä¾‹å¦‚ã€ŒåŠ å¼·å®£å°ã€)
- åªè²¬å‚™ç•¶äº‹äºº

## Swiss Cheese æé†’
äº‹æ•…æ˜¯å¤šå±¤é˜²è­·åŒæ™‚å¤±æ•ˆçš„çµæœï¼Œ
æ”¹å–„æªæ–½æ‡‰æ¶µè“‹å¤šå±¤é˜²è­·ï¼š
- çµ„ç¹”å±¤é¢ (æ”¿ç­–ã€è³‡æº)
- ç›£ç£å±¤é¢ (è¨“ç·´ã€ç›£æ§)
- åŸ·è¡Œå±¤é¢ (æµç¨‹ã€å·¥å…·)
- å€‹äººå±¤é¢ (èƒ½åŠ›ã€ç‹€æ…‹)
"""
```

---

## 8. RCA å“è³ªè©•åˆ†

> **è¨­è¨ˆä¾†æºï¼š** rca-ai-analyst çš„ 5 ç¶­åº¦è©•åˆ†ç³»çµ±

### 8.1 è©•åˆ†æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RCA å“è³ªè©•åˆ†ç³»çµ± (è‡¨åºŠç‰ˆ)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  è¼¸å…¥: RCA Session (æ‰€æœ‰éšæ®µè³‡æ–™)                               â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  5 ç¶­åº¦è©•åˆ† (0-100 åˆ†)                                   â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  1. Factual Completeness    äº‹å¯¦å®Œæ•´æ€§                   â”‚   â”‚
â”‚  â”‚  2. Root Cause Depth        æ ¹å› æ·±åº¦                     â”‚   â”‚
â”‚  â”‚  3. Evidence Strength       è­‰æ“šå¼·åº¦                     â”‚   â”‚
â”‚  â”‚  4. Corrective Action       çŸ¯æ­£æªæ–½å“è³ª                 â”‚   â”‚
â”‚  â”‚  5. Systemic Prevention     ç³»çµ±æ€§é é˜²                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  è¼¸å‡º                                                    â”‚   â”‚
â”‚  â”‚  â”œâ”€ overall_score: 0-100                                â”‚   â”‚
â”‚  â”‚  â”œâ”€ dimension_scores: { ... }                           â”‚   â”‚
â”‚  â”‚  â”œâ”€ strengths: ["...", "..."]                           â”‚   â”‚
â”‚  â”‚  â”œâ”€ gaps: ["...", "..."]                                â”‚   â”‚
â”‚  â”‚  â””â”€ recommendations: ["...", "..."]                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 äº”ç¶­åº¦è©•åˆ†æ¨™æº–

#### ç¶­åº¦ 1: Factual Completeness (äº‹å¯¦å®Œæ•´æ€§)

| åˆ†æ•¸ | æ¨™æº– |
|------|------|
| 90-100 | Timeline å®Œæ•´ (â‰¥5äº‹ä»¶)ã€5W1H é½Šå…¨ã€è³‡æ–™ä¾†æºå¤šå…ƒ |
| 70-89 | Timeline è¶³å¤  (3-4äº‹ä»¶)ã€ä¸»è¦è³‡è¨Šå®Œæ•´ |
| 50-69 | åŸºæœ¬ Timelineã€éƒ¨åˆ†è³‡è¨Šç¼ºå¤± |
| 30-49 | Timeline ä¸å®Œæ•´ã€é‡è¦è³‡è¨Šç¼ºå¤± |
| 0-29 | å¹¾ä¹ç„¡ Timelineã€å¤§é‡è³‡è¨Šç¼ºå¤± |

**æª¢æŸ¥é …ç›®ï¼š**
- Timeline äº‹ä»¶æ•¸é‡
- æ¯å€‹äº‹ä»¶æ˜¯å¦æœ‰æ˜ç¢ºæ™‚é–“æˆ³
- 5W1H (Who/What/When/Where/Why/How) è¦†è“‹ç‡
- è³‡æ–™ä¾†æºæ•¸é‡èˆ‡å¤šæ¨£æ€§

#### ç¶­åº¦ 2: Root Cause Depth (æ ¹å› æ·±åº¦)

| åˆ†æ•¸ | æ¨™æº– |
|------|------|
| 90-100 | 5-Why å®Œæ•´ã€é” HFACS Level 4ã€ç³»çµ±æ€§å› ç´ æ˜ç¢º |
| 70-89 | 4-Whyã€é” HFACS Level 3 |
| 50-69 | 3-Whyã€é” HFACS Level 2 |
| 30-49 | 2-Whyã€åƒ… HFACS Level 1 |
| 0-29 | åœåœ¨è¡¨é¢åŸå› ã€æœªæ·±å…¥åˆ†æ |

**æª¢æŸ¥é …ç›®ï¼š**
- å› æœéˆé•·åº¦
- HFACS å±¤ç´šè¦†è“‹
- æ˜¯å¦æœ‰ç³»çµ±æ€§å› ç´ åˆ†æ
- æ˜¯å¦å€åˆ†æ ¹å› vsè²¢ç»å› ç´ 

#### ç¶­åº¦ 3: Evidence Strength (è­‰æ“šå¼·åº¦)

| åˆ†æ•¸ | æ¨™æº– |
|------|------|
| 90-100 | æ¯å€‹å› æœé—œä¿‚éƒ½æœ‰æ˜ç¢ºè­‰æ“šã€å¤šé‡ä¾†æºäº¤å‰é©—è­‰ |
| 70-89 | ä¸»è¦å› æœé—œä¿‚æœ‰è­‰æ“šã€ä¾†æºæ˜ç¢º |
| 50-69 | éƒ¨åˆ†æœ‰è­‰æ“šã€ä¾†æºä¸å®Œæ•´ |
| 30-49 | è­‰æ“šè–„å¼±ã€å¤šç‚ºæ¨æ¸¬ |
| 0-29 | å¹¾ä¹ç„¡è­‰æ“šæ”¯æŒ |

**æª¢æŸ¥é …ç›®ï¼š**
- evidence æ¬„ä½å¡«å¯«ç‡
- è­‰æ“šä¾†æºå¤šæ¨£æ€§
- å› æœé©—è­‰é€šéç‡
- æ˜¯å¦æœ‰çŸ›ç›¾è¢«æ¨™è¨˜

#### ç¶­åº¦ 4: Corrective Action (çŸ¯æ­£æªæ–½å“è³ª)

| åˆ†æ•¸ | æ¨™æº– |
|------|------|
| 90-100 | SMART åŸå‰‡å®Œæ•´ã€æ¯å€‹æ ¹å› æœ‰å°æ‡‰æªæ–½ã€å„ªå…ˆç´šæ˜ç¢º |
| 70-89 | æªæ–½å…·é«”ã€æœ‰è² è²¬äººå’ŒæœŸé™ |
| 50-69 | æªæ–½è¼ƒç± çµ±ã€éƒ¨åˆ†ç¼ºè² è²¬äºº |
| 30-49 | æªæ–½æ¨¡ç³Šã€ç„¡æ˜ç¢ºåŸ·è¡Œè¨ˆç•« |
| 0-29 | ç„¡å¯¦è³ªæ”¹å–„æªæ–½ |

**SMART æª¢æŸ¥ï¼š**
- **S**pecific: æªæ–½æ˜¯å¦å…·é«”ï¼Ÿ
- **M**easurable: æ˜¯å¦æœ‰æˆåŠŸæ¨™æº–ï¼Ÿ
- **A**ssignable: æ˜¯å¦æœ‰è² è²¬äººï¼Ÿ
- **R**ealistic: æ˜¯å¦å¯åŸ·è¡Œï¼Ÿ
- **T**ime-bound: æ˜¯å¦æœ‰æœŸé™ï¼Ÿ

#### ç¶­åº¦ 5: Systemic Prevention (ç³»çµ±æ€§é é˜²)

| åˆ†æ•¸ | æ¨™æº– |
|------|------|
| 90-100 | æ¶µè“‹ Swiss Cheese å¤šå±¤é˜²è­·ã€æœ‰é•·æœŸç›£æ¸¬è¨ˆç•« |
| 70-89 | æœ‰ç³»çµ±æ€§æ”¹å–„ã€æ¶µè“‹2-3å±¤é˜²è­· |
| 50-69 | éƒ¨åˆ†ç³»çµ±æ€§ã€ä»¥çŸ­æœŸæªæ–½ç‚ºä¸» |
| 30-49 | åƒ…é‡å°å€‹æ¡ˆã€ç„¡ç³»çµ±æ€§æ€è€ƒ |
| 0-29 | ç´”ç²¹æ­¸å’å€‹äººã€ç„¡é é˜²æªæ–½ |

**æª¢æŸ¥é …ç›®ï¼š**
- prevention_strategy çŸ­ä¸­é•·æœŸå®Œæ•´æ€§
- Swiss Cheese å±¤ç´šè¦†è“‹
- monitoring_plan æ˜¯å¦å®Œæ•´
- æ˜¯å¦æœ‰è¿½è¹¤æ©Ÿåˆ¶

### 8.3 è©•åˆ† Tool å®šç¾©

#### `rc_evaluate_quality`

**åŠŸèƒ½ï¼š** è©•ä¼° RCA Session çš„å“è³ª

**åƒæ•¸ï¼š**

| åƒæ•¸å | é¡å‹ | å¿…å¡« | èªªæ˜ |
| ------ | ---- | ---- | ---- |
| `session_id` | string | âœ“ | Session ID |

**å›å‚³ï¼š**

```json
{
  "session_id": "rc_sess_a1b2c3d4",
  "evaluation_time": "2026-01-15T15:30:00Z",
  "overall_score": 78,
  "grade": "B",
  "dimension_scores": {
    "factual_completeness": 85,
    "root_cause_depth": 75,
    "evidence_strength": 80,
    "corrective_action": 70,
    "systemic_prevention": 80
  },
  "strengths": [
    "æ™‚é–“ç·šå®Œæ•´ï¼Œæœ‰5å€‹äº‹ä»¶ä¸¦é™„æ™‚é–“æˆ³",
    "å› æœéˆé”4å±¤ï¼Œæ¶µè“‹ HFACS Level 3",
    "é é˜²ç­–ç•¥æ¶µè“‹çŸ­ä¸­é•·æœŸ"
  ],
  "gaps": [
    "æ”¹å–„æªæ–½ç¼ºå°‘æ˜ç¢ºè² è²¬äºº",
    "éƒ¨åˆ†å› æœé—œä¿‚è­‰æ“šä¾†æºå–®ä¸€",
    "æœªé” HFACS Level 4 (çµ„ç¹”å±¤é¢)"
  ],
  "recommendations": [
    "ç‚ºæ¯é … action_item æŒ‡å®šæ˜ç¢º owner",
    "å¢åŠ è¨ªè«‡ä»¥äº¤å‰é©—è­‰è­‰æ“š",
    "æ¢ç´¢æ˜¯å¦æœ‰çµ„ç¹”æ”¿ç­–/è³‡æºå±¤é¢çš„å› ç´ "
  ],
  "confidence": {
    "score": 0.82,
    "factors": [
      { "factor": "evidence_coverage", "value": 0.85 },
      { "factor": "verification_rate", "value": 0.90 },
      { "factor": "consistency_check", "value": 0.70 }
    ]
  }
}
```

**ç­‰ç´šå°ç…§ï¼š**

| ç­‰ç´š | åˆ†æ•¸ç¯„åœ | èªªæ˜ |
|------|----------|------|
| **A** | 90-100 | å„ªç§€ï¼Œå¯ä½œç‚ºç¯„æœ¬ |
| **B** | 75-89 | è‰¯å¥½ï¼Œå°å¹…æ”¹å–„å³å¯ |
| **C** | 60-74 | åˆæ ¼ï¼Œéœ€è£œå¼·ç‰¹å®šé ˜åŸŸ |
| **D** | 40-59 | ä¸åˆæ ¼ï¼Œéœ€é‡å¤§æ”¹å–„ |
| **F** | 0-39 | åš´é‡ä¸è¶³ï¼Œå»ºè­°é‡åš |

### 8.4 å“è³ªè©•åˆ†çš„ä½¿ç”¨æ™‚æ©Ÿ

```
Session ç”Ÿå‘½é€±æœŸèˆ‡å“è³ªè©•åˆ†ï¼š
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  å»ºç«‹ Session
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  GATHER â†’ CONTEXTUALIZE â†’ ANALYZE â†’ FISHBONE      â”‚
  â”‚                                                     â”‚
  â”‚  [å¯é¸] rc_evaluate_quality (ä¸­æœŸæª¢æŸ¥)              â”‚
  â”‚  - ææ—©ç™¼ç¾è³‡è¨Šä¸è¶³                                 â”‚
  â”‚  - å»ºè­°è£œå……å“ªäº›è³‡æ–™                                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  VERIFY â†’ ACTION                                    â”‚
  â”‚                                                     â”‚
  â”‚  [å»ºè­°] rc_evaluate_quality (çµæ¡ˆå‰æª¢æŸ¥)            â”‚
  â”‚  - ç¢ºä¿å“è³ªé”æ¨™                                     â”‚
  â”‚  - ç”¢ç”Ÿæ”¹å–„å»ºè­°                                     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
  Session çµæ¡ˆ
       â”‚
       â–¼
  [å¯é¸] è¼¸å‡ºå“è³ªå ±å‘Šé™„æ–¼ RCA æ–‡ä»¶
```

---

## 9. é ˜åŸŸé…ç½®

rootcause-mcp é€é YAML é…ç½®æª”å¯¦ç¾é ˜åŸŸå®¢è£½åŒ–ï¼Œç„¡éœ€ä¿®æ”¹ç¨‹å¼ç¢¼ã€‚

### 9.1 é…ç½®æª”çµæ§‹

**æª”æ¡ˆä½ç½®ï¼š** `config/domains/{domain_id}.yaml`

```yaml
# config/domains/clinical_rca_v1.yaml

domain_id: "clinical_rca_v1"
version: "1.0.0"
description: "è‡¨åºŠ RCA é€šç”¨é…ç½® - æ•´åˆ HFACS-MES èˆ‡ 6M é­šéª¨åœ–"

# ============================================
# Section 1: æ¡ˆä¾‹é¡å‹å®šç¾©
# ============================================
case_types:
  death:
    label: "æ­»äº¡æ¡ˆä¾‹"
    description: "é™¢å…§éé æœŸæ­»äº¡äº‹ä»¶"
    required_stages: ["GATHER", "CONTEXTUALIZE", "ANALYZE", "FISHBONE", "VERIFY", "ACTION"]
    special_requirements:
      - "timeline å¿…é ˆåŒ…å«ç™¼ç¾æ™‚é–“å’Œå®£å‘Šæ™‚é–“"
      - "å¿…é ˆæœ‰ç—…ç†å ±å‘Šæˆ–æ­»å› åˆ¤å®š"
  
  complication:
    label: "ä½µç™¼ç—‡æ¡ˆä¾‹"
    description: "éé æœŸä½µç™¼ç—‡äº‹ä»¶"
    required_stages: ["GATHER", "CONTEXTUALIZE", "ANALYZE", "FISHBONE", "VERIFY", "ACTION"]
  
  near_miss:
    label: "Near Miss"
    description: "å·®é»ç™¼ç”Ÿçš„å±éšªäº‹ä»¶"
    required_stages: ["GATHER", "CONTEXTUALIZE", "ANALYZE", "FISHBONE", "ACTION"]
    special_requirements:
      - "VERIFY éšæ®µå¯é¸ï¼ˆå› æœªå¯¦éš›ç™¼ç”Ÿï¼‰"
  
  safety:
    label: "ç—…å®‰äº‹ä»¶"
    description: "ç—…äººå®‰å…¨é€šå ±äº‹ä»¶"
    required_stages: ["GATHER", "CONTEXTUALIZE", "ANALYZE", "FISHBONE", "VERIFY", "ACTION"]
  
  staffing:
    label: "äººåŠ›å•é¡Œ"
    description: "äººåŠ›é…ç½®ç›¸é—œå•é¡Œ"
    required_stages: ["GATHER", "CONTEXTUALIZE", "ANALYZE", "FISHBONE", "ACTION"]

# ============================================
# Section 2: é­šéª¨åœ– 6M åˆ†é¡å®šç¾©
# ============================================
fishbone_categories:
  Personnel:
    label: "äººå“¡"
    description: "äººå“¡èƒ½åŠ›ã€ç‹€æ…‹ã€è¡Œç‚ºç›¸é—œå› ç´ "
    subcategories:
      - "è¨“ç·´/èƒ½åŠ›"
      - "ç–²å‹/ç‹€æ…‹"
      - "æºé€š/å”èª¿"
      - "æ…‹åº¦/å‹•æ©Ÿ"
    hfacs_mapping: ["UA-*", "PC-PF*", "PC-CO*"]
    guiding_questions:
      - "ç›¸é—œäººå“¡çš„è¨“ç·´æ˜¯å¦å……è¶³ï¼Ÿ"
      - "ç•¶æ™‚çš„èº«å¿ƒç‹€æ…‹å¦‚ä½•ï¼Ÿ"
      - "äººå“¡ä¹‹é–“çš„æºé€šæ˜¯å¦æœ‰æ•ˆï¼Ÿ"
  
  Equipment:
    label: "è¨­å‚™"
    description: "é†«ç™‚è¨­å‚™ã€è³‡è¨Šç³»çµ±ç›¸é—œå› ç´ "
    subcategories:
      - "è¨­å‚™æ•…éšœ"
      - "ç³»çµ±å•é¡Œ"
      - "è­¦å ±è¨­å®š"
      - "æ“ä½œä»‹é¢"
    hfacs_mapping: ["PC-EF2"]
    guiding_questions:
      - "ä½¿ç”¨çš„è¨­å‚™æ˜¯å¦æ­£å¸¸é‹ä½œï¼Ÿ"
      - "è³‡è¨Šç³»çµ±æ˜¯å¦æœ‰ç•°å¸¸ï¼Ÿ"
      - "è­¦å ±è¨­å®šæ˜¯å¦é©ç•¶ï¼Ÿ"
  
  Material:
    label: "ç‰©æ–™"
    description: "è—¥å“ã€è€—æã€è¡€å“ç›¸é—œå› ç´ "
    subcategories:
      - "è—¥å“å•é¡Œ"
      - "è€—æå•é¡Œ"
      - "è¡€å“å•é¡Œ"
      - "ä¾›æ‡‰å•é¡Œ"
    hfacs_mapping: []
    guiding_questions:
      - "ä½¿ç”¨çš„è—¥å“/è€—ææ˜¯å¦æœ‰å•é¡Œï¼Ÿ"
      - "ç‰©æ–™ä¾›æ‡‰æ˜¯å¦å……è¶³ï¼Ÿ"
  
  Process:
    label: "æµç¨‹"
    description: "SOPã€ä½œæ¥­æµç¨‹ã€æŸ¥æ ¸æ©Ÿåˆ¶ç›¸é—œå› ç´ "
    subcategories:
      - "SOP ç¼ºå¤±"
      - "æµç¨‹è¨­è¨ˆ"
      - "äº¤æ¥æµç¨‹"
      - "æŸ¥æ ¸æ©Ÿåˆ¶"
    hfacs_mapping: ["OI-OP*"]
    guiding_questions:
      - "æ˜¯å¦æœ‰ç›¸é—œ SOPï¼Ÿæ˜¯å¦è¢«éµå¾ªï¼Ÿ"
      - "æµç¨‹è¨­è¨ˆæ˜¯å¦æœ‰ç¼ºé™·ï¼Ÿ"
      - "äº¤æ¥æ˜¯å¦å®Œæ•´ï¼Ÿ"
  
  Environment:
    label: "ç’°å¢ƒ"
    description: "å·¥ä½œç’°å¢ƒã€äººåŠ›é…ç½®ç›¸é—œå› ç´ "
    subcategories:
      - "ç‰©ç†ç’°å¢ƒ"
      - "äººåŠ›é…ç½®"
      - "å·¥ä½œè² è·"
      - "æ™‚é–“å£“åŠ›"
    hfacs_mapping: ["OI-RM*", "PC-EF1", "PC-EF3"]
    guiding_questions:
      - "å·¥ä½œç’°å¢ƒæ˜¯å¦é©ç•¶ï¼Ÿ"
      - "äººåŠ›é…ç½®æ˜¯å¦è¶³å¤ ï¼Ÿ"
      - "ç•¶æ™‚çš„å·¥ä½œè² è·å¦‚ä½•ï¼Ÿ"
  
  Monitoring:
    label: "ç›£æ¸¬"
    description: "é è­¦ç³»çµ±ã€å“è³ªç›£æ¸¬ç›¸é—œå› ç´ "
    subcategories:
      - "ç›£æ¸¬é »ç‡"
      - "é è­¦ç³»çµ±"
      - "æŒ‡æ¨™è¿½è¹¤"
      - "ç•°å¸¸é€šå ±"
    hfacs_mapping: ["US-IS3", "US-FC*"]
    guiding_questions:
      - "æ˜¯å¦æœ‰é©ç•¶çš„ç›£æ¸¬æ©Ÿåˆ¶ï¼Ÿ"
      - "é è­¦ç³»çµ±æ˜¯å¦æœ‰æ•ˆï¼Ÿ"
      - "ç•°å¸¸ç™¼ç¾å¾Œæ˜¯å¦æœ‰åŠæ™‚é€šå ±ï¼Ÿ"

# ============================================
# Section 3: éšæ®µé©—è­‰è¦å‰‡
# ============================================
stage_validation:
  GATHER:
    required_fields:
      - field: "event_summary"
        type: "string"
        max_length: 200
        error_message: "äº‹ä»¶æ‘˜è¦ä¸å¾—è¶…é 200 å­—"
      - field: "timeline"
        type: "array"
        min_items: 3
        error_message: "æ™‚é–“ç·šè‡³å°‘éœ€è¦ 3 å€‹äº‹ä»¶"
      - field: "data_sources"
        type: "array"
        min_items: 1
        error_message: "è‡³å°‘éœ€è¦ 1 å€‹è³‡æ–™ä¾†æº"
  
  CONTEXTUALIZE:
    required_fields:
      - field: "system_factors"
        type: "array"
        min_items: 2
        error_message: "è‡³å°‘éœ€è¦è­˜åˆ¥ 2 å€‹ç³»çµ±æ€§å› ç´ "
      - field: "stakeholders"
        type: "array"
        min_items: 1
        error_message: "è‡³å°‘éœ€è¦ 1 ä½ç›¸é—œäººå“¡"
    custom_rules:
      - rule: "hfacs_coverage"
        condition: "è‡³å°‘æ¶µè“‹ HFACS Level 2-4 å…¶ä¸­ä¸€é …"
        error_message: "è«‹åˆ†ææ›´æ·±å±¤çš„ç³»çµ±æ€§å› ç´ "
  
  ANALYZE:
    required_fields:
      - field: "primary_cause"
        type: "object"
        required_properties: ["description", "evidence"]
        error_message: "ä¸»è¦åŸå› å¿…é ˆæœ‰è­‰æ“šæ”¯æŒ"
      - field: "causal_chain"
        type: "array"
        min_items: 2
        error_message: "å› æœéˆè‡³å°‘éœ€è¦ 2 å€‹ç’°ç¯€"
  
  FISHBONE:
    required_fields:
      - field: "problem_statement"
        type: "string"
        error_message: "å¿…é ˆè¨­å®šå•é¡Œé™³è¿°"
      - field: "causes_by_category"
        type: "object"
        min_categories: 3
        error_message: "è‡³å°‘éœ€è¦æ¶µè“‹ 3 å€‹ 6M åˆ†é¡"
  
  VERIFY:
    required_fields:
      - field: "verification_results"
        type: "array"
        min_items: 1
        error_message: "è‡³å°‘éœ€è¦é©—è­‰ 1 å€‹å› æœé—œä¿‚"
    custom_rules:
      - rule: "all_causal_chains_verified"
        condition: "æ‰€æœ‰ causal_chain ç’°ç¯€éƒ½éœ€é€šéé©—è­‰"
        error_message: "æœ‰å› æœé—œä¿‚å°šæœªé©—è­‰"
  
  ACTION:
    required_fields:
      - field: "action_items"
        type: "array"
        min_items: 1
        error_message: "è‡³å°‘éœ€è¦ 1 é …æ”¹å–„æªæ–½"
    custom_rules:
      - rule: "cause_action_mapping"
        condition: "æ¯å€‹ primary_cause è‡³å°‘å°æ‡‰ä¸€å€‹ action_item"
        error_message: "æœ‰æ ¹æœ¬åŸå› å°šç„¡å°æ‡‰çš„æ”¹å–„æªæ–½"

# ============================================
# Section 4: HFACS-MES ä»£ç¢¼å°ç…§
# ============================================
hfacs_codes:
  # Level 4: çµ„ç¹”å½±éŸ¿
  OI-RM1: { level: 4, category: "è³‡æºç®¡ç†", description: "äººåŠ›è³‡æºä¸è¶³" }
  OI-RM2: { level: 4, category: "è³‡æºç®¡ç†", description: "è²¡å‹™è³‡æºé™åˆ¶" }
  OI-RM3: { level: 4, category: "è³‡æºç®¡ç†", description: "è¨­å‚™è³‡æºä¸è¶³" }
  OI-OC1: { level: 4, category: "çµ„ç¹”æ°›åœ", description: "çµ„ç¹”çµæ§‹å•é¡Œ" }
  OI-OC2: { level: 4, category: "çµ„ç¹”æ°›åœ", description: "æ”¿ç­–åŸ·è¡Œè½å·®" }
  OI-OC3: { level: 4, category: "çµ„ç¹”æ°›åœ", description: "çµ„ç¹”æ–‡åŒ–åå·®" }
  OI-OP1: { level: 4, category: "çµ„ç¹”æµç¨‹", description: "ä½œæ¥­æµç¨‹è¨­è¨ˆç¼ºé™·" }
  OI-OP2: { level: 4, category: "çµ„ç¹”æµç¨‹", description: "ç¨‹åºæ–‡ä»¶ç®¡ç†ä¸ç•¶" }
  OI-OP3: { level: 4, category: "çµ„ç¹”æµç¨‹", description: "ç›£ç£ç¨½æ ¸æ©Ÿåˆ¶ä¸è¶³" }
  
  # Level 3: ä¸å®‰å…¨ç›£ç£
  US-IS1: { level: 3, category: "ç›£ç£ä¸è¶³", description: "æŒ‡å°è¨“ç·´ä¸è¶³" }
  US-IS2: { level: 3, category: "ç›£ç£ä¸è¶³", description: "ä»»å‹™è¦åŠƒä¸ç•¶" }
  US-IS3: { level: 3, category: "ç›£ç£ä¸è¶³", description: "è¿½è¹¤ç›£æ§ç¼ºå¤±" }
  US-PI1: { level: 3, category: "è¨ˆç•«ä¸ç•¶", description: "é¢¨éšªè©•ä¼°ä¸è¶³" }
  US-PI2: { level: 3, category: "è¨ˆç•«ä¸ç•¶", description: "è¶…æ™‚å·¥ä½œå®‰æ’" }
  US-FC1: { level: 3, category: "æœªç³¾æ­£å•é¡Œ", description: "å·²çŸ¥å•é¡Œæœªè™•ç†" }
  US-FC2: { level: 3, category: "æœªç³¾æ­£å•é¡Œ", description: "é•è¦è¡Œç‚ºæœªç³¾æ­£" }
  US-SV1: { level: 3, category: "ç›£ç£é•è¦", description: "æˆæ¬Šä¸ç•¶æ“ä½œ" }
  US-SV2: { level: 3, category: "ç›£ç£é•è¦", description: "æœªåŸ·è¡Œè¦å®šç›£ç£" }
  
  # Level 2: ä¸å®‰å…¨è¡Œç‚ºå‰æ
  PC-EF1: { level: 2, category: "ç’°å¢ƒå› ç´ ", description: "ç‰©ç†ç’°å¢ƒä¸è‰¯" }
  PC-EF2: { level: 2, category: "ç’°å¢ƒå› ç´ ", description: "æŠ€è¡“ç’°å¢ƒå•é¡Œ" }
  PC-EF3: { level: 2, category: "ç’°å¢ƒå› ç´ ", description: "å·¥ä½œç’°å¢ƒå¹²æ“¾" }
  PC-CO1: { level: 2, category: "äººå“¡ç‹€æ…‹", description: "ç”Ÿç†ç‹€æ…‹ä¸ä½³" }
  PC-CO2: { level: 2, category: "äººå“¡ç‹€æ…‹", description: "å¿ƒç†ç‹€æ…‹å•é¡Œ" }
  PC-CO3: { level: 2, category: "äººå“¡ç‹€æ…‹", description: "èªçŸ¥èƒ½åŠ›å—é™" }
  PC-PF1: { level: 2, category: "äººå“¡å› ç´ ", description: "æºé€šå”èª¿ä¸è‰¯" }
  PC-PF2: { level: 2, category: "äººå“¡å› ç´ ", description: "åœ˜éšŠåˆä½œå•é¡Œ" }
  PC-PF3: { level: 2, category: "äººå“¡å› ç´ ", description: "é©ä»»æ€§å•é¡Œ" }
  
  # Level 1: ä¸å®‰å…¨è¡Œç‚º
  UA-ER1: { level: 1, category: "éŒ¯èª¤", description: "æ±ºç­–éŒ¯èª¤" }
  UA-ER2: { level: 1, category: "éŒ¯èª¤", description: "æŠ€èƒ½æ€§éŒ¯èª¤" }
  UA-ER3: { level: 1, category: "éŒ¯èª¤", description: "æ„ŸçŸ¥æ€§éŒ¯èª¤" }
  UA-VL1: { level: 1, category: "é•è¦", description: "ä¾‹è¡Œæ€§é•è¦" }
  UA-VL2: { level: 1, category: "é•è¦", description: "ä¾‹å¤–æ€§é•è¦" }
```

### 9.2 é…ç½®è¼‰å…¥æ©Ÿåˆ¶

```python
# é…ç½®è¼‰å…¥å½ä»£ç¢¼
class DomainConfigLoader:
    def __init__(self, config_dir: str = "config/domains"):
        self.config_dir = config_dir
        self.active_config = None
    
    def load(self, domain_id: str) -> dict:
        """è¼‰å…¥æŒ‡å®šé ˜åŸŸé…ç½®"""
        config_path = f"{self.config_dir}/{domain_id}.yaml"
        with open(config_path, 'r', encoding='utf-8') as f:
            config = yaml.safe_load(f)
        
        # é©—è­‰é…ç½®çµæ§‹
        self._validate_config(config)
        self.active_config = config
        return config
    
    def get_case_type(self, case_type: str) -> dict:
        """å–å¾—æ¡ˆä¾‹é¡å‹é…ç½®"""
        return self.active_config['case_types'].get(case_type)
    
    def get_fishbone_category(self, category: str) -> dict:
        """å–å¾—é­šéª¨åœ–åˆ†é¡é…ç½®"""
        return self.active_config['fishbone_categories'].get(category)
    
    def get_hfacs_code(self, code: str) -> dict:
        """å–å¾— HFACS ä»£ç¢¼è©³æƒ…"""
        return self.active_config['hfacs_codes'].get(code)
    
    def get_stage_validation(self, stage: str) -> dict:
        """å–å¾—éšæ®µé©—è­‰è¦å‰‡"""
        return self.active_config['stage_validation'].get(stage)
```

---

## 10. æŠ€è¡“å¯¦ä½œåƒè€ƒ

### 10.1 ç¢ºå®šæŠ€è¡“æ£§

| å±¤ç´š | æŠ€è¡“é¸æ“‡ | èªªæ˜ | ä¾†æº |
| ---- | -------- | ---- | ---- |
| **èªè¨€** | Python 3.12+ | æ›´å¥½çš„éŒ¯èª¤è¨Šæ¯ã€æ•ˆèƒ½æå‡ | å‡ç´š |
| **å¥—ä»¶ç®¡ç†** | **uv** | å¿«é€Ÿã€ç¾ä»£çš„ Python å¥—ä»¶ç®¡ç† | lumino-mcp-server |
| **MCP æ¡†æ¶** | **FastMCP** | Python MCP SDK çš„é«˜éš API | lumino-mcp-server |
| **é…ç½®è§£æ** | PyYAML | YAML é…ç½®æª”è§£æ | æ¨™æº– |
| **è³‡æ–™é©—è­‰** | **Pydantic v2** | Schema é©—è­‰èˆ‡åºåˆ—åŒ– | æ¨™æº– |
| **åœ–çµæ§‹** | **networkx** | å› æœåœ–/é­šéª¨åœ–å…§éƒ¨è¡¨ç¤º | æ±ºç­– |
| **æŒä¹…åŒ–** | **SQLite + SQLModel** | Session æŒä¹…åŒ– | æ±ºç­– |
| **æ—¥èªŒ** | structlog | çµæ§‹åŒ–æ—¥èªŒ | æ¨™æº– |
| **æ¸¬è©¦** | pytest + pytest-asyncio | å–®å…ƒæ¸¬è©¦èˆ‡æ•´åˆæ¸¬è©¦ | æ¨™æº– |
| **Linter** | **ruff** | å–ä»£ black+isort+flake8ï¼Œå¿« 10-100x | æœ€ä½³å¯¦è¸ |
| **Type Checker** | **mypy --strict** | éœæ…‹é¡å‹å®‰å…¨ | æœ€ä½³å¯¦è¸ |
| **æ¶æ§‹æ¨¡å¼** | **DDD** | Domain-Driven Design | æœ€ä½³å¯¦è¸ |

**pyproject.toml åƒè€ƒï¼š**

```toml
[project]
name = "rootcause-mcp"
version = "0.1.0"
requires-python = ">=3.12"
dependencies = [
    "mcp[cli]>=1.10.1",      # FastMCP
    "pydantic>=2.0.0",
    "sqlmodel>=0.0.16",
    "networkx>=3.0",
    "pyyaml>=6.0",
    "structlog>=23.0.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=8.0.0",
    "pytest-asyncio>=0.23.0",
    "ruff>=0.4.0",
    "mypy>=1.10.0",
    "pre-commit>=3.7.0",
]

[tool.ruff]
target-version = "py312"
line-length = 100
select = ["E", "F", "I", "N", "W", "UP", "ANN", "B", "C4", "SIM"]

[tool.ruff.lint.isort]
known-first-party = ["rootcause_mcp"]

[tool.mypy]
python_version = "3.12"
strict = true
warn_return_any = true
warn_unused_configs = true

[tool.pytest.ini_options]
asyncio_mode = "auto"
testpaths = ["tests"]
```

### 10.2 DDD æ¶æ§‹è¨­è¨ˆ

```
src/rootcause_mcp/
â”œâ”€â”€ domain/                    # é ˜åŸŸå±¤ (ç´”æ¥­å‹™é‚è¼¯)
â”‚   â”œâ”€â”€ models/               # Domain Models (Entities, Value Objects)
â”‚   â”‚   â”œâ”€â”€ session.py        # RcaSession (Aggregate Root)
â”‚   â”‚   â”œâ”€â”€ stage.py          # Stage, StageData
â”‚   â”‚   â”œâ”€â”€ fishbone.py       # FishboneNode, CausalLink
â”‚   â”‚   â””â”€â”€ evidence.py       # Evidence, VerificationResult
â”‚   â”œâ”€â”€ services/             # Domain Services
â”‚   â”‚   â”œâ”€â”€ flow_engine.py    # æµç¨‹å¼•æ“
â”‚   â”‚   â”œâ”€â”€ fishbone_engine.py
â”‚   â”‚   â””â”€â”€ verification.py   # å› æœé©—è­‰
â”‚   â””â”€â”€ events/               # Domain Events
â”‚       â””â”€â”€ rca_events.py     # SessionCreated, StageCompleted, etc.
â”‚
â”œâ”€â”€ application/              # æ‡‰ç”¨å±¤ (ç”¨ä¾‹å”èª¿)
â”‚   â”œâ”€â”€ commands/             # Command Handlers
â”‚   â”‚   â”œâ”€â”€ session_commands.py
â”‚   â”‚   â””â”€â”€ fishbone_commands.py
â”‚   â”œâ”€â”€ queries/              # Query Handlers
â”‚   â”‚   â””â”€â”€ session_queries.py
â”‚   â””â”€â”€ dto/                  # Data Transfer Objects
â”‚       â””â”€â”€ responses.py
â”‚
â”œâ”€â”€ infrastructure/           # åŸºç¤è¨­æ–½å±¤
â”‚   â”œâ”€â”€ persistence/          # SQLite + SQLModel
â”‚   â”‚   â”œâ”€â”€ repositories.py   # Repository å¯¦ä½œ
â”‚   â”‚   â””â”€â”€ db.py
â”‚   â”œâ”€â”€ config/               # é…ç½®è¼‰å…¥
â”‚   â”‚   â””â”€â”€ domain_loader.py
â”‚   â””â”€â”€ logging/
â”‚       â””â”€â”€ structured.py
â”‚
â”œâ”€â”€ interface/                # ä»‹é¢å±¤ (MCP Tools)
â”‚   â”œâ”€â”€ tools/                # FastMCP Tool å®šç¾©
â”‚   â”‚   â”œâ”€â”€ session_tools.py  # rc_start_session, etc.
â”‚   â”‚   â”œâ”€â”€ flow_tools.py     # rc_advance_stage, etc.
â”‚   â”‚   â””â”€â”€ fishbone_tools.py
â”‚   â””â”€â”€ prompts/              # MCP Prompts
â”‚       â””â”€â”€ guidance.py
â”‚
â””â”€â”€ server.py                 # FastMCP Server å…¥å£
```

**DDD æ ¸å¿ƒåŸå‰‡ï¼š**

1. **Aggregate Root**: `RcaSession` æ˜¯å”¯ä¸€çš„ Aggregate Root
2. **Repository Pattern**: æ‰€æœ‰æŒä¹…åŒ–é€é Repository æŠ½è±¡
3. **Domain Events**: é‡è¦ç‹€æ…‹è®Šæ›´ç™¼é€ Eventï¼ˆå¯æ“´å±•é€šçŸ¥ï¼‰
4. **Dependency Inversion**: Domain å±¤ä¸ä¾è³´ Infrastructure

### 10.3 æ ¸å¿ƒæŠ€è¡“é¸å‹

**åƒè€ƒä¾†æºï¼š** `docs/rca_repo_analysis.md`ã€`docs/literature_review_clinical_rca.md`

#### 10.3.1 æ ¸å¿ƒä¾è³´åº«ï¼ˆåˆ† Phase å¼•å…¥ï¼‰

| Library | ç‰ˆæœ¬ | Phase | ç”¨é€” | åƒè€ƒä¾†æº |
| ------- | ---- | ----- | ---- | -------- |
| **networkx** | â‰¥3.0 | 1 | é­šéª¨åœ–/å› æœåœ–çµæ§‹ | åŸºç¤ |
| **pydantic** | â‰¥2.0 | 1 | Model é©—è­‰ | åŸºç¤ |
| **sqlmodel** | â‰¥0.0.16 | 1 | Session æŒä¹…åŒ– | åŸºç¤ |
| **owlready2** | â‰¥0.46 | 2 | OWL æœ¬é«” + SWRL æ¨ç† | jorge-martinez-gil/KG-RCA |
| **dowhy[gcm]** | â‰¥0.11 | 3 | åäº‹å¯¦æ¨è«–ã€å› æœæ­¸å›  | PMID:35950198, py-why/dowhy |
| **causal-learn** | â‰¥0.1.3 | 3 | å› æœç™¼ç¾æ¼”ç®—æ³• | py-why/causal-learn |

**pyproject.toml æ›´æ–°ï¼š**

```toml
[project]
dependencies = [
    # Phase 1: Core
    "mcp[cli]>=1.10.1",
    "pydantic>=2.0.0",
    "sqlmodel>=0.0.16",
    "networkx>=3.0",
    "pyyaml>=6.0",
    "structlog>=23.0.0",
]

[project.optional-dependencies]
phase2 = [
    # Phase 2: Ontology Reasoning
    "owlready2>=0.46",
]
phase3 = [
    # Phase 3: Causal Inference
    "dowhy[gcm]>=0.11",
    "causal-learn>=0.1.3",
]
full = [
    "rootcause-mcp[phase2,phase3]",
]
```

#### 10.3.2 å„ Library å…·é«”ç”¨æ³•

**networkx - é›™è¦–åœ–æ¶æ§‹ï¼š**

```python
import networkx as nx

class DualViewCausalGraph:
    """é­šéª¨åœ– + å› æœåœ–åŒæ­¥ç¶­è­·"""
    
    def __init__(self):
        # é­šéª¨è¦–åœ–ï¼šéšå±¤æ¨¹ç‹€çµæ§‹
        self.fishbone = nx.DiGraph()
        # å› æœè¦–åœ–ï¼šDAG å› æœåœ–
        self.causal_dag = nx.DiGraph()
    
    def add_cause(self, cause_id: str, parent_id: str, 
                  fishbone_category: str, description: str):
        """åŒæ™‚æ›´æ–°å…©å€‹è¦–åœ–"""
        # é­šéª¨è¦–åœ–ï¼šåŠ å…¥éšå±¤
        self.fishbone.add_node(cause_id, 
            category=fishbone_category, 
            description=description
        )
        self.fishbone.add_edge(parent_id, cause_id)
        
        # å› æœè¦–åœ–ï¼šåŠ å…¥å› æœé—œä¿‚
        self.causal_dag.add_node(cause_id, description=description)
        # å› æœé‚Šåœ¨ verify_causation å¾Œæ‰åŠ å…¥
    
    def add_verified_causal_link(self, cause_id: str, effect_id: str, 
                                   confidence: float):
        """é©—è­‰é€šéå¾Œï¼Œåœ¨å› æœè¦–åœ–åŠ å…¥é‚Š"""
        self.causal_dag.add_edge(cause_id, effect_id, 
            verified=True, 
            confidence=confidence
        )
```

**DoWhy-GCM - åäº‹å¯¦æ¨è«–ï¼ˆPhase 3ï¼‰ï¼š**

```python
from dowhy import gcm
import numpy as np

def necessity_test_with_dowhy(causal_model, cause_node: str, 
                               effect_node: str, observed_data: dict) -> dict:
    """
    ä½¿ç”¨ DoWhy-GCM é€²è¡Œå¿…è¦æ€§æ¸¬è©¦
    å›ç­”ï¼šã€Œè‹¥æ²’æœ‰é€™å€‹åŸå› ï¼Œçµæœé‚„æœƒç™¼ç”Ÿå—ï¼Ÿã€
    """
    # å»ºç«‹åäº‹å¯¦æƒ…å¢ƒï¼šç§»é™¤åŸå› 
    counterfactual_data = observed_data.copy()
    counterfactual_data[cause_node] = 0  # å‡è¨­åŸå› ä¸å­˜åœ¨
    
    # è¨ˆç®—åäº‹å¯¦çµæœ
    cf_result = gcm.counterfactual_samples(
        causal_model,
        interventions={cause_node: lambda x: 0},
        observed_data=observed_data
    )
    
    # æ¯”è¼ƒå¯¦éš›çµæœ vs åäº‹å¯¦çµæœ
    actual_effect = observed_data[effect_node]
    counterfactual_effect = cf_result[effect_node].mean()
    
    necessity_score = abs(actual_effect - counterfactual_effect)
    
    return {
        "passed": necessity_score > 0.5,  # é–¾å€¼å¯èª¿
        "counterfactual_question": f"è‹¥ {cause_node} ä¸å­˜åœ¨ï¼Œ{effect_node} é‚„æœƒç™¼ç”Ÿå—ï¼Ÿ",
        "counterfactual_answer": "unlikely" if necessity_score > 0.5 else "likely",
        "confidence": float(min(necessity_score, 1.0)),
        "reasoning": f"åäº‹å¯¦åˆ†æé¡¯ç¤ºç§»é™¤åŸå› å¾Œï¼Œçµæœç™¼ç”Ÿæ©Ÿç‡é™ä½ {necessity_score:.0%}"
    }
```

**owlready2 - HFACS æœ¬é«”æ¨ç†ï¼ˆPhase 2ï¼‰ï¼š**

```python
from owlready2 import get_ontology, Thing, ObjectProperty

def load_hfacs_ontology():
    """è¼‰å…¥ HFACS-MES æœ¬é«”"""
    onto = get_ontology("hfacs_mes.owl").load()
    return onto

def infer_hfacs_code(onto, cause_description: str) -> list[str]:
    """
    ä½¿ç”¨ SWRL è¦å‰‡æ¨ç† HFACS ä»£ç¢¼
    """
    with onto:
        # å»ºç«‹æš«æ™‚å€‹é«”
        cause = onto.Cause(cause_description)
        
        # åŸ·è¡Œæ¨ç†
        sync_reasoner_pellet(infer_property_values=True)
        
        # å–å¾—æ¨ç†çµæœ
        suggested_codes = [c.name for c in cause.hasHfacsCode]
    
    return suggested_codes
```

#### 10.3.3 Phase å°æ‡‰åŠŸèƒ½

| Phase | é©—è­‰èƒ½åŠ› | æŠ€è¡“å¯¦ç¾ |
| ----- | -------- | -------- |
| 1 | æ™‚åºæ€§æ¸¬è©¦ | ç´”é‚è¼¯æ¯”è¼ƒï¼ˆæ™‚é–“æˆ³ï¼‰ |
| 1 | æ©Ÿåˆ¶æ€§æ¸¬è©¦ï¼ˆåŸºç¤ï¼‰ | è¦å‰‡åº« + é ˜åŸŸçŸ¥è­˜ YAML |
| 2 | æ©Ÿåˆ¶æ€§æ¸¬è©¦ï¼ˆé€²éšï¼‰ | owlready2 SWRL æ¨ç† |
| 2 | HFACS ä»£ç¢¼æ¨è–¦ | OWL æœ¬é«”æ¨ç† |
| 3 | å¿…è¦æ€§æ¸¬è©¦ | DoWhy-GCM åäº‹å¯¦æ¨è«– |
| 3 | å……åˆ†æ€§æ¸¬è©¦ | causal-learn æ··æ·†å› å­è­˜åˆ¥ |
| 3 | å› æœæ­¸å›  | DoWhy-GCM attribute_anomalies |

### 10.4 GitHub Repos æ•´åˆå»ºè­°

**åƒè€ƒä¾†æºï¼š** `docs/rca_repo_analysis.md`

#### 10.4.1 å› æœæ¨è«–ï¼ˆPhase 3 æ•´åˆï¼‰

| Repo | ç”¨é€” | æ•´åˆæ–¹å¼ |
| ---- | ---- | -------- |
| **[DoWhy](https://github.com/py-why/dowhy)** | åäº‹å¯¦æ¨è«– | `rc_verify_causation` çš„å¿…è¦æ€§/å……åˆ†æ€§æ¸¬è©¦ |
| **[causal-learn](https://github.com/py-why/causal-learn)** | å› æœç™¼ç¾ | å¾æ•¸æ“šè‡ªå‹•ç™¼ç¾å› æœçµæ§‹ |

#### 10.4.2 ç•°å¸¸æª¢æ¸¬ï¼ˆPhase 3+ æ•´åˆï¼‰

| Repo | ç”¨é€” | æ•´åˆæ–¹å¼ |
| ---- | ---- | -------- |
| **[PyRCA](https://github.com/salesforce/PyRCA)** | æ ¹å› åˆ†æè©•åˆ† | è¨ˆç®—ç¯€é»çš„ç•°å¸¸æ­¸å› åˆ†æ•¸ |
| **[BARO](https://github.com/NetManAIOps/BARO)** | ç³»çµ±ç•°å¸¸å®šä½ | è¤‡é›œç³»çµ±çš„æ ¹å› å®šä½ |

#### 10.4.3 æœ¬é«”æ¨ç†ï¼ˆPhase 2 æ•´åˆï¼‰

| Repo | ç”¨é€” | æ•´åˆæ–¹å¼ |
| ---- | ---- | -------- |
| **[KG-RCA](https://github.com/jorge-martinez-gil/KG-RCA)** | çŸ¥è­˜åœ–è­œ RCA | owlready2 ä½¿ç”¨æ¨¡å¼ã€SWRL è¦å‰‡è¨­è¨ˆ |

#### 10.4.4 è‡¨åºŠ NLPï¼ˆè³‡æ–™é è™•ç†è¼”åŠ©ï¼‰

| Repo | ç”¨é€” | æ•´åˆæ–¹å¼ |
| ---- | ---- | -------- |
| **[medspacy](https://github.com/medspacy/medspacy)** | è‡¨åºŠæ–‡æœ¬è™•ç† | å¾è­·ç†ç´€éŒ„æå–é—œéµè³‡è¨Š |
| **[clinphen](https://github.com/deepphe/clinphen)** | è¡¨å‹æå– | å¾ç—…æ­·æå–è‡¨åºŠè¡¨å‹ |

#### 10.4.5 æµç¨‹å¼•æ“åƒè€ƒ

| Repo | ç”¨é€” | å€Ÿé¡é» |
| ---- | ---- | ------ |
| **[thinking-protocol-mcp](https://github.com/RimGit-N/thinking-protocol-mcp)** | çµæ§‹åŒ–æ€è€ƒæµç¨‹ | 6 éšæ®µå¼·åˆ¶æµç¨‹è¨­è¨ˆæ¨¡å¼ |

### 10.5 æ–‡ç»åƒè€ƒ

**åƒè€ƒä¾†æºï¼š** `docs/literature_review_clinical_rca.md`

| ä¸»é¡Œ | æ–‡ç» | æ‡‰ç”¨ |
| ---- | ---- | ---- |
| **HFACS-MES** | Diller et al. (2024). PMID:38394116 | HFACS-MES 36 ç¢¼å®šç¾© |
| **Causal ML for Medicine** | Sanchez et al. (2022). PMID:35950198 | DoWhy-GCM åäº‹å¯¦æ¨è«– |
| **Swiss Cheese** | Reason J. (1990). Human Error | å¤šå±¤é˜²è­·æ¦‚å¿µ |
| **å› æœæ¨è«–** | Pearl J. (2009). Causality | å› æœéšæ¢¯ç†è«– |
| **è‡¨åºŠ RCA** | VA NCPS RCA Guidelines | è‡¨åºŠ RCA å¯¦å‹™æµç¨‹ |

---

## 11. é–‹ç™¼è·¯ç·šåœ–

### Phase 1: Flow Engine MVPï¼ˆé ä¼° 2-3 é€±ï¼‰

**ç›®æ¨™ï¼š** Agent å¯ä»¥èµ°å®Œå®Œæ•´çš„ 6 éšæ®µ RCA æµç¨‹

**äº¤ä»˜é …ç›®ï¼š**

| é …ç›® | èªªæ˜ | é©—æ”¶æ¨™æº– |
| ---- | ---- | -------- |
| Session ç®¡ç† | å»ºç«‹/æŸ¥è©¢/é—œé–‰ Session | `rc_start_session`, `rc_get_session_status` å¯ç”¨ |
| éšæ®µåŸ·è¡Œ | åŸ·è¡Œå„éšæ®µä¸¦é©—è­‰ | `rc_execute_stage` å¯ç”¨ï¼Œé©—è­‰è¦å‰‡ç”Ÿæ•ˆ |
| ç‹€æ…‹æŒä¹…åŒ– | Session è³‡æ–™ä¸éºå¤± | é‡å•Ÿå¾Œ Session å¯æ¢å¾© |
| é…ç½®è¼‰å…¥ | è¼‰å…¥ YAML é…ç½® | `clinical_rca_v1.yaml` å¯æ­£ç¢ºè§£æ |

**æŠ€è¡“é‡é»ï¼š**
- MCP Server åŸºç¤æ¶æ§‹
- Pydantic è³‡æ–™é©—è­‰
- Session ç‹€æ…‹æ©Ÿå¯¦ä½œ

---

### Phase 2: Fishbone + Verificationï¼ˆé ä¼° 2-3 é€±ï¼‰

**ç›®æ¨™ï¼š** å®Œæ•´çš„é­šéª¨åœ–å»ºæ§‹èˆ‡åŸºç¤å› æœé©—è­‰

**äº¤ä»˜é …ç›®ï¼š**

| é …ç›® | èªªæ˜ | é©—æ”¶æ¨™æº– |
| ---- | ---- | -------- |
| é­šéª¨åœ–åˆå§‹åŒ– | å»ºç«‹ 6M çµæ§‹ | `rc_init_fishbone` å¯ç”¨ |
| åŸå› æ–°å¢ | æ–°å¢/ä¿®æ”¹åŸå› ç¯€é» | `rc_add_cause` å¯ç”¨ |
| é­šéª¨åœ–åŒ¯å‡º | Mermaid/JSON/Markdown | `rc_export_fishbone` ä¸‰ç¨®æ ¼å¼å¯ç”¨ |
| æ™‚åºé©—è­‰ | æª¢æŸ¥å› æœæ™‚åº | `rc_verify_causation` æ™‚åºæª¢æŸ¥å¯ç”¨ |
| ä¸€è‡´æ€§æª¢æŸ¥ | æª¢æŸ¥é‚è¼¯çŸ›ç›¾ | `rc_check_consistency` å¯ç”¨ |

**æŠ€è¡“é‡é»ï¼š**
- NetworkX åœ–çµæ§‹æ“ä½œ
- Mermaid èªæ³•ç”Ÿæˆ
- æ™‚åºé‚è¼¯é©—è­‰

---

### Phase 3: MCP å”ä½œæ•´åˆï¼ˆé ä¼° 2 é€±ï¼‰

**ç›®æ¨™ï¼š** èˆ‡ HHRAGã€CGU çš„å”ä½œä»‹é¢

**äº¤ä»˜é …ç›®ï¼š**

| é …ç›® | èªªæ˜ | é©—æ”¶æ¨™æº– |
| ---- | ---- | -------- |
| çŸ¥è­˜è«‹æ±‚ä»‹é¢ | å‘ HHRAG è«‹æ±‚ | `rc_request_knowledge` å¯ç™¼é€è«‹æ±‚ |
| å‰µæ„è«‹æ±‚ä»‹é¢ | å‘ CGU è«‹æ±‚ | `rc_request_creativity` å¯ç™¼é€è«‹æ±‚ |
| å›æ‡‰æ•´åˆ | æ•´åˆå¤–éƒ¨å›æ‡‰ | å›æ‡‰å¯æ­£ç¢ºè§£æä¸¦å»ºè­°åŠ å…¥é­šéª¨åœ– |

**æŠ€è¡“é‡é»ï¼š**
- MCP Client å‘¼å«
- éåŒæ­¥è«‹æ±‚è™•ç†
- å›æ‡‰æ ¼å¼è½‰æ›

---

### Phase 4: Domain Cartridgesï¼ˆé ä¼° 1-2 é€±ï¼‰

**ç›®æ¨™ï¼š** å¯åˆ‡æ›ä¸åŒé ˜åŸŸé…ç½®

**äº¤ä»˜é …ç›®ï¼š**

| é …ç›® | èªªæ˜ | é©—æ”¶æ¨™æº– |
| ---- | ---- | -------- |
| é…ç½®ç†±è¼‰å…¥ | ä¸é‡å•Ÿåˆ‡æ›é…ç½® | å¯å‹•æ…‹è¼‰å…¥ä¸åŒ YAML |
| è‡¨åºŠ RCA é…ç½® | å®Œæ•´è‡¨åºŠé…ç½® | `clinical_rca_v1.yaml` å®Œå–„ |
| HFACS å»ºè­° | æ ¹æ“š HFACS å»ºè­°éºæ¼ | `rc_suggest_missing` å¯ç”¨ |

**æŠ€è¡“é‡é»ï¼š**
- é…ç½®ç†±æ›´æ–°æ©Ÿåˆ¶
- HFACS è¦†è“‹ç‡è¨ˆç®—

---

### Phase 5: MCP Prompts + å“è³ªè©•åˆ† ğŸ†•ï¼ˆé ä¼° 1-2 é€±ï¼‰

> **è¨­è¨ˆä¾†æºï¼š** mako10k/mcp-rca + rca-ai-analyst

**ç›®æ¨™ï¼š** Prompt-based Guidance å’Œ RCA å“è³ªè©•åˆ†æ©Ÿåˆ¶

**äº¤ä»˜é …ç›®ï¼š**

| é …ç›® | èªªæ˜ | é©—æ”¶æ¨™æº– |
| ---- | ---- | -------- |
| MCP Prompts | éšæ®µå¼•å° Prompts | 6 å€‹ Prompts å¯ç”¨ |
| å“è³ªè©•åˆ† | 5 ç¶­åº¦è©•åˆ† | `rc_evaluate_quality` å¯ç”¨ |
| æª¢æŸ¥æ¸…å–® | å„éšæ®µ checklist | `rc_stage_checklist` å¯ç”¨ |
| æœ€ä½³å¯¦è¸ | åæ¨¡å¼æé†’ | `rc_best_practices` å¯ç”¨ |

**æŠ€è¡“é‡é»ï¼š**
- FastMCP Prompt å®šç¾©
- è©•åˆ†æ¼”ç®—æ³•å¯¦ä½œ
- Confidence Score è¨ˆç®—

---

### Phase 6: é€²éšæ•´åˆï¼ˆé ä¼° 2-3 é€±ï¼‰

**ç›®æ¨™ï¼š** æ•´åˆé€²éšå› æœæ¨è«–èˆ‡ä¼æ¥­ç‰¹æ€§

**äº¤ä»˜é …ç›®ï¼š**

| é …ç›® | èªªæ˜ | é©—æ”¶æ¨™æº– |
| ---- | ---- | -------- |
| Confidence Score | 0.0-1.0 ä¿¡å¿ƒåˆ†æ•¸ | æ¯å€‹å› æœé—œä¿‚æœ‰ä¿¡å¿ƒè©•ä¼° |
| Token å„ªåŒ– | é¸æ“‡æ€§è¿”å› | `include` åƒæ•¸æ”¯æ´ |
| Prometheus Metrics | å¯è§€æ¸¬æ€§ | åŸºæœ¬ metrics å¯ç”¨ |
| DoWhy æ•´åˆ | çµ±è¨ˆé©—è­‰ | å¯é¸ç”¨ DoWhy å¼·åŒ–é©—è­‰ |

**æŠ€è¡“é‡é»ï¼š**
- ä¿¡å¿ƒåˆ†æ•¸æ¼”ç®—æ³•
- é¸æ“‡æ€§ JSON è¿”å›
- å¯è§€æ¸¬æ€§æ¶æ§‹

---

### é‡Œç¨‹ç¢‘ç¸½è¦½ï¼ˆæ›´æ–°ç‰ˆï¼‰

```text
Week 1-3:   Phase 1 - Flow Engine MVP
            â”œâ”€â”€ FastMCP Server æ¶æ§‹
            â”œâ”€â”€ SQLite + SQLModel æŒä¹…åŒ–
            â”œâ”€â”€ Session ç®¡ç†
            â””â”€â”€ 6 éšæ®µæµç¨‹

Week 4-6:   Phase 2 - Fishbone + Verification
            â”œâ”€â”€ é­šéª¨åœ–å¼•æ“ (networkx)
            â”œâ”€â”€ å› æœé©—è­‰
            â””â”€â”€ Mermaid/JSON/Markdown åŒ¯å‡º

Week 7-8:   Phase 3 - MCP å”ä½œ
            â”œâ”€â”€ HHRAG æ•´åˆ
            â””â”€â”€ CGU æ•´åˆ

Week 9-10:  Phase 4 - Domain Cartridges
            â”œâ”€â”€ é…ç½®ç³»çµ±
            â””â”€â”€ HFACS å»ºè­°

Week 11-12: Phase 5 - Prompts + å“è³ªè©•åˆ† ğŸ†•
            â”œâ”€â”€ MCP Prompts å¼•å°
            â”œâ”€â”€ 5 ç¶­åº¦å“è³ªè©•åˆ†
            â””â”€â”€ æœ€ä½³å¯¦è¸ / åæ¨¡å¼æé†’

Week 13+:   Phase 6 - é€²éšæ•´åˆ
            â”œâ”€â”€ Confidence Score
            â”œâ”€â”€ Token å„ªåŒ–
            â”œâ”€â”€ Prometheus Metrics
            â””â”€â”€ DoWhy çµ±è¨ˆé©—è­‰ (å¯é¸)
```

### æŠ€è¡“æ£§ç¢ºèª

```text
âœ… å·²ç¢ºå®šçš„æŠ€è¡“æ£§ï¼š
â”œâ”€â”€ Package Manager:    uv
â”œâ”€â”€ MCP Framework:      FastMCP (Python MCP SDK)
â”œâ”€â”€ Python:             3.11+
â”œâ”€â”€ Schema:             Pydantic v2
â”œâ”€â”€ Persistence:        SQLite + SQLModel
â”œâ”€â”€ Graph:              networkx
â”œâ”€â”€ Config:             PyYAML
â””â”€â”€ Logging:            structlog

âœ… å·²ç¢ºå®šçš„åŠŸèƒ½è¨­è¨ˆï¼š
â”œâ”€â”€ Confidence Score:   æ˜¯ (0.0-1.0)
â”œâ”€â”€ RCA å“è³ªè©•åˆ†:       æ˜¯ (5 ç¶­åº¦ï¼Œè‡¨åºŠç‰ˆ)
â”œâ”€â”€ Prompt Guidance:    æ˜¯ (MCP Prompts)
â””â”€â”€ Fallback:           Agent å±¤è™•ç†ï¼ˆä¸æ˜¯ MCP serverï¼‰
```

---

## 12. é™„éŒ„

### é™„éŒ„ A: HFACS-MES å®Œæ•´åˆ†é¡è¡¨

```
Level 4: çµ„ç¹”å½±éŸ¿ (Organizational Influences)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»£ç¢¼    â”‚ åˆ†é¡           â”‚ èªªæ˜                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OI-RM1  â”‚ è³‡æºç®¡ç†       â”‚ äººåŠ›è³‡æºä¸è¶³                       â”‚
â”‚ OI-RM2  â”‚ è³‡æºç®¡ç†       â”‚ è²¡å‹™è³‡æºé™åˆ¶                       â”‚
â”‚ OI-RM3  â”‚ è³‡æºç®¡ç†       â”‚ è¨­å‚™è³‡æºä¸è¶³                       â”‚
â”‚ OI-OC1  â”‚ çµ„ç¹”æ°›åœ       â”‚ çµ„ç¹”çµæ§‹å•é¡Œ                       â”‚
â”‚ OI-OC2  â”‚ çµ„ç¹”æ°›åœ       â”‚ æ”¿ç­–åŸ·è¡Œè½å·®                       â”‚
â”‚ OI-OC3  â”‚ çµ„ç¹”æ°›åœ       â”‚ çµ„ç¹”æ–‡åŒ–åå·®                       â”‚
â”‚ OI-OP1  â”‚ çµ„ç¹”æµç¨‹       â”‚ ä½œæ¥­æµç¨‹è¨­è¨ˆç¼ºé™·                   â”‚
â”‚ OI-OP2  â”‚ çµ„ç¹”æµç¨‹       â”‚ ç¨‹åºæ–‡ä»¶ç®¡ç†ä¸ç•¶                   â”‚
â”‚ OI-OP3  â”‚ çµ„ç¹”æµç¨‹       â”‚ ç›£ç£ç¨½æ ¸æ©Ÿåˆ¶ä¸è¶³                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Level 3: ä¸å®‰å…¨ç›£ç£ (Unsafe Supervision)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»£ç¢¼    â”‚ åˆ†é¡           â”‚ èªªæ˜                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ US-IS1  â”‚ ç›£ç£ä¸è¶³       â”‚ æŒ‡å°è¨“ç·´ä¸è¶³                       â”‚
â”‚ US-IS2  â”‚ ç›£ç£ä¸è¶³       â”‚ ä»»å‹™è¦åŠƒä¸ç•¶                       â”‚
â”‚ US-IS3  â”‚ ç›£ç£ä¸è¶³       â”‚ è¿½è¹¤ç›£æ§ç¼ºå¤±                       â”‚
â”‚ US-PI1  â”‚ è¨ˆç•«ä¸ç•¶       â”‚ é¢¨éšªè©•ä¼°ä¸è¶³                       â”‚
â”‚ US-PI2  â”‚ è¨ˆç•«ä¸ç•¶       â”‚ è¶…æ™‚å·¥ä½œå®‰æ’                       â”‚
â”‚ US-FC1  â”‚ æœªç³¾æ­£å•é¡Œ     â”‚ å·²çŸ¥å•é¡Œæœªè™•ç†                     â”‚
â”‚ US-FC2  â”‚ æœªç³¾æ­£å•é¡Œ     â”‚ é•è¦è¡Œç‚ºæœªç³¾æ­£                     â”‚
â”‚ US-SV1  â”‚ ç›£ç£é•è¦       â”‚ æˆæ¬Šä¸ç•¶æ“ä½œ                       â”‚
â”‚ US-SV2  â”‚ ç›£ç£é•è¦       â”‚ æœªåŸ·è¡Œè¦å®šç›£ç£                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Level 2: ä¸å®‰å…¨è¡Œç‚ºå‰æ (Preconditions for Unsafe Acts)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»£ç¢¼    â”‚ åˆ†é¡           â”‚ èªªæ˜                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PC-EF1  â”‚ ç’°å¢ƒå› ç´        â”‚ ç‰©ç†ç’°å¢ƒä¸è‰¯                       â”‚
â”‚ PC-EF2  â”‚ ç’°å¢ƒå› ç´        â”‚ æŠ€è¡“ç’°å¢ƒå•é¡Œ                       â”‚
â”‚ PC-EF3  â”‚ ç’°å¢ƒå› ç´        â”‚ å·¥ä½œç’°å¢ƒå¹²æ“¾                       â”‚
â”‚ PC-CO1  â”‚ äººå“¡ç‹€æ…‹       â”‚ ç”Ÿç†ç‹€æ…‹ä¸ä½³                       â”‚
â”‚ PC-CO2  â”‚ äººå“¡ç‹€æ…‹       â”‚ å¿ƒç†ç‹€æ…‹å•é¡Œ                       â”‚
â”‚ PC-CO3  â”‚ äººå“¡ç‹€æ…‹       â”‚ èªçŸ¥èƒ½åŠ›å—é™                       â”‚
â”‚ PC-PF1  â”‚ äººå“¡å› ç´        â”‚ æºé€šå”èª¿ä¸è‰¯                       â”‚
â”‚ PC-PF2  â”‚ äººå“¡å› ç´        â”‚ åœ˜éšŠåˆä½œå•é¡Œ                       â”‚
â”‚ PC-PF3  â”‚ äººå“¡å› ç´        â”‚ é©ä»»æ€§å•é¡Œ                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Level 1: ä¸å®‰å…¨è¡Œç‚º (Unsafe Acts)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»£ç¢¼    â”‚ åˆ†é¡           â”‚ èªªæ˜                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UA-ER1  â”‚ éŒ¯èª¤           â”‚ æ±ºç­–éŒ¯èª¤                           â”‚
â”‚ UA-ER2  â”‚ éŒ¯èª¤           â”‚ æŠ€èƒ½æ€§éŒ¯èª¤                         â”‚
â”‚ UA-ER3  â”‚ éŒ¯èª¤           â”‚ æ„ŸçŸ¥æ€§éŒ¯èª¤                         â”‚
â”‚ UA-VL1  â”‚ é•è¦           â”‚ ä¾‹è¡Œæ€§é•è¦                         â”‚
â”‚ UA-VL2  â”‚ é•è¦           â”‚ ä¾‹å¤–æ€§é•è¦                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é™„éŒ„ B: Mermaid é­šéª¨åœ–ç¯„ä¾‹

**å®Œæ•´é­šéª¨åœ–è¼¸å‡ºç¯„ä¾‹ï¼š**

```mermaid
graph LR
    HEAD[ğŸŸ ç—…äººè¡“å¾Œç™¼ç”Ÿè—¥ç‰©éé‡ä¸è‰¯åæ‡‰]
    
    subgraph Personnel [ğŸ‘¤ äººå“¡]
        P1[è—¥å¸«ç¶“é©—ä¸è¶³]
        P1a[æ–°é€²äººå“¡ 3å€‹æœˆ]
        P1b[é«˜è­¦è¨Šè—¥ç‰©è¨“ç·´æœªå®Œæˆ]
        P1 --> P1a
        P1 --> P1b
    end
    
    subgraph Equipment [ğŸ”§ è¨­å‚™]
        EQ1[ç„¡åŠ‘é‡è¨ˆç®—è¼”åŠ©ç³»çµ±]
    end
    
    subgraph Process [ğŸ“‹ æµç¨‹]
        PR1[åŠ‘é‡æ ¸å°æµç¨‹ç¼ºå¤±]
        PR1a[ç„¡é›™é‡æŸ¥æ ¸æ©Ÿåˆ¶]
        PR1b[ç„¡ç³»çµ±è¼”åŠ©è¨ˆç®—]
        PR1 --> PR1a
        PR1 --> PR1b
    end
    
    subgraph Environment [ğŸ¥ ç’°å¢ƒ]
        E1[äººåŠ›é…ç½®ä¸è¶³]
        E1a[åƒ…1ä½è—¥å¸«å€¼ç­]
        E1b[è™•æ–¹é‡è¶…éè² è·]
        E1 --> E1a
        E1 --> E1b
    end
    
    subgraph Monitoring [ğŸ“Š ç›£æ¸¬]
        M1[ç¼ºä¹å³æ™‚è­¦ç¤º]
        M1a[ç„¡é«˜åŠ‘é‡è­¦å ±]
        M1 --> M1a
    end
    
    Personnel --> HEAD
    Equipment --> HEAD
    Process --> HEAD
    Environment --> HEAD
    Monitoring --> HEAD
```

### é™„éŒ„ C: JSON Schema

**Session Schema:**

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RCASession",
  "type": "object",
  "required": ["session_id", "case_type", "current_stage", "status"],
  "properties": {
    "session_id": {
      "type": "string",
      "pattern": "^rc_sess_[a-z0-9]+$"
    },
    "case_type": {
      "type": "string",
      "enum": ["death", "complication", "near_miss", "safety", "staffing"]
    },
    "current_stage": {
      "type": "string",
      "enum": ["GATHER", "CONTEXTUALIZE", "ANALYZE", "FISHBONE", "VERIFY", "ACTION"]
    },
    "status": {
      "type": "string",
      "enum": ["active", "completed", "abandoned"]
    },
    "stage_records": {
      "type": "array",
      "items": { "$ref": "#/definitions/StageRecord" }
    },
    "fishbone": {
      "oneOf": [
        { "$ref": "#/definitions/FishboneStructure" },
        { "type": "null" }
      ]
    },
    "created_at": { "type": "string", "format": "date-time" },
    "updated_at": { "type": "string", "format": "date-time" }
  },
  "definitions": {
    "StageRecord": {
      "type": "object",
      "required": ["stage", "status"],
      "properties": {
        "stage": { "type": "string" },
        "status": {
          "type": "string",
          "enum": ["not_started", "in_progress", "completed", "failed"]
        },
        "data": { "type": "object" },
        "validation_result": { "$ref": "#/definitions/ValidationResult" },
        "started_at": { "type": "string", "format": "date-time" },
        "completed_at": { "type": ["string", "null"], "format": "date-time" }
      }
    },
    "ValidationResult": {
      "type": "object",
      "properties": {
        "passed": { "type": "boolean" },
        "errors": { "type": "array", "items": { "type": "string" } },
        "warnings": { "type": "array", "items": { "type": "string" } }
      }
    },
    "FishboneStructure": {
      "type": "object",
      "required": ["fishbone_id", "problem_statement", "categories"],
      "properties": {
        "fishbone_id": { "type": "string" },
        "problem_statement": { "type": "string" },
        "categories": {
          "type": "array",
          "items": { "$ref": "#/definitions/FishboneCategory" }
        }
      }
    },
    "FishboneCategory": {
      "type": "object",
      "required": ["category", "causes"],
      "properties": {
        "category": {
          "type": "string",
          "enum": ["Personnel", "Equipment", "Material", "Process", "Environment", "Monitoring"]
        },
        "causes": {
          "type": "array",
          "items": { "$ref": "#/definitions/FishboneCause" }
        }
      }
    },
    "FishboneCause": {
      "type": "object",
      "required": ["cause_id", "description"],
      "properties": {
        "cause_id": { "type": "string" },
        "description": { "type": "string" },
        "sub_causes": { "type": "array", "items": { "type": "string" } },
        "hfacs_code": { "type": "string", "pattern": "^(OI|US|PC|UA)-[A-Z]{2}[0-9]$" },
        "evidence": { "type": "array", "items": { "type": "string" } },
        "verified": { "type": "boolean" }
      }
    }
  }
}
```

### é™„éŒ„ D: ç›¸é—œæ–‡ä»¶é€£çµ

| æ–‡ä»¶ | è·¯å¾‘ | èªªæ˜ |
| ---- | ---- | ---- |
| åŸå§‹ Spec v1 | `spec_v1.md` | åˆç‰ˆè¦æ ¼ï¼ˆå·²æ£„ç”¨ï¼‰ |
| Repo åˆ†æ | `docs/rca_repo_analysis.md` | 22 å€‹ GitHub Repos åˆ†æ |
| æ–‡ç»å›é¡§ | `docs/literature_review_clinical_rca.md` | PubMed æ–‡ç»æ•´ç† |
| æ¶æ§‹æ·±å…¥ | `docs/core_architecture_deep_dive.md` | DoWhy èˆ‡ Domain Cartridge |

---

**æ–‡ä»¶ç‹€æ…‹ï¼š** âœ… å…¨éƒ¨ç« ç¯€å·²å®Œæˆ

**ç‰ˆæœ¬æ­·å²ï¼š**

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´èªªæ˜ |
| ---- | ---- | -------- |
| 2.5.0 | 2026-01-15 | æ¼¸é€²å¼è¼¸å…¥è¨­è¨ˆï¼›HFACS è‡ªå‹•å»ºè­°ï¼›é­šéª¨åœ–å¤šå±¤çµæ§‹ï¼ˆmax 5 å±¤ï¼‰ |
| 2.4.0 | 2026-01-15 | åŠ å…¥ Counterfactual Testing Frameworkï¼›å®Œæ•´æŠ€è¡“é¸å‹ï¼ˆDoWhy-GCM, causal-learn, owlready2ï¼‰ |
| 2.3.0 | 2026-01-15 | éšæ®µé‡å‘½å IDENTIFY â†’ ANALYZEï¼›å¼·åŒ– Agent å‹å–„ Tools è¨­è¨ˆ |
| 2.2.0 | 2026-01-15 | æ–°å¢ DDD æ¶æ§‹ã€ruff/mypyã€å‰µæ–°å®šä½ã€é¢¨éšªåˆ†æã€é–‹ç™¼åŠ é€Ÿç­–ç•¥ |
| 2.1.0 | 2026-01-15 | æ•´åˆ MCP Promptsã€RCA å“è³ªè©•åˆ†ã€ç¢ºèªæŠ€è¡“æ£§ |
| 2.0.0 | 2026-01-15 | å®Œæ•´é‡å¯«ï¼Œæ–°å¢ 6 éšæ®µæµç¨‹ã€HFACS-MES æ•´åˆã€MCP Tools å®šç¾© |
| 1.0.0 | 2026-01-15 | åˆç‰ˆï¼ˆå·²æ£„ç”¨ï¼Œè¦‹ spec_v1.mdï¼‰ |

---

rootcause-mcp Specification v2.5.0 - æœ€å¾Œæ›´æ–°ï¼š2026-01-15

